<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>All Laboratory Tests - Complete Suite</title>
    <style>
        /* GLOBAL RESET FOR MAIN NAVIGATION ONLY */
        body {
            margin: 0;
            padding: 0;
            font-family: Arial, sans-serif;
            background: #f5f5f5;
        }

        /* NAVIGATION BAR - DRAGGABLE & MINIMIZABLE */
        .main-navigation {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 0;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 999999;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
            transition: all 0.3s ease;
        }
        
        .main-navigation.minimized {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            left: auto;
            right: 10px;
            top: 10px;
        }
        
        .nav-drag-handle {
            background: rgba(0,0,0,0.1);
            padding: 12px;
            cursor: move;
            user-select: none;
            touch-action: none;
            display: flex;
            justify-content: space-between;
            align-items: center;
            -webkit-user-select: none;
            -webkit-touch-callout: none;
        }
        
        .minimized .nav-drag-handle {
            border-radius: 50%;
            justify-content: center;
            padding: 0;
            width: 60px;
            height: 60px;
        }

        .nav-title {
            color: white;
            font-size: 20px;
            font-weight: bold;
            text-align: center;
            margin: 0;
            flex: 1;
        }
        
        .minimized .nav-title {
            display: none;
        }
        
        .nav-minimize-btn {
            background: rgba(255,255,255,0.3);
            border: none;
            color: white;
            width: 28px;
            height: 28px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 18px;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .minimized .nav-minimize-btn {
            display: none;
        }
        
        .nav-minimized-icon {
            display: none;
            font-size: 30px;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
        
        .minimized .nav-minimized-icon {
            display: block;
        }
        
        .nav-content {
            padding: 15px;
        }
        
        .minimized .nav-content {
            display: none;
        }

        .nav-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 8px;
            max-width: 1400px;
            margin: 0 auto;
        }

        .nav-btn {
            background: rgba(255,255,255,0.2);
            color: white;
            border: 2px solid rgba(255,255,255,0.3);
            padding: 10px 15px;
            cursor: pointer;
            border-radius: 6px;
            font-weight: bold;
            font-size: 13px;
            transition: all 0.2s;
            text-align: center;
        }

        .nav-btn:hover {
            background: rgba(255,255,255,0.3);
            border-color: white;
            transform: translateY(-2px);
        }

        .nav-btn.active {
            background: white;
            color: #667eea;
            border-color: white;
        }

        /* TEST CONTAINERS */
        .test-wrapper {
            display: none;
            margin-top: 160px; /* Space for fixed navigation */
            min-height: calc(100vh - 160px);
        }

        .test-wrapper.active {
            display: block;
        }

        /* HOME SCREEN */
        .home-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .welcome-box {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 30px;
            text-align: center;
        }

        .welcome-box h1 {
            color: #667eea;
            margin-bottom: 15px;
        }

        .welcome-box p {
            color: #666;
            line-height: 1.6;
            font-size: 16px;
        }

        .category-box {
            background: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 25px;
        }

        .category-box h2 {
            color: #667eea;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #667eea;
        }

        .test-cards {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .test-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .test-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
        }

        .test-card h3 {
            margin-bottom: 10px;
            font-size: 18px;
        }

        .test-card p {
            font-size: 14px;
            opacity: 0.9;
        }

        @media (max-width: 768px) {
            .nav-grid {
                grid-template-columns: 1fr 1fr;
            }
            
            .main-navigation {
                padding: 10px;
            }
            
            .test-wrapper {
                margin-top: 200px;
            }
        }
    </style>
</head>
<body>

    <!-- FIXED NAVIGATION - DRAGGABLE -->
    <div class="main-navigation" id="mainNav">
        <div class="nav-drag-handle" id="navDragHandle">
            <div class="nav-title">üß™ LABORATORY TEST RESULTS - ALL 11 TESTS</div>
            <button class="nav-minimize-btn" onclick="toggleNavMinimize()">‚àí</button>
            <span class="nav-minimized-icon">üìã</span>
        </div>
        <div class="nav-content">
            <div class="nav-grid">
                <button class="nav-btn active" onclick="switchTest('home')">üè† HOME</button>
                <button class="nav-btn" onclick="switchTest('bm_gradation')">üìä BM (Bituminous Macadam)</button>
                <button class="nav-btn" onclick="switchTest('sdbc_gradation')">üìä SDBC (Semi Dense BC)</button>
                <button class="nav-btn" onclick="switchTest('wbm_ii_gradation')">üìä WBM Grade-II</button>
                <button class="nav-btn" onclick="switchTest('wbm_iii_gradation')">üìä WBM Grade-III</button>
                <button class="nav-btn" onclick="switchTest('wmm_gradation')">üìä WMM (Wet Mix Macadam)</button>
                <button class="nav-btn" onclick="switchTest('gsb_i_gradation')">üìä GSB Grade-I</button>
                <button class="nav-btn" onclick="switchTest('gsb_ii_gradation')">üìä GSB Grade-II</button>
                <button class="nav-btn" onclick="switchTest('bm_binder')">üõ¢Ô∏è BM Binder Content</button>
                <button class="nav-btn" onclick="switchTest('mss_binder')">üõ¢Ô∏è MSS Binder Content</button>
                <button class="nav-btn" onclick="switchTest('sdbc_binder')">üõ¢Ô∏è SDBC Binder Content</button>
                <button class="nav-btn" onclick="switchTest('concrete_cube')">üß± Concrete Cube Test</button>
            </div>
        </div>
    </div>

    <!-- HOME SCREEN -->
    <div id="home" class="test-wrapper active">
        <div class="home-container">
            <div class="welcome-box">
                <h1>üéØ Welcome to Complete Lab Test Suite</h1>
                <p><strong>All 11 laboratory test generators in ONE single file!</strong></p>
                <p>Click any button at the top to open that test generator. Each test is fully functional with bulk generation, auto-calculations, and print support.</p>
            </div>

            <div class="category-box">
                <h2>üìê Gradation Tests (7 Types)</h2>
                <div class="test-cards">
                    <div class="test-card" onclick="switchTest('bm_gradation')">
                        <h3>BM (Bituminous Macadam)</h3>
                        <p>Sieve analysis with automated calculations</p>
                    </div>
                    <div class="test-card" onclick="switchTest('sdbc_gradation')">
                        <h3>SDBC (Semi Dense BC)</h3>
                        <p>Sieve analysis with automated calculations</p>
                    </div>
                    <div class="test-card" onclick="switchTest('wbm_ii_gradation')">
                        <h3>WBM Grade-II</h3>
                        <p>Sieve analysis with automated calculations</p>
                    </div>
                    <div class="test-card" onclick="switchTest('wbm_iii_gradation')">
                        <h3>WBM Grade-III</h3>
                        <p>Sieve analysis with automated calculations</p>
                    </div>
                    <div class="test-card" onclick="switchTest('wmm_gradation')">
                        <h3>WMM (Wet Mix Macadam)</h3>
                        <p>Sieve analysis with automated calculations</p>
                    </div>
                    <div class="test-card" onclick="switchTest('gsb_i_gradation')">
                        <h3>GSB Grade-I</h3>
                        <p>Sieve analysis with automated calculations</p>
                    </div>
                    <div class="test-card" onclick="switchTest('gsb_ii_gradation')">
                        <h3>GSB Grade-II</h3>
                        <p>Sieve analysis with automated calculations</p>
                    </div>
                </div>
            </div>

            <div class="category-box">
                <h2>üõ¢Ô∏è Binder Content Tests (3 Types)</h2>
                <div class="test-cards">
                    <div class="test-card" onclick="switchTest('bm_binder')">
                        <h3>BM Binder Content</h3>
                        <p>Bitumen extraction and analysis</p>
                    </div>
                    <div class="test-card" onclick="switchTest('mss_binder')">
                        <h3>MSS Binder Content</h3>
                        <p>Bitumen extraction and analysis</p>
                    </div>
                    <div class="test-card" onclick="switchTest('sdbc_binder')">
                        <h3>SDBC Binder Content</h3>
                        <p>Bitumen extraction and analysis</p>
                    </div>
                </div>
            </div>

            <div class="category-box">
                <h2>üß± Concrete Tests (1 Type)</h2>
                <div class="test-cards">
                    <div class="test-card" onclick="switchTest('concrete_cube')">
                        <h3>Concrete Cube Test</h3>
                        <p>Compressive strength testing</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- BM Gradation TEST -->
    <div id="bm_gradation" class="test-wrapper">
        <iframe 
            srcdoc="<!DOCTYPE html>
<html lang=&quot;en&quot;>
<head>
    <meta charset=&quot;UTF-8&quot;>
    <meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;>
    <title>Bulk BM Gradation Generator</title>
    <style>
        body { font-family: &quot;Times New Roman&quot;, Times, serif; margin: 0; padding: 20px; background-color: #f0f0f0; }
        
        /* Report Container Style */
        .report-container { 
            width: 210mm; 
            min-height: 297mm; 
            background-color: white; 
            margin: auto; 
            padding: 20px 40px; 
            box-shadow: 0 0 10px rgba(0,0,0,0.1); 
            box-sizing: border-box; 
            position: relative; 
            margin-bottom: 20px; 
        }
        
        .header { text-align: center; margin-bottom: 20px; }
        .header h2, .header h3 { margin: 5px 0; text-transform: uppercase; }
        .header h3 { font-size: 16px; font-weight: bold; }
        .title { text-align: center; font-weight: bold; text-decoration: underline; margin: 20px 0; font-size: 18px; }
        
        .info-table { width: 100%; margin-bottom: 20px; font-size: 14px; border-collapse: collapse; }
        .info-table td { padding: 5px 2px; vertical-align: top; border: none; line-height: 1.6; }
        
        .data-table { width: 100%; border-collapse: collapse; font-size: 13px; margin-bottom: 30px; text-align: center; }
        .data-table th, .data-table td { border: 1px solid black; padding: 5px; height: 30px; vertical-align: middle; }
        .data-table th { background-color: #f2f2f2; font-weight: bold; }
        
        .footer-section { margin-top: 50px; font-size: 14px; line-height: 1.6; }
        .signature-row { display: flex; justify-content: space-between; margin-top: 80px; align-items: flex-start; }
        .signature-box { text-align: center; width: 250px; }

        .editable {
            border-bottom: 1px dotted #999;
            outline: none;
            font-weight: bold;
            color: #000;
            display: inline; 
            min-width: 50px;
        }
        .editable:empty::before { content: &quot;\00a0\00a0\00a0\00a0\00a0\00a0\00a0&quot;; color: #ccc; }
        
        .tbl-input { width: 100%; border: none; text-align: center; font-family: inherit; font-size: inherit; background: transparent; outline: none; }
        .weight-input { background-color: #eef; font-weight: bold; } 
        
        .wt-input { 
            width: 60px; text-align: right; border: none; border-bottom: 1px dotted #999; 
            font-family: inherit; font-size: inherit; font-weight: bold; outline: none;
        }

        /* Control Panel Styles - DRAGGABLE */
        .action-btn-container {
            position: fixed; top: 20px; right: 20px; z-index: 9999;
            background: rgba(255, 255, 255, 0.98);
            padding: 0; border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            border: 1px solid #ccc; width: 260px;
            transition: all 0.3s ease;
        }
        .action-btn-container.minimized { width: 50px; height: 50px; border-radius: 50%; }
        .drag-handle {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white; padding: 10px; cursor: move;
            display: flex; justify-content: space-between; align-items: center;
            border-radius: 8px 8px 0 0; user-select: none; touch-action: none;
            -webkit-user-select: none;
            -webkit-touch-callout: none;
        }
        .minimized .drag-handle { border-radius: 50%; width: 50px; height: 50px; justify-content: center; padding: 0; }
        .drag-handle h4 { margin: 0; font-size: 14px; font-weight: bold; flex: 1; }
        .minimized .drag-handle h4 { display: none; }
        .minimize-btn {
            background: rgba(255,255,255,0.3); border: none; color: white;
            width: 24px; height: 24px; border-radius: 4px; cursor: pointer; font-size: 16px;
        }
        .minimized .minimize-btn { display: none; }
        .control-content { padding: 15px; max-height: calc(90vh - 44px); overflow-y: auto; }
        .minimized .control-content { display: none; }
        .minimized-icon { display: none; font-size: 24px; }
        .minimized .minimized-icon { display: block; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); }
        .action-btn-container h4 { margin: 0 0 10px 0; font-family: sans-serif; text-align: center; color: #333; border-bottom: 1px solid #ddd; padding-bottom: 5px; }
        
        .input-group { display: flex; flex-direction: column; margin-bottom: 8px; }
        .input-group label { font-size: 12px; font-family: sans-serif; font-weight: bold; margin-bottom: 3px; }
        .input-group input, .input-group select { padding: 5px; border: 1px solid #aaa; border-radius: 4px; }

        /* Toggle Switch Style */
        .mode-toggle { display: flex; align-items: center; margin-bottom: 10px; background: #eee; padding: 5px; border-radius: 5px; }
        .mode-toggle label { flex: 1; font-size: 12px; font-family: sans-serif; cursor: pointer; display: flex; align-items: center; }
        .mode-toggle input { margin-right: 5px; }

        /* List Editor Style with Line Numbers */
        .list-editor-container {
            display: flex;
            border: 1px solid #aaa;
            border-radius: 4px;
            height: 120px;
            font-family: monospace;
            font-size: 12px;
            background: white;
            margin-bottom: 8px;
        }
        .line-numbers {
            width: 25px;
            background-color: #f0f0f0;
            color: #888;
            text-align: right;
            padding: 5px 2px;
            border-right: 1px solid #ddd;
            line-height: 1.4;
            overflow: hidden;
            user-select: none;
        }
        .road-list-area {
            flex: 1;
            border: none;
            padding: 5px;
            line-height: 1.4;
            resize: none;
            outline: none;
            white-space: pre;
            overflow-y: scroll; /* Force scrollbar */
        }

        .hidden { display: none; }

        .btn { color: white; border: none; padding: 10px; font-size: 14px; font-weight: bold; cursor: pointer; border-radius: 5px; font-family: sans-serif; margin-top: 5px; transition: 0.2s; }
        .print-btn { background-color: #dc3545; }
        .magic-btn { background-color: #007bff; }
        .clear-btn { background-color: #6c757d; }
        .btn:hover { opacity: 0.9; transform: scale(1.02); }

        @media print { 
            body { background-color: white; padding: 0; } 
            .report-container { box-shadow: none; margin: 0; width: 100%; page-break-after: always; } 
            .report-container:last-child { page-break-after: auto; }
            .action-btn-container { display: none; }
            .weight-input { background-color: transparent; }
            .editable, .wt-input, .tbl-input { border: none !important; }
            .editable:empty::before { display: none; }
        }
    </style>
</head>
<body>

<div class=&quot;action-btn-container&quot;>
    <div class=&quot;drag-handle&quot;>
        <h4>Bulk Generator</h4>
        <button class=&quot;minimize-btn&quot; onclick=&quot;toggleMinimize(this)&quot;>‚àí</button>
        <span class=&quot;minimized-icon&quot;>‚öôÔ∏è</span>
    </div>
    <div class=&quot;control-content&quot;>
    
    <div class=&quot;input-group&quot;>
        <label>Division/Location:</label>
        <input type=&quot;text&quot; id=&quot;locationInput&quot; value=&quot;Nawada&quot; placeholder=&quot;e.g. RAJAULI&quot;>
    </div>

    <div class=&quot;mode-toggle&quot;>
        <label>
            <input type=&quot;radio&quot; name=&quot;genMode&quot; value=&quot;quantity&quot; onchange=&quot;toggleMode()&quot; checked> 
            <strong>Quantity Only</strong>
        </label>
        <label>
            <input type=&quot;radio&quot; name=&quot;genMode&quot; value=&quot;list&quot; onchange=&quot;toggleMode()&quot;> 
            <strong>Road Name List</strong>
        </label>
    </div>

    <div id=&quot;quantityBox&quot; class=&quot;input-group&quot;>
        <label>Quantity (No. of Reports):</label>
        <input type=&quot;number&quot; id=&quot;reportCount&quot; value=&quot;10&quot;>
    </div>

    <div id=&quot;listBox&quot; class=&quot;input-group hidden&quot;>
        <label>Paste Road Names Below:</label>
        <div class=&quot;list-editor-container&quot;>
            <div class=&quot;line-numbers&quot; id=&quot;lineNumbers&quot;>1</div>
            <textarea id=&quot;roadListInput&quot; class=&quot;road-list-area&quot; placeholder=&quot;Paste list here...&quot; oninput=&quot;updateLineNumbers()&quot; onscroll=&quot;syncScroll()&quot;></textarea>
        </div>
        <div style=&quot;font-size: 11px; color: #666; text-align: right;&quot;>Total Roads: <span id=&quot;roadCountDisplay&quot;>0</span></div>
    </div>

    <div class=&quot;input-group&quot;>
        <label>Min Weight (gm):</label>
        <input type=&quot;number&quot; id=&quot;minRange&quot; value=&quot;11000&quot;>
    </div>
    
    <div class=&quot;input-group&quot;>
        <label>Max Weight (gm):</label>
        <input type=&quot;number&quot; id=&quot;maxRange&quot; value=&quot;12000&quot;>
    </div>

    <button class=&quot;btn magic-btn&quot; onclick=&quot;generateBulkReports()&quot;>‚ö° GENERATE BULK</button>
    <button class=&quot;btn print-btn&quot; onclick=&quot;window.print()&quot;>PRINT ALL üñ®Ô∏è</button>
    <button class=&quot;btn clear-btn&quot; onclick=&quot;location.reload()&quot;>RESET</button>
    </div></div>

<div id=&quot;main-output-area&quot;>
    <div class=&quot;report-container template-report&quot;>
        <div class=&quot;header&quot;>
            <h2>RURAL WORKS DEPARTMENT</h2>
            <h3>Testing and Quality Control Laboratory, <span class=&quot;editable location-placeholder&quot; contenteditable=&quot;true&quot;>Nawada</span></h3>
        </div>
        <div class=&quot;title&quot;>GRADATION TEST OF (BM)</div>
        
        <table class=&quot;info-table&quot;>
            <tr>
                <td width=&quot;60%&quot;><strong>NAME OF ROAD :-</strong> <span class=&quot;editable road-name-field&quot; contenteditable=&quot;true&quot;></span></td>
                <td width=&quot;40%&quot;><strong>DATE OF COLLECTION/RECEIPT:-</strong> <span class=&quot;editable&quot; contenteditable=&quot;true&quot;></span></td>
            </tr>
            <tr>
                <td><strong>NAME OF WORKS DIVISION:-</strong> <span class=&quot;editable&quot; contenteditable=&quot;true&quot;>R.W.D WORKS DIVISION</span></td>
                <td><strong>DATE OF TEST:-</strong> <span class=&quot;editable&quot; contenteditable=&quot;true&quot;></span></td>
            </tr>
            <tr>
                <td><strong>NAME OF AGENCY :-</strong> <span class=&quot;editable&quot; contenteditable=&quot;true&quot;></span></td>
                <td><strong>PACKAGE NO:-</strong> <span class=&quot;editable&quot; contenteditable=&quot;true&quot;></span></td>
            </tr>
            <tr>
                <td colspan=&quot;2&quot;><strong>AGREEMENT NO:-</strong> <span class=&quot;editable&quot; contenteditable=&quot;true&quot;></span></td>
            </tr>
            <tr>
                <td colspan=&quot;2&quot;>
                    <strong>Ref:-</strong> <span class=&quot;editable&quot; contenteditable=&quot;true&quot;>A.E, R.W.D WORKS SUB DIV</span>
                    <span style=&quot;margin-left: 30px;&quot;><strong>Chainage:-</strong> <span class=&quot;editable&quot; contenteditable=&quot;true&quot;></span></span>
                </td>
            </tr>
            <tr>
                <td colspan=&quot;2&quot; style=&quot;padding-top: 10px;&quot;>
                    <strong>LT NO:-</strong> <span class=&quot;editable&quot; contenteditable=&quot;true&quot; style=&quot;min-width: 80px;&quot;></span> 
                    <span style=&quot;margin-left: 50px;&quot;><strong>DT:-</strong> <span class=&quot;editable&quot; contenteditable=&quot;true&quot; style=&quot;min-width: 80px;&quot;></span></span>
                    <span style=&quot;margin-left: 50px;&quot;><strong>Sample Wt:-</strong> <input type=&quot;number&quot; class=&quot;wt-input manualSampleWt&quot; value=&quot;5000&quot; oninput=&quot;calculate(this.closest(&#39;.report-container&#39;))&quot;>gm</span>
                </td>
            </tr>
        </table>
        
        <table class=&quot;data-table&quot;>
            <thead>
                <tr>
                    <th width=&quot;8%&quot;>SL. NO</th>
                    <th width=&quot;15%&quot;>Sieve No.<br>mm</th>
                    <th width=&quot;15%&quot;>Weight Retained<br>(gm)</th>
                    <th width=&quot;12%&quot;>% Wt. Of<br>Retained</th>
                    <th width=&quot;15%&quot;>Cumulative %<br>Retained</th>
                    <th width=&quot;12%&quot;>% Of Passing</th>
                    <th width=&quot;13%&quot;>Required<br>Limit %</th>
                    <th>Remarks</th>
                </tr>
            </thead>
            <tbody class=&quot;calcTable&quot;>
                <tr data-min=&quot;100&quot; data-max=&quot;100&quot;><td>1</td><td>26.5 mm</td><td><input type=&quot;number&quot; class=&quot;tbl-input weight-input&quot; oninput=&quot;calculate(this.closest(&#39;.report-container&#39;))&quot;></td><td class=&quot;res-pct&quot;></td><td class=&quot;res-cum&quot;></td><td class=&quot;res-pass&quot;></td><td>100</td><td><input type=&quot;text&quot; class=&quot;tbl-input&quot;></td></tr>
                <tr data-min=&quot;90&quot; data-max=&quot;100&quot;><td>2</td><td>19 mm</td><td><input type=&quot;number&quot; class=&quot;tbl-input weight-input&quot; oninput=&quot;calculate(this.closest(&#39;.report-container&#39;))&quot;></td><td class=&quot;res-pct&quot;></td><td class=&quot;res-cum&quot;></td><td class=&quot;res-pass&quot;></td><td>90-100</td><td><input type=&quot;text&quot; class=&quot;tbl-input&quot;></td></tr>
                <tr data-min=&quot;56&quot; data-max=&quot;88&quot;><td>3</td><td>13.2 mm</td><td><input type=&quot;number&quot; class=&quot;tbl-input weight-input&quot; oninput=&quot;calculate(this.closest(&#39;.report-container&#39;))&quot;></td><td class=&quot;res-pct&quot;></td><td class=&quot;res-cum&quot;></td><td class=&quot;res-pass&quot;></td><td>56-88</td><td><input type=&quot;text&quot; class=&quot;tbl-input&quot;></td></tr>
                <tr data-min=&quot;16&quot; data-max=&quot;36&quot;><td>4</td><td>4.75 mm</td><td><input type=&quot;number&quot; class=&quot;tbl-input weight-input&quot; oninput=&quot;calculate(this.closest(&#39;.report-container&#39;))&quot;></td><td class=&quot;res-pct&quot;></td><td class=&quot;res-cum&quot;></td><td class=&quot;res-pass&quot;></td><td>16-36</td><td><input type=&quot;text&quot; class=&quot;tbl-input&quot;></td></tr>
                <tr data-min=&quot;4&quot; data-max=&quot;19&quot;><td>5</td><td>2.36 mm</td><td><input type=&quot;number&quot; class=&quot;tbl-input weight-input&quot; oninput=&quot;calculate(this.closest(&#39;.report-container&#39;))&quot;></td><td class=&quot;res-pct&quot;></td><td class=&quot;res-cum&quot;></td><td class=&quot;res-pass&quot;></td><td>4-19</td><td><input type=&quot;text&quot; class=&quot;tbl-input&quot;></td></tr>
                <tr data-min=&quot;2&quot; data-max=&quot;10&quot;><td>6</td><td>300 mic</td><td><input type=&quot;number&quot; class=&quot;tbl-input weight-input&quot; oninput=&quot;calculate(this.closest(&#39;.report-container&#39;))&quot;></td><td class=&quot;res-pct&quot;></td><td class=&quot;res-cum&quot;></td><td class=&quot;res-pass&quot;></td><td>2-10</td><td><input type=&quot;text&quot; class=&quot;tbl-input&quot;></td></tr>
                <tr data-min=&quot;0&quot; data-max=&quot;8&quot; class=&quot;last-sieve&quot;><td>7</td><td>75 mic</td><td><input type=&quot;number&quot; class=&quot;tbl-input weight-input&quot; oninput=&quot;calculate(this.closest(&#39;.report-container&#39;))&quot;></td><td class=&quot;res-pct&quot;></td><td class=&quot;res-cum&quot;></td><td class=&quot;res-pass&quot;></td><td>0-8</td><td><input type=&quot;text&quot; class=&quot;tbl-input&quot;></td></tr>
                <tr style=&quot;font-weight: bold;&quot;>
                    <td></td><td>Total Wt.</td><td class=&quot;totalWtDisplay&quot;></td><td colspan=&quot;5&quot;></td>
                </tr>
            </tbody>
        </table>
        
        <div class=&quot;footer-section&quot;>
            <div style=&quot;display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px;&quot;>
                <div><strong>Memo No:</strong> <span class=&quot;editable&quot; contenteditable=&quot;true&quot; style=&quot;min-width: 100px;&quot;></span></div>
                <div style=&quot;margin-right: 150px;&quot;><strong>Date:</strong> <span class=&quot;editable&quot; contenteditable=&quot;true&quot; style=&quot;min-width: 150px;&quot;></span></div>
            </div>
            <p><strong>Copy Forwarded to:-</strong> Executive Engineer, R.W.D, Works Division, <span class=&quot;editable location-placeholder&quot; contenteditable=&quot;true&quot;>Nawada</span></p>
            <div class=&quot;signature-row&quot;>
                <div class=&quot;signature-box&quot;><br><br><strong>T.S.</strong></div>
                <div class=&quot;signature-box&quot;>
                    <br><br>
                    <strong>A.E.</strong><br>
                    R.W.D, Testing and Quality Control Laboratory,<br>
                    <span class=&quot;editable location-placeholder&quot; contenteditable=&quot;true&quot;>Nawada</span>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // Toggle between Quantity Input and List Input
    function toggleMode() {
        const mode = document.querySelector(&#39;input[name=&quot;genMode&quot;]:checked&#39;).value;
        const qtyBox = document.getElementById(&#39;quantityBox&#39;);
        const listBox = document.getElementById(&#39;listBox&#39;);
        
        if (mode === &#39;quantity&#39;) {
            qtyBox.classList.remove(&#39;hidden&#39;);
            listBox.classList.add(&#39;hidden&#39;);
        } else {
            qtyBox.classList.add(&#39;hidden&#39;);
            listBox.classList.remove(&#39;hidden&#39;);
        }
    }

    // Line Numbers Logic for Text Area
    function updateLineNumbers() {
        const textarea = document.getElementById(&#39;roadListInput&#39;);
        const lines = textarea.value.split(&#39;\n&#39;).length;
        const lineNumbersElem = document.getElementById(&#39;lineNumbers&#39;);
        
        let numbersHTML = &#39;&#39;;
        for (let i = 1; i <= lines; i++) {
            numbersHTML += i + &#39;<br>&#39;;
        }
        lineNumbersElem.innerHTML = numbersHTML;
        
        // Update Total Count display
        const nonEmptyLines = textarea.value.split(&#39;\n&#39;).filter(line => line.trim() !== &quot;&quot;).length;
        document.getElementById(&#39;roadCountDisplay&#39;).innerText = nonEmptyLines;
    }

    function syncScroll() {
        const textarea = document.getElementById(&#39;roadListInput&#39;);
        const lineNumbersElem = document.getElementById(&#39;lineNumbers&#39;);
        lineNumbersElem.scrollTop = textarea.scrollTop;
    }

    // Logic to generate multiple reports
    function generateBulkReports() {
        const minWt = parseFloat(document.getElementById(&#39;minRange&#39;).value);
        const maxWt = parseFloat(document.getElementById(&#39;maxRange&#39;).value);
        const locName = document.getElementById(&#39;locationInput&#39;).value || &quot;Nawada&quot;;
        
        if (!minWt || !maxWt) {
            alert(&quot;Please enter Min and Max Weight.&quot;);
            return;
        }

        // Determine Mode
        const mode = document.querySelector(&#39;input[name=&quot;genMode&quot;]:checked&#39;).value;
        let reportsToGenerate = []; // Array of objects { roadName: &quot;xyz&quot; }

        if (mode === &#39;quantity&#39;) {
            const count = parseInt(document.getElementById(&#39;reportCount&#39;).value);
            if (!count) { alert(&quot;Please enter Quantity.&quot;); return; }
            for(let i=0; i<count; i++) {
                reportsToGenerate.push({ roadName: &quot;&quot; }); // Blank names
            }
        } else {
            // List Mode
            const listText = document.getElementById(&#39;roadListInput&#39;).value;
            const lines = listText.split(&#39;\n&#39;);
            
            lines.forEach(line => {
                if(line.trim() !== &quot;&quot;) {
                    reportsToGenerate.push({ roadName: line.trim() });
                }
            });
            
            if (reportsToGenerate.length === 0) {
                alert(&quot;Please paste at least one road name in the list.&quot;);
                return;
            }
        }

        const container = document.getElementById(&#39;main-output-area&#39;);
        // Save the first template logic
        const template = container.querySelector(&#39;.template-report&#39;).cloneNode(true);
        
        // Clear current view
        container.innerHTML = &#39;&#39;;

        // Loop through the prepared list
        reportsToGenerate.forEach(item => {
            // Clone the report structure
            let newReport = template.cloneNode(true);
            
            // Randomize Sample Weight
            let randomSampleWt = Math.floor(Math.random() * (maxWt - minWt + 1)) + minWt;
            
            // Set Sample Weight
            let wtInput = newReport.querySelector(&#39;.manualSampleWt&#39;);
            wtInput.value = randomSampleWt;

            // Set Location
            newReport.querySelectorAll(&#39;.location-placeholder&#39;).forEach(span => {
                span.innerText = locName;
            });
            
            // Set Road Name (If provided from list)
            if (item.roadName) {
                newReport.querySelector(&#39;.road-name-field&#39;).innerText = item.roadName;
            }

            // Append to main container
            container.appendChild(newReport);
            
            // Run autofill logic
            autoFillWeights(newReport, randomSampleWt);
        });
    }

    // AutoFill Logic
    function autoFillWeights(reportElement, sampleWt) {
        if (!sampleWt || sampleWt <= 0) {
            sampleWt = parseFloat(reportElement.querySelector(&#39;.manualSampleWt&#39;).value);
        }

        const rows = reportElement.querySelectorAll(&#39;.calcTable tr[data-min]&#39;);
        let accumulatedWeight = 0;
        let currentPassing = 100;

        for (let i = 0; i < rows.length - 1; i++) {
            let row = rows[i];
            const minLim = parseFloat(row.getAttribute(&#39;data-min&#39;));
            const maxLim = parseFloat(row.getAttribute(&#39;data-max&#39;));
            
            let effectiveMax = Math.min(maxLim, currentPassing);
            let effectiveMin = minLim;
            if (effectiveMin > effectiveMax) effectiveMin = effectiveMax; 

            let randomPassing = (Math.random() * (effectiveMax - effectiveMin)) + effectiveMin;
            randomPassing = Math.round(randomPassing * 100) / 100;

            let cumRetainedPct = 100 - randomPassing;
            let targetCumWeight = (cumRetainedPct / 100) * sampleWt;
            
            let individualWeight = Math.round(targetCumWeight - accumulatedWeight);
            if (individualWeight < 0) individualWeight = 0;
            
            row.querySelector(&#39;.weight-input&#39;).value = individualWeight;
            accumulatedWeight += individualWeight;
            
            currentPassing = 100 - ((accumulatedWeight / sampleWt) * 100);
        }

        let lastRow = rows[rows.length - 1];
        let finalWeight = sampleWt - accumulatedWeight;
        if (finalWeight < 0) finalWeight = 0;
        lastRow.querySelector(&#39;.weight-input&#39;).value = finalWeight;
        
        calculate(reportElement);
    }

    // Calculation Logic
    function calculate(reportElement) {
        if (!reportElement) return;

        const rows = reportElement.querySelectorAll(&#39;.calcTable tr&#39;);
        let totalSumWeight = 0;
        let manualSampleWt = parseFloat(reportElement.querySelector(&#39;.manualSampleWt&#39;).value);
        
        rows.forEach((row, index) => {
            if (index < rows.length - 1) {
                const input = row.querySelector(&#39;.weight-input&#39;);
                if (input) {
                    const val = parseFloat(input.value);
                    if (!isNaN(val)) totalSumWeight += val;
                }
            }
        });

        const totalDisplay = reportElement.querySelector(&#39;.totalWtDisplay&#39;);
        if (totalDisplay) {
            totalDisplay.innerText = totalSumWeight > 0 ? totalSumWeight.toFixed(0) : &quot;&quot;;
        }
        
        let divisor = manualSampleWt > 0 ? manualSampleWt : totalSumWeight;
        let accumulatedWeight = 0;
        
        rows.forEach((row, index) => {
            if (index < rows.length - 1) {
                const input = row.querySelector(&#39;.weight-input&#39;);
                if (input) {
                    const weight = parseFloat(input.value) || 0;
                    accumulatedWeight += weight;
                    
                    if (divisor > 0) {
                        let pctRetained = (weight / divisor) * 100;
                        let cumRetained = (accumulatedWeight / divisor) * 100;
                        let passing = 100 - cumRetained;
                        
                        if (passing < 0.01) passing = 0; 
                        
                        row.querySelector(&#39;.res-pct&#39;).innerText = pctRetained.toFixed(2);
                        row.querySelector(&#39;.res-cum&#39;).innerText = cumRetained.toFixed(2);
                        row.querySelector(&#39;.res-pass&#39;).innerText = passing.toFixed(2);
                    } else {
                        row.querySelector(&#39;.res-pct&#39;).innerText = &quot;&quot;;
                        row.querySelector(&#39;.res-cum&#39;).innerText = &quot;&quot;;
                        row.querySelector(&#39;.res-pass&#39;).innerText = &quot;&quot;;
                    }
                }
            }
        });
    }

    // ========== DRAGGABLE CONTROLS (MOBILE FIXED) ==========
    (function() {
        let isDragging = false;
        let currentPanel = null;
        let offsetX = 0;
        let offsetY = 0;
        let startX = 0;
        let startY = 0;
        let hasMoved = false;

        document.querySelectorAll('.drag-handle').forEach(handle => {
            handle.addEventListener('touchstart', handleTouchStart, { passive: false });
            handle.addEventListener('mousedown', handleMouseStart);
        });

        function handleTouchStart(e) {
            const panel = e.target.closest('.action-btn-container') || e.target.closest('.controls');
            if (!panel) return;
            
            if (panel.classList.contains('minimized')) {
                toggleMinimize(e.target);
                return;
            }
            
            const touch = e.touches[0];
            startX = touch.clientX;
            startY = touch.clientY;
            
            const rect = panel.getBoundingClientRect();
            offsetX = touch.clientX - rect.left;
            offsetY = touch.clientY - rect.top;
            
            isDragging = true;
            currentPanel = panel;
            hasMoved = false;
            
            panel.style.transition = 'none';
            
            document.addEventListener('touchmove', handleTouchMove, { passive: false });
            document.addEventListener('touchend', handleTouchEnd);
        }

        function handleMouseStart(e) {
            const panel = e.target.closest('.action-btn-container') || e.target.closest('.controls');
            if (!panel) return;
            
            if (panel.classList.contains('minimized')) {
                toggleMinimize(e.target);
                return;
            }
            
            startX = e.clientX;
            startY = e.clientY;
            
            const rect = panel.getBoundingClientRect();
            offsetX = e.clientX - rect.left;
            offsetY = e.clientY - rect.top;
            
            isDragging = true;
            currentPanel = panel;
            hasMoved = false;
            
            panel.style.transition = 'none';
            
            document.addEventListener('mousemove', handleMouseMove);
            document.addEventListener('mouseup', handleMouseEnd);
        }

        function handleTouchMove(e) {
            if (!isDragging || !currentPanel) return;
            
            const touch = e.touches[0];
            const deltaX = Math.abs(touch.clientX - startX);
            const deltaY = Math.abs(touch.clientY - startY);
            
            // Only drag if moved more than 5px
            if (deltaX > 5 || deltaY > 5) {
                hasMoved = true;
                
                let newX = touch.clientX - offsetX;
                let newY = touch.clientY - offsetY;
                
                const maxX = window.innerWidth - currentPanel.offsetWidth;
                const maxY = window.innerHeight - currentPanel.offsetHeight;
                
                newX = Math.max(0, Math.min(newX, maxX));
                newY = Math.max(0, Math.min(newY, maxY));
                
                currentPanel.style.left = newX + 'px';
                currentPanel.style.top = newY + 'px';
                currentPanel.style.right = 'auto';
                
                e.preventDefault();
            }
        }

        function handleMouseMove(e) {
            if (!isDragging || !currentPanel) return;
            
            const deltaX = Math.abs(e.clientX - startX);
            const deltaY = Math.abs(e.clientY - startY);
            
            if (deltaX > 5 || deltaY > 5) {
                hasMoved = true;
                
                let newX = e.clientX - offsetX;
                let newY = e.clientY - offsetY;
                
                const maxX = window.innerWidth - currentPanel.offsetWidth;
                const maxY = window.innerHeight - currentPanel.offsetHeight;
                
                newX = Math.max(0, Math.min(newX, maxX));
                newY = Math.max(0, Math.min(newY, maxY));
                
                currentPanel.style.left = newX + 'px';
                currentPanel.style.top = newY + 'px';
                currentPanel.style.right = 'auto';
            }
        }

        function handleTouchEnd() {
            if (isDragging && currentPanel) {
                currentPanel.style.transition = 'all 0.3s ease';
            }
            isDragging = false;
            currentPanel = null;
            
            document.removeEventListener('touchmove', handleTouchMove);
            document.removeEventListener('touchend', handleTouchEnd);
        }

        function handleMouseEnd() {
            if (isDragging && currentPanel) {
                currentPanel.style.transition = 'all 0.3s ease';
            }
            isDragging = false;
            currentPanel = null;
            
            document.removeEventListener('mousemove', handleMouseMove);
            document.removeEventListener('mouseup', handleMouseEnd);
        }

        window.toggleMinimize = function(btn) {
            const panel = btn.closest('.action-btn-container') || btn.closest('.controls');
            if (!panel) return;
            panel.classList.toggle('minimized');
        };
    })();

</script>

</body>
</html>"
            style="width: 100%; height: calc(100vh - 160px); border: none; display: block;"
            sandbox="allow-scripts allow-same-origin allow-forms allow-modals"
        ></iframe>
    </div>

    <!-- SDBC Gradation TEST -->
    <div id="sdbc_gradation" class="test-wrapper">
        <iframe 
            srcdoc="<!DOCTYPE html>
<html lang=&quot;en&quot;>
<head>
    <meta charset=&quot;UTF-8&quot;>
    <meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;>
    <title>Bulk SDBC Gradation Generator</title>
    <style>
        body { font-family: &quot;Times New Roman&quot;, Times, serif; margin: 0; padding: 20px; background-color: #f0f0f0; }
        
        /* Report Container Style */
        .report-container { 
            width: 210mm; 
            min-height: 297mm; 
            background-color: white; 
            margin: auto; 
            padding: 20px 40px; 
            box-shadow: 0 0 10px rgba(0,0,0,0.1); 
            box-sizing: border-box; 
            position: relative; 
            margin-bottom: 20px; 
        }
        
        .header { text-align: center; margin-bottom: 20px; }
        .header h2, .header h3 { margin: 5px 0; text-transform: uppercase; }
        .header h3 { font-size: 16px; font-weight: bold; }
        .title { text-align: center; font-weight: bold; text-decoration: underline; margin: 20px 0; font-size: 18px; }
        
        .info-table { width: 100%; margin-bottom: 20px; font-size: 14px; border-collapse: collapse; }
        .info-table td { padding: 5px 2px; vertical-align: top; border: none; line-height: 1.6; }
        
        .data-table { width: 100%; border-collapse: collapse; font-size: 13px; margin-bottom: 30px; text-align: center; }
        .data-table th, .data-table td { border: 1px solid black; padding: 5px; height: 30px; vertical-align: middle; }
        .data-table th { background-color: #f2f2f2; font-weight: bold; }
        
        .footer-section { margin-top: 50px; font-size: 14px; line-height: 1.6; }
        .signature-row { display: flex; justify-content: space-between; margin-top: 80px; align-items: flex-start; }
        .signature-box { text-align: center; width: 250px; }

        .editable {
            border-bottom: 1px dotted #999;
            outline: none;
            font-weight: bold;
            color: #000;
            display: inline; 
            min-width: 50px;
        }
        
        .editable:empty::before {
            content: &quot;\00a0\00a0\00a0\00a0\00a0\00a0\00a0\00a0&quot;; 
            color: #ccc;
        }
        
        .tbl-input { width: 100%; border: none; text-align: center; font-family: inherit; font-size: inherit; background: transparent; outline: none; }
        .weight-input { background-color: #eef; font-weight: bold; } 
        
        .wt-input { 
            width: 60px; 
            text-align: right; 
            border: none; 
            border-bottom: 1px dotted #999; 
            font-family: inherit; 
            font-size: inherit; 
            font-weight: bold; 
            outline: none;
        }

        /* Control Panel Styles - DRAGGABLE */
        .action-btn-container {
            position: fixed; top: 20px; right: 20px; z-index: 9999;
            background: rgba(255, 255, 255, 0.98);
            padding: 0; border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            border: 1px solid #ccc; width: 260px;
            transition: all 0.3s ease;
        }
        .action-btn-container.minimized { width: 50px; height: 50px; border-radius: 50%; }
        .drag-handle {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white; padding: 10px; cursor: move;
            display: flex; justify-content: space-between; align-items: center;
            border-radius: 8px 8px 0 0; user-select: none; touch-action: none;
            -webkit-user-select: none;
            -webkit-touch-callout: none;
        }
        .minimized .drag-handle { border-radius: 50%; width: 50px; height: 50px; justify-content: center; padding: 0; }
        .drag-handle h4 { margin: 0; font-size: 14px; font-weight: bold; flex: 1; }
        .minimized .drag-handle h4 { display: none; }
        .minimize-btn {
            background: rgba(255,255,255,0.3); border: none; color: white;
            width: 24px; height: 24px; border-radius: 4px; cursor: pointer; font-size: 16px;
        }
        .minimized .minimize-btn { display: none; }
        .control-content { padding: 15px; max-height: calc(90vh - 44px); overflow-y: auto; }
        .minimized .control-content { display: none; }
        .minimized-icon { display: none; font-size: 24px; }
        .minimized .minimized-icon { display: block; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); }
        .action-btn-container h4 { margin: 0 0 10px 0; font-family: sans-serif; text-align: center; color: #333; border-bottom: 1px solid #ddd; padding-bottom: 5px; }
        
        .input-group { display: flex; flex-direction: column; margin-bottom: 8px; }
        .input-group label { font-size: 12px; font-family: sans-serif; font-weight: bold; margin-bottom: 3px; }
        .input-group input, .input-group select { padding: 5px; border: 1px solid #aaa; border-radius: 4px; }

        /* Toggle Switch Style */
        .mode-toggle { display: flex; align-items: center; margin-bottom: 10px; background: #eee; padding: 5px; border-radius: 5px; }
        .mode-toggle label { flex: 1; font-size: 12px; font-family: sans-serif; cursor: pointer; display: flex; align-items: center; }
        .mode-toggle input { margin-right: 5px; }

        /* List Editor Style with Line Numbers */
        .list-editor-container {
            display: flex;
            border: 1px solid #aaa;
            border-radius: 4px;
            height: 120px;
            font-family: monospace;
            font-size: 12px;
            background: white;
            margin-bottom: 8px;
        }
        .line-numbers {
            width: 25px;
            background-color: #f0f0f0;
            color: #888;
            text-align: right;
            padding: 5px 2px;
            border-right: 1px solid #ddd;
            line-height: 1.4;
            overflow: hidden;
            user-select: none;
        }
        .road-list-area {
            flex: 1;
            border: none;
            padding: 5px;
            line-height: 1.4;
            resize: none;
            outline: none;
            white-space: pre;
            overflow-y: scroll;
        }

        .hidden { display: none; }

        .btn { color: white; border: none; padding: 10px; font-size: 14px; font-weight: bold; cursor: pointer; border-radius: 5px; font-family: sans-serif; margin-top: 5px; transition: 0.2s; }
        .print-btn { background-color: #dc3545; }
        .magic-btn { background-color: #28a745; }
        .clear-btn { background-color: #6c757d; }
        .btn:hover { opacity: 0.9; transform: scale(1.02); }

        @media print { 
            body { background-color: white; padding: 0; } 
            .report-container { 
                box-shadow: none; 
                margin: 0; 
                width: 100%; 
                page-break-after: always; 
            } 
            .report-container:last-child { page-break-after: auto; }
            
            .action-btn-container { display: none; }
            .weight-input { background-color: transparent; }
            .editable { background-color: transparent; }
            .editable, .wt-input, .tbl-input { border-bottom: none !important; border: none !important; }
            .editable:empty::before { content: &quot;&quot;; display: none; }
        }
        
        @media screen {
            .editable:hover { background-color: rgba(0, 0, 255, 0.05); cursor: text; }
        }
    </style>
</head>
<body>

<div class=&quot;action-btn-container&quot;>
    <div class=&quot;drag-handle&quot;>
        <h4>SDBC AI Control</h4>
        <button class=&quot;minimize-btn&quot; onclick=&quot;toggleMinimize(this)&quot;>‚àí</button>
        <span class=&quot;minimized-icon&quot;>‚öôÔ∏è</span>
    </div>
    <div class=&quot;control-content&quot;>
    
    <div class=&quot;input-group&quot;>
        <label>Division/Location:</label>
        <input type=&quot;text&quot; id=&quot;locationInput&quot; value=&quot;Nawada&quot; placeholder=&quot;e.g. RAJAULI&quot;>
    </div>

    <div class=&quot;mode-toggle&quot;>
        <label>
            <input type=&quot;radio&quot; name=&quot;genMode&quot; value=&quot;quantity&quot; onchange=&quot;toggleMode()&quot; checked> 
            <strong>Quantity Only</strong>
        </label>
        <label>
            <input type=&quot;radio&quot; name=&quot;genMode&quot; value=&quot;list&quot; onchange=&quot;toggleMode()&quot;> 
            <strong>Road Name List</strong>
        </label>
    </div>

    <div id=&quot;quantityBox&quot; class=&quot;input-group&quot;>
        <label>Quantity (No. of Reports):</label>
        <input type=&quot;number&quot; id=&quot;reportCount&quot; value=&quot;10&quot;>
    </div>

    <div id=&quot;listBox&quot; class=&quot;input-group hidden&quot;>
        <label>Paste Road Names Below:</label>
        <div class=&quot;list-editor-container&quot;>
            <div class=&quot;line-numbers&quot; id=&quot;lineNumbers&quot;>1</div>
            <textarea id=&quot;roadListInput&quot; class=&quot;road-list-area&quot; placeholder=&quot;Paste list here...&quot; oninput=&quot;updateLineNumbers()&quot; onscroll=&quot;syncScroll()&quot;></textarea>
        </div>
        <div style=&quot;font-size: 11px; color: #666; text-align: right;&quot;>Total Roads: <span id=&quot;roadCountDisplay&quot;>0</span></div>
    </div>

    <div class=&quot;input-group&quot;>
        <label>Min Weight (gm):</label>
        <input type=&quot;number&quot; id=&quot;minRange&quot; value=&quot;9500&quot;>
    </div>
    
    <div class=&quot;input-group&quot;>
        <label>Max Weight (gm):</label>
        <input type=&quot;number&quot; id=&quot;maxRange&quot; value=&quot;10000&quot;>
    </div>

    <button class=&quot;btn magic-btn&quot; onclick=&quot;generateBulkReports()&quot;>‚ö° GENERATE BULK</button>
    <button class=&quot;btn print-btn&quot; onclick=&quot;window.print()&quot;>PRINT ALL üñ®Ô∏è</button>
    <button class=&quot;btn clear-btn&quot; onclick=&quot;location.reload()&quot;>RESET</button>
    </div></div>

<div id=&quot;main-output-area&quot;>
    <div class=&quot;report-container template-report&quot;>
        <div class=&quot;header&quot;>
            <h2>RURAL WORKS DEPARTMENT</h2>
            <h3>Testing and Quality Control Laboratory, <span class=&quot;editable location-placeholder&quot; contenteditable=&quot;true&quot;>Nawada</span></h3>
        </div>
        <div class=&quot;title&quot;>GRADATION TEST OF (SDBC)</div>
        
        <table class=&quot;info-table&quot;>
            <tr>
                <td width=&quot;60%&quot;><strong>NAME OF ROAD :-</strong> <span class=&quot;editable road-name-field&quot; contenteditable=&quot;true&quot;></span></td>
                <td width=&quot;40%&quot;><strong>DATE OF COLLECTION/RECEIPT:-</strong> <span class=&quot;editable&quot; contenteditable=&quot;true&quot;></span></td>
            </tr>
            <tr>
                <td><strong>NAME OF WORKS DIVISION:-</strong> <span class=&quot;editable&quot; contenteditable=&quot;true&quot;>R.W.D WORKS DIVISION KAWAKOL</span></td>
                <td><strong>DATE OF TEST:-</strong> <span class=&quot;editable&quot; contenteditable=&quot;true&quot;></span></td>
            </tr>
            <tr>
                <td><strong>NAME OF AGENCY :-</strong> <span class=&quot;editable&quot; contenteditable=&quot;true&quot;></span></td>
                <td><strong>PACKAGE NO:-</strong> <span class=&quot;editable&quot; contenteditable=&quot;true&quot;></span></td>
            </tr>
            <tr>
                <td colspan=&quot;2&quot;><strong>AGREEMENT NO:-</strong> <span class=&quot;editable&quot; contenteditable=&quot;true&quot;></span></td>
            </tr>
            <tr>
                <td colspan=&quot;2&quot;>
                    <strong>Ref:-</strong> <span class=&quot;editable&quot; contenteditable=&quot;true&quot;>A.E, R.W.D WORKS SUB DIV</span>
                    <span style=&quot;margin-left: 30px;&quot;><strong>Chainage:-</strong> <span class=&quot;editable&quot; contenteditable=&quot;true&quot;>0.210 km</span></span>
                </td>
            </tr>
            <tr>
                <td colspan=&quot;2&quot; style=&quot;padding-top: 10px;&quot;>
                    <strong>LT NO:-</strong> <span class=&quot;editable&quot; contenteditable=&quot;true&quot; style=&quot;min-width: 80px; display: inline-block;&quot;></span> 
                    <span style=&quot;margin-left: 50px;&quot;><strong>DT:-</strong> <span class=&quot;editable&quot; contenteditable=&quot;true&quot; style=&quot;min-width: 80px; display: inline-block;&quot;></span></span>
                    <span style=&quot;margin-left: 50px;&quot;><strong>Sample Wt:-</strong> <input type=&quot;number&quot; class=&quot;wt-input manualSampleWt&quot; value=&quot;9700&quot; oninput=&quot;calculate(this.closest(&#39;.report-container&#39;))&quot;>gm</span>
                </td>
            </tr>
        </table>
        
        <table class=&quot;data-table&quot;>
            <thead>
                <tr>
                    <th width=&quot;8%&quot;>SL. NO</th>
                    <th width=&quot;15%&quot;>Sieve No.<br>mm</th>
                    <th width=&quot;15%&quot;>Weight Retained<br>(gm)</th>
                    <th width=&quot;12%&quot;>% Wt. Of<br>Retained</th>
                    <th width=&quot;15%&quot;>Cumulative %<br>Retained</th>
                    <th width=&quot;12%&quot;>% Of Passing</th>
                    <th width=&quot;13%&quot;>Required<br>Limit %</th>
                    <th>Remarks</th>
                </tr>
            </thead>
            <tbody class=&quot;calcTable&quot;>
                <tr data-min=&quot;100&quot; data-max=&quot;100&quot;><td>1</td><td>13.2 mm</td><td><input type=&quot;number&quot; class=&quot;tbl-input weight-input&quot; oninput=&quot;calculate(this.closest(&#39;.report-container&#39;))&quot;></td><td class=&quot;res-pct&quot;></td><td class=&quot;res-cum&quot;></td><td class=&quot;res-pass&quot;></td><td>100</td><td><input type=&quot;text&quot; class=&quot;tbl-input&quot;></td></tr>
                <tr data-min=&quot;90&quot; data-max=&quot;100&quot;><td>2</td><td>9.5 mm</td><td><input type=&quot;number&quot; class=&quot;tbl-input weight-input&quot; oninput=&quot;calculate(this.closest(&#39;.report-container&#39;))&quot;></td><td class=&quot;res-pct&quot;></td><td class=&quot;res-cum&quot;></td><td class=&quot;res-pass&quot;></td><td>90-100</td><td><input type=&quot;text&quot; class=&quot;tbl-input&quot;></td></tr>
                <tr data-min=&quot;35&quot; data-max=&quot;51&quot;><td>3</td><td>4.75 mm</td><td><input type=&quot;number&quot; class=&quot;tbl-input weight-input&quot; oninput=&quot;calculate(this.closest(&#39;.report-container&#39;))&quot;></td><td class=&quot;res-pct&quot;></td><td class=&quot;res-cum&quot;></td><td class=&quot;res-pass&quot;></td><td>35-51</td><td><input type=&quot;text&quot; class=&quot;tbl-input&quot;></td></tr>
                <tr data-min=&quot;24&quot; data-max=&quot;39&quot;><td>4</td><td>2.36 mm</td><td><input type=&quot;number&quot; class=&quot;tbl-input weight-input&quot; oninput=&quot;calculate(this.closest(&#39;.report-container&#39;))&quot;></td><td class=&quot;res-pct&quot;></td><td class=&quot;res-cum&quot;></td><td class=&quot;res-pass&quot;></td><td>24-39</td><td><input type=&quot;text&quot; class=&quot;tbl-input&quot;></td></tr>
                <tr data-min=&quot;15&quot; data-max=&quot;30&quot;><td>5</td><td>1.18 mm</td><td><input type=&quot;number&quot; class=&quot;tbl-input weight-input&quot; oninput=&quot;calculate(this.closest(&#39;.report-container&#39;))&quot;></td><td class=&quot;res-pct&quot;></td><td class=&quot;res-cum&quot;></td><td class=&quot;res-pass&quot;></td><td>15-30</td><td><input type=&quot;text&quot; class=&quot;tbl-input&quot;></td></tr>
                <tr data-min=&quot;9&quot; data-max=&quot;19&quot;><td>6</td><td>300 mic</td><td><input type=&quot;number&quot; class=&quot;tbl-input weight-input&quot; oninput=&quot;calculate(this.closest(&#39;.report-container&#39;))&quot;></td><td class=&quot;res-pct&quot;></td><td class=&quot;res-cum&quot;></td><td class=&quot;res-pass&quot;></td><td>9-19</td><td><input type=&quot;text&quot; class=&quot;tbl-input&quot;></td></tr>
                <tr data-min=&quot;3&quot; data-max=&quot;8&quot;><td>7</td><td>75 mic</td><td><input type=&quot;number&quot; class=&quot;tbl-input weight-input&quot; oninput=&quot;calculate(this.closest(&#39;.report-container&#39;))&quot;></td><td class=&quot;res-pct&quot;></td><td class=&quot;res-cum&quot;></td><td class=&quot;res-pass&quot;></td><td>3-8</td><td><input type=&quot;text&quot; class=&quot;tbl-input&quot;></td></tr>
                <tr><td>8</td><td>PAN</td><td><input type=&quot;number&quot; class=&quot;tbl-input weight-input&quot; oninput=&quot;calculate(this.closest(&#39;.report-container&#39;))&quot;></td><td class=&quot;res-pct&quot;></td><td class=&quot;res-cum&quot;></td><td class=&quot;res-pass&quot;></td><td>-</td><td><input type=&quot;text&quot; class=&quot;tbl-input&quot;></td></tr>
                <tr style=&quot;font-weight: bold;&quot;>
                    <td></td><td>Total Wt.</td><td class=&quot;totalWtDisplay&quot;></td><td colspan=&quot;5&quot;></td>
                </tr>
            </tbody>
        </table>
        
        <div class=&quot;footer-section&quot;>
            <p>
                <strong>Memo No:</strong> <span class=&quot;editable&quot; contenteditable=&quot;true&quot; style=&quot;min-width: 100px; display: inline-block;&quot;></span>
                <span style=&quot;float:right;&quot;><strong>Date:</strong> <span class=&quot;editable&quot; contenteditable=&quot;true&quot; style=&quot;min-width: 100px; display: inline-block;&quot;></span></span>
            </p>
            <p><strong>Copy Forwarded to:-</strong> <span class=&quot;editable&quot; contenteditable=&quot;true&quot;>Executive Engineer, R.W.D, Works Division, <span class=&quot;location-placeholder&quot;>Nawada</span></span></p>
            <div class=&quot;signature-row&quot;>
                <div class=&quot;signature-box&quot;><br><br><strong>T.S.</strong></div>
                <div class=&quot;signature-box&quot;>
                    <br><br>
                    <strong>A.E.</strong><br>
                    R.W.D, Testing and Quality Control Laboratory,<br>
                    <span class=&quot;editable location-placeholder&quot; contenteditable=&quot;true&quot;>Nawada</span>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // Toggle between Quantity Input and List Input
    function toggleMode() {
        const mode = document.querySelector(&#39;input[name=&quot;genMode&quot;]:checked&#39;).value;
        const qtyBox = document.getElementById(&#39;quantityBox&#39;);
        const listBox = document.getElementById(&#39;listBox&#39;);
        
        if (mode === &#39;quantity&#39;) {
            qtyBox.classList.remove(&#39;hidden&#39;);
            listBox.classList.add(&#39;hidden&#39;);
        } else {
            qtyBox.classList.add(&#39;hidden&#39;);
            listBox.classList.remove(&#39;hidden&#39;);
        }
    }

    // Line Numbers Logic
    function updateLineNumbers() {
        const textarea = document.getElementById(&#39;roadListInput&#39;);
        const lines = textarea.value.split(&#39;\n&#39;).length;
        const lineNumbersElem = document.getElementById(&#39;lineNumbers&#39;);
        
        let numbersHTML = &#39;&#39;;
        for (let i = 1; i <= lines; i++) {
            numbersHTML += i + &#39;<br>&#39;;
        }
        lineNumbersElem.innerHTML = numbersHTML;
        
        // Update Total Count display
        const nonEmptyLines = textarea.value.split(&#39;\n&#39;).filter(line => line.trim() !== &quot;&quot;).length;
        document.getElementById(&#39;roadCountDisplay&#39;).innerText = nonEmptyLines;
    }

    function syncScroll() {
        const textarea = document.getElementById(&#39;roadListInput&#39;);
        const lineNumbersElem = document.getElementById(&#39;lineNumbers&#39;);
        lineNumbersElem.scrollTop = textarea.scrollTop;
    }

    function generateBulkReports() {
        const minWt = parseFloat(document.getElementById(&#39;minRange&#39;).value);
        const maxWt = parseFloat(document.getElementById(&#39;maxRange&#39;).value);
        const locName = document.getElementById(&#39;locationInput&#39;).value || &quot;Nawada&quot;;
        
        if (!minWt || !maxWt) {
            alert(&quot;Please enter Min and Max Weight.&quot;);
            return;
        }

        // Determine Mode
        const mode = document.querySelector(&#39;input[name=&quot;genMode&quot;]:checked&#39;).value;
        let reportsToGenerate = []; 

        if (mode === &#39;quantity&#39;) {
            const count = parseInt(document.getElementById(&#39;reportCount&#39;).value);
            if (!count) { alert(&quot;Please enter Quantity.&quot;); return; }
            for(let i=0; i<count; i++) {
                reportsToGenerate.push({ roadName: &quot;&quot; }); 
            }
        } else {
            // List Mode
            const listText = document.getElementById(&#39;roadListInput&#39;).value;
            const lines = listText.split(&#39;\n&#39;);
            
            lines.forEach(line => {
                if(line.trim() !== &quot;&quot;) {
                    reportsToGenerate.push({ roadName: line.trim() });
                }
            });
            
            if (reportsToGenerate.length === 0) {
                alert(&quot;Please paste at least one road name in the list.&quot;);
                return;
            }
        }

        const container = document.getElementById(&#39;main-output-area&#39;);
        const template = container.querySelector(&#39;.template-report&#39;).cloneNode(true);
        container.innerHTML = &#39;&#39;;

        reportsToGenerate.forEach(item => {
            let newReport = template.cloneNode(true);
            
            // Random Weight
            let randomSampleWt = Math.floor(Math.random() * (maxWt - minWt + 1)) + minWt;
            newReport.querySelector(&#39;.manualSampleWt&#39;).value = randomSampleWt;

            // Update Location
            newReport.querySelectorAll(&#39;.location-placeholder&#39;).forEach(span => {
                span.innerText = locName;
            });
            
            // Update Road Name
            if (item.roadName) {
                newReport.querySelector(&#39;.road-name-field&#39;).innerText = item.roadName;
            }

            container.appendChild(newReport);
            autoFillWeights(newReport, randomSampleWt);
        });
    }

    function autoFillWeights(reportElement, sampleWt) {
        if (!sampleWt) sampleWt = parseFloat(reportElement.querySelector(&#39;.manualSampleWt&#39;).value);
        
        const rows = reportElement.querySelectorAll(&#39;.calcTable tr[data-min]&#39;);
        let currentPassing = 100; 
        let accumulatedWeight = 0;
        
        rows.forEach((row) => {
            const minLim = parseFloat(row.getAttribute(&#39;data-min&#39;));
            const maxLim = parseFloat(row.getAttribute(&#39;data-max&#39;));
            let effectiveMax = Math.min(maxLim, currentPassing);
            let effectiveMin = minLim;
            if (effectiveMin > effectiveMax) effectiveMin = effectiveMax; 
            
            let randomPassing = (Math.random() * (effectiveMax - effectiveMin)) + effectiveMin;
            randomPassing = Math.round(randomPassing * 100) / 100;
            
            let targetCumWeight = ((100 - randomPassing) / 100) * sampleWt;
            let individualWeight = Math.round(targetCumWeight - accumulatedWeight);
            if (individualWeight < 0) individualWeight = 0;
            
            row.querySelector(&#39;.weight-input&#39;).value = individualWeight;
            accumulatedWeight += individualWeight;
            
            currentPassing = 100 - ((accumulatedWeight / sampleWt) * 100);
        });
        
        // Handle PAN (last row before Total)
        const panRow = reportElement.querySelector(&#39;.calcTable tr:nth-last-child(2)&#39;);
        let panWeight = Math.max(0, sampleWt - accumulatedWeight);
        panRow.querySelector(&#39;.weight-input&#39;).value = panWeight;
        
        calculate(reportElement);
    }

    function calculate(reportElement) {
        if (!reportElement) return;
        const rows = reportElement.querySelectorAll(&#39;.calcTable tr&#39;);
        let totalSumWeight = 0;
        let manualSampleWt = parseFloat(reportElement.querySelector(&#39;.manualSampleWt&#39;).value);
        
        rows.forEach((row, index) => {
            if (index < rows.length - 1) {
                const input = row.querySelector(&#39;.weight-input&#39;);
                if (input) {
                    const val = parseFloat(input.value);
                    if (!isNaN(val)) totalSumWeight += val;
                }
            }
        });
        
        const totalDisp = reportElement.querySelector(&#39;.totalWtDisplay&#39;);
        if(totalDisp) totalDisp.innerText = totalSumWeight > 0 ? totalSumWeight.toFixed(0) : &quot;&quot;;
        
        let divisor = manualSampleWt > 0 ? manualSampleWt : totalSumWeight;
        let cumulativePct = 0;
        
        rows.forEach((row, index) => {
            if (index < rows.length - 1) {
                const input = row.querySelector(&#39;.weight-input&#39;);
                if (input) {
                    const weight = parseFloat(input.value) || 0;
                    if (divisor > 0) {
                        let pctRetained = (weight / divisor) * 100;
                        cumulativePct += pctRetained;
                        let passing = Math.max(0, Math.min(100, 100 - cumulativePct));
                        
                        row.querySelector(&#39;.res-pct&#39;).innerText = pctRetained.toFixed(2);
                        row.querySelector(&#39;.res-cum&#39;).innerText = cumulativePct.toFixed(2);
                        row.querySelector(&#39;.res-pass&#39;).innerText = passing.toFixed(2);
                    }
                }
            }
        });
    }

    // ========== DRAGGABLE CONTROLS (MOBILE FIXED) ==========
    (function() {
        let isDragging = false;
        let currentPanel = null;
        let offsetX = 0;
        let offsetY = 0;
        let startX = 0;
        let startY = 0;
        let hasMoved = false;

        document.querySelectorAll('.drag-handle').forEach(handle => {
            handle.addEventListener('touchstart', handleTouchStart, { passive: false });
            handle.addEventListener('mousedown', handleMouseStart);
        });

        function handleTouchStart(e) {
            const panel = e.target.closest('.action-btn-container') || e.target.closest('.controls');
            if (!panel) return;
            
            if (panel.classList.contains('minimized')) {
                toggleMinimize(e.target);
                return;
            }
            
            const touch = e.touches[0];
            startX = touch.clientX;
            startY = touch.clientY;
            
            const rect = panel.getBoundingClientRect();
            offsetX = touch.clientX - rect.left;
            offsetY = touch.clientY - rect.top;
            
            isDragging = true;
            currentPanel = panel;
            hasMoved = false;
            
            panel.style.transition = 'none';
            
            document.addEventListener('touchmove', handleTouchMove, { passive: false });
            document.addEventListener('touchend', handleTouchEnd);
        }

        function handleMouseStart(e) {
            const panel = e.target.closest('.action-btn-container') || e.target.closest('.controls');
            if (!panel) return;
            
            if (panel.classList.contains('minimized')) {
                toggleMinimize(e.target);
                return;
            }
            
            startX = e.clientX;
            startY = e.clientY;
            
            const rect = panel.getBoundingClientRect();
            offsetX = e.clientX - rect.left;
            offsetY = e.clientY - rect.top;
            
            isDragging = true;
            currentPanel = panel;
            hasMoved = false;
            
            panel.style.transition = 'none';
            
            document.addEventListener('mousemove', handleMouseMove);
            document.addEventListener('mouseup', handleMouseEnd);
        }

        function handleTouchMove(e) {
            if (!isDragging || !currentPanel) return;
            
            const touch = e.touches[0];
            const deltaX = Math.abs(touch.clientX - startX);
            const deltaY = Math.abs(touch.clientY - startY);
            
            // Only drag if moved more than 5px
            if (deltaX > 5 || deltaY > 5) {
                hasMoved = true;
                
                let newX = touch.clientX - offsetX;
                let newY = touch.clientY - offsetY;
                
                const maxX = window.innerWidth - currentPanel.offsetWidth;
                const maxY = window.innerHeight - currentPanel.offsetHeight;
                
                newX = Math.max(0, Math.min(newX, maxX));
                newY = Math.max(0, Math.min(newY, maxY));
                
                currentPanel.style.left = newX + 'px';
                currentPanel.style.top = newY + 'px';
                currentPanel.style.right = 'auto';
                
                e.preventDefault();
            }
        }

        function handleMouseMove(e) {
            if (!isDragging || !currentPanel) return;
            
            const deltaX = Math.abs(e.clientX - startX);
            const deltaY = Math.abs(e.clientY - startY);
            
            if (deltaX > 5 || deltaY > 5) {
                hasMoved = true;
                
                let newX = e.clientX - offsetX;
                let newY = e.clientY - offsetY;
                
                const maxX = window.innerWidth - currentPanel.offsetWidth;
                const maxY = window.innerHeight - currentPanel.offsetHeight;
                
                newX = Math.max(0, Math.min(newX, maxX));
                newY = Math.max(0, Math.min(newY, maxY));
                
                currentPanel.style.left = newX + 'px';
                currentPanel.style.top = newY + 'px';
                currentPanel.style.right = 'auto';
            }
        }

        function handleTouchEnd() {
            if (isDragging && currentPanel) {
                currentPanel.style.transition = 'all 0.3s ease';
            }
            isDragging = false;
            currentPanel = null;
            
            document.removeEventListener('touchmove', handleTouchMove);
            document.removeEventListener('touchend', handleTouchEnd);
        }

        function handleMouseEnd() {
            if (isDragging && currentPanel) {
                currentPanel.style.transition = 'all 0.3s ease';
            }
            isDragging = false;
            currentPanel = null;
            
            document.removeEventListener('mousemove', handleMouseMove);
            document.removeEventListener('mouseup', handleMouseEnd);
        }

        window.toggleMinimize = function(btn) {
            const panel = btn.closest('.action-btn-container') || btn.closest('.controls');
            if (!panel) return;
            panel.classList.toggle('minimized');
        };
    })();

</script>
</body>
</html>"
            style="width: 100%; height: calc(100vh - 160px); border: none; display: block;"
            sandbox="allow-scripts allow-same-origin allow-forms allow-modals"
        ></iframe>
    </div>

    <!-- WBM-II Gradation TEST -->
    <div id="wbm_ii_gradation" class="test-wrapper">
        <iframe 
            srcdoc="<!DOCTYPE html>
<html lang=&quot;en&quot;>
<head>
    <meta charset=&quot;UTF-8&quot;>
    <meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;>
    <title>Bulk WBM Gr-2 Generator</title>
    <style>
        body { font-family: &quot;Times New Roman&quot;, Times, serif; margin: 0; padding: 20px; background-color: #f0f0f0; }
        
        /* Report Container Style */
        .report-container { 
            width: 210mm; 
            min-height: 297mm; 
            background-color: white; 
            margin: auto; 
            padding: 20px 40px; 
            box-shadow: 0 0 10px rgba(0,0,0,0.1); 
            box-sizing: border-box; 
            position: relative; 
            margin-bottom: 20px; 
        }
        
        .header { text-align: center; margin-bottom: 20px; }
        .header h2, .header h3 { margin: 5px 0; text-transform: uppercase; }
        .header h3 { font-size: 16px; font-weight: bold; }
        .title { text-align: center; font-weight: bold; text-decoration: underline; margin: 20px 0; font-size: 18px; }
        
        .info-table { width: 100%; margin-bottom: 20px; font-size: 14px; border-collapse: collapse; }
        .info-table td { padding: 5px 2px; vertical-align: top; border: none; line-height: 1.6; }
        
        .data-table { width: 100%; border-collapse: collapse; font-size: 13px; margin-bottom: 30px; text-align: center; }
        .data-table th, .data-table td { border: 1px solid black; padding: 5px; height: 30px; vertical-align: middle; }
        .data-table th { background-color: #f2f2f2; font-weight: bold; }
        
        .footer-section { margin-top: 50px; font-size: 14px; line-height: 1.6; }
        .signature-row { display: flex; justify-content: space-between; margin-top: 80px; align-items: flex-start; }
        .signature-box { text-align: center; width: 250px; }

        .editable {
            border-bottom: 1px dotted #999;
            outline: none;
            font-weight: bold;
            color: #000;
            display: inline; 
            min-width: 50px;
        }
        .editable:empty::before { content: &quot;\00a0\00a0\00a0\00a0\00a0\00a0\00a0\00a0&quot;; color: #ccc; }
        
        .tbl-input { width: 100%; border: none; text-align: center; font-family: inherit; font-size: inherit; background: transparent; outline: none; font-weight: bold; }
        .weight-input { background-color: #eef; } 
        
        .wt-input { 
            width: 70px; 
            text-align: right; 
            border: none; 
            border-bottom: 1px dotted #999; 
            font-family: inherit; 
            font-size: inherit; 
            font-weight: bold; 
            outline: none;
        }

        /* Control Panel Styles - DRAGGABLE */
        .action-btn-container {
            position: fixed; top: 20px; right: 20px; z-index: 9999;
            background: rgba(255, 255, 255, 0.98);
            padding: 0; border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            border: 1px solid #ccc; width: 260px;
            transition: all 0.3s ease;
        }
        .action-btn-container.minimized { width: 50px; height: 50px; border-radius: 50%; }
        .drag-handle {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white; padding: 10px; cursor: move;
            display: flex; justify-content: space-between; align-items: center;
            border-radius: 8px 8px 0 0; user-select: none; touch-action: none;
            -webkit-user-select: none;
            -webkit-touch-callout: none;
        }
        .minimized .drag-handle { border-radius: 50%; width: 50px; height: 50px; justify-content: center; padding: 0; }
        .drag-handle h4 { margin: 0; font-size: 14px; font-weight: bold; flex: 1; }
        .minimized .drag-handle h4 { display: none; }
        .minimize-btn {
            background: rgba(255,255,255,0.3); border: none; color: white;
            width: 24px; height: 24px; border-radius: 4px; cursor: pointer; font-size: 16px;
        }
        .minimized .minimize-btn { display: none; }
        .control-content { padding: 15px; max-height: calc(90vh - 44px); overflow-y: auto; }
        .minimized .control-content { display: none; }
        .minimized-icon { display: none; font-size: 24px; }
        .minimized .minimized-icon { display: block; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); }
        .action-btn-container h4 { margin: 0 0 10px 0; font-family: sans-serif; text-align: center; color: #333; border-bottom: 1px solid #ddd; padding-bottom: 5px; }
        
        .input-group { display: flex; flex-direction: column; margin-bottom: 8px; }
        .input-group label { font-size: 12px; font-family: sans-serif; font-weight: bold; margin-bottom: 3px; }
        .input-group input, .input-group select { padding: 5px; border: 1px solid #aaa; border-radius: 4px; }

        /* Toggle Switch Style */
        .mode-toggle { display: flex; align-items: center; margin-bottom: 10px; background: #eee; padding: 5px; border-radius: 5px; }
        .mode-toggle label { flex: 1; font-size: 12px; font-family: sans-serif; cursor: pointer; display: flex; align-items: center; }
        .mode-toggle input { margin-right: 5px; }

        /* List Editor Style with Line Numbers */
        .list-editor-container {
            display: flex;
            border: 1px solid #aaa;
            border-radius: 4px;
            height: 120px;
            font-family: monospace;
            font-size: 12px;
            background: white;
            margin-bottom: 8px;
        }
        .line-numbers {
            width: 25px;
            background-color: #f0f0f0;
            color: #888;
            text-align: right;
            padding: 5px 2px;
            border-right: 1px solid #ddd;
            line-height: 1.4;
            overflow: hidden;
            user-select: none;
        }
        .road-list-area {
            flex: 1;
            border: none;
            padding: 5px;
            line-height: 1.4;
            resize: none;
            outline: none;
            white-space: pre;
            overflow-y: scroll;
        }

        .hidden { display: none; }

        .btn { color: white; border: none; padding: 10px; font-size: 14px; font-weight: bold; cursor: pointer; border-radius: 5px; font-family: sans-serif; margin-top: 5px; transition: 0.2s; }
        .print-btn { background-color: #dc3545; }
        .magic-btn { background-color: #28a745; }
        .clear-btn { background-color: #6c757d; }
        .btn:hover { opacity: 0.9; transform: scale(1.02); }

        @media print { 
            body { background-color: white; padding: 0; } 
            .report-container { 
                box-shadow: none; margin: 0; width: 100%; 
                page-break-after: always; 
            } 
            .report-container:last-child { page-break-after: auto; }
            .action-btn-container { display: none; }
            .weight-input { background-color: transparent; }
            .editable, .wt-input, .tbl-input { border: none !important; } 
            .editable:empty::before { display: none; }
        }
        @media screen { .editable:hover { background-color: rgba(0, 0, 255, 0.05); cursor: text; } }
    </style>
</head>
<body>

<div class=&quot;action-btn-container&quot;>
    <div class=&quot;drag-handle&quot;>
        <h4>WBM Gr-II AI Control</h4>
        <button class=&quot;minimize-btn&quot; onclick=&quot;toggleMinimize(this)&quot;>‚àí</button>
        <span class=&quot;minimized-icon&quot;>‚öôÔ∏è</span>
    </div>
    <div class=&quot;control-content&quot;>
    
    <div class=&quot;input-group&quot;>
        <label>Division/Location:</label>
        <input type=&quot;text&quot; id=&quot;locationInput&quot; value=&quot;Nawada&quot; placeholder=&quot;e.g. RAJAULI&quot;>
    </div>

    <div class=&quot;mode-toggle&quot;>
        <label>
            <input type=&quot;radio&quot; name=&quot;genMode&quot; value=&quot;quantity&quot; onchange=&quot;toggleMode()&quot; checked> 
            <strong>Quantity Only</strong>
        </label>
        <label>
            <input type=&quot;radio&quot; name=&quot;genMode&quot; value=&quot;list&quot; onchange=&quot;toggleMode()&quot;> 
            <strong>Road Name List</strong>
        </label>
    </div>

    <div id=&quot;quantityBox&quot; class=&quot;input-group&quot;>
        <label>Quantity (No. of Reports):</label>
        <input type=&quot;number&quot; id=&quot;reportCount&quot; value=&quot;10&quot;>
    </div>

    <div id=&quot;listBox&quot; class=&quot;input-group hidden&quot;>
        <label>Paste Road Names Below:</label>
        <div class=&quot;list-editor-container&quot;>
            <div class=&quot;line-numbers&quot; id=&quot;lineNumbers&quot;>1</div>
            <textarea id=&quot;roadListInput&quot; class=&quot;road-list-area&quot; placeholder=&quot;Paste list here...&quot; oninput=&quot;updateLineNumbers()&quot; onscroll=&quot;syncScroll()&quot;></textarea>
        </div>
        <div style=&quot;font-size: 11px; color: #666; text-align: right;&quot;>Total Roads: <span id=&quot;roadCountDisplay&quot;>0</span></div>
    </div>

    <div class=&quot;input-group&quot;>
        <label>Min Weight (gm):</label>
        <input type=&quot;number&quot; id=&quot;minRange&quot; value=&quot;29000&quot;>
    </div>
    
    <div class=&quot;input-group&quot;>
        <label>Max Weight (gm):</label>
        <input type=&quot;number&quot; id=&quot;maxRange&quot; value=&quot;31000&quot;>
    </div>

    <button class=&quot;btn magic-btn&quot; onclick=&quot;generateBulkReports()&quot;>‚ö° GENERATE BULK</button>
    <button class=&quot;btn print-btn&quot; onclick=&quot;window.print()&quot;>PRINT ALL üñ®Ô∏è</button>
    <button class=&quot;btn clear-btn&quot; onclick=&quot;location.reload()&quot;>RESET</button>
    </div></div>

<div id=&quot;main-output-area&quot;>
    <div class=&quot;report-container template-report&quot;>
        <div class=&quot;header&quot;>
            <h2>RURAL WORKS DEPARTMENT</h2>
            <h3>Testing and Quality Control Laboratory, <span class=&quot;editable location-placeholder&quot; contenteditable=&quot;true&quot;>Nawada</span></h3>
        </div>
        <div class=&quot;title&quot;>GRADATION TEST OF (WBM-Gr-II)</div>
        
        <table class=&quot;info-table&quot;>
            <tr>
                <td width=&quot;60%&quot;><strong>NAME OF ROAD :-</strong> <span class=&quot;editable road-name-field&quot; contenteditable=&quot;true&quot;></span></td>
                <td width=&quot;40%&quot;><strong>DATE OF COLLECTION/RECEIPT:-</strong> <span class=&quot;editable&quot; contenteditable=&quot;true&quot;></span></td>
            </tr>
            <tr>
                <td><strong>NAME OF WORKS DIVISION:-</strong> <span class=&quot;editable&quot; contenteditable=&quot;true&quot;>R.W.D WORKS DIVISION</span></td>
                <td><strong>DATE OF TEST:-</strong> <span class=&quot;editable&quot; contenteditable=&quot;true&quot;></span></td>
            </tr>
            <tr>
                <td><strong>NAME OF AGENCY :-</strong> <span class=&quot;editable&quot; contenteditable=&quot;true&quot;></span></td>
                <td><strong>PACKAGE NO:-</strong> <span class=&quot;editable&quot; contenteditable=&quot;true&quot;></span></td>
            </tr>
            <tr>
                <td colspan=&quot;2&quot;><strong>AGREEMENT NO:-</strong> <span class=&quot;editable&quot; contenteditable=&quot;true&quot;></span></td>
            </tr>
            <tr>
                <td colspan=&quot;2&quot;>
                    <strong>Ref:-</strong> <span class=&quot;editable&quot; contenteditable=&quot;true&quot;>A.E, R.W.D WORKS SUB DIV-</span>
                    <span style=&quot;margin-left: 30px;&quot;><strong>Chainage:-</strong> <span class=&quot;editable&quot; contenteditable=&quot;true&quot;></span></span>
                </td>
            </tr>
            <tr>
                <td colspan=&quot;2&quot; style=&quot;padding-top: 10px;&quot;>
                    <strong>LT NO:-</strong> <span class=&quot;editable&quot; contenteditable=&quot;true&quot; style=&quot;min-width: 80px; display: inline-block;&quot;></span> 
                    <span style=&quot;margin-left: 50px;&quot;><strong>DT:-</strong> <span class=&quot;editable&quot; contenteditable=&quot;true&quot; style=&quot;min-width: 80px; display: inline-block;&quot;></span></span>
                    <span style=&quot;margin-left: 50px;&quot;><strong>Sample Wt:-</strong> <input type=&quot;number&quot; class=&quot;wt-input manualSampleWt&quot; value=&quot;30000&quot; oninput=&quot;calculate(this.closest(&#39;.report-container&#39;))&quot;>gm</span>
                </td>
            </tr>
        </table>
        
        <table class=&quot;data-table&quot;>
            <thead>
                <tr>
                    <th>SL. NO</th>
                    <th>Sieve No.<br>mm</th>
                    <th>Weight Retained<br>(gm)</th>
                    <th>% Wt. Of<br>Retained</th>
                    <th>Cumulative %<br>Retained</th>
                    <th>% Of Passing</th>
                    <th>Permissible<br>Value %</th>
                    <th>Remarks</th>
                </tr>
            </thead>
            <tbody class=&quot;calcTable&quot;>
                <tr data-min=&quot;100&quot; data-max=&quot;100&quot;><td>1</td><td>90 MM</td><td><input type=&quot;number&quot; class=&quot;tbl-input weight-input&quot; oninput=&quot;calculate(this.closest(&#39;.report-container&#39;))&quot;></td><td class=&quot;res-pct&quot;></td><td class=&quot;res-cum&quot;></td><td class=&quot;res-pass&quot;></td><td>100</td><td><input type=&quot;text&quot; class=&quot;tbl-input&quot;></td></tr>
                <tr data-min=&quot;90&quot; data-max=&quot;100&quot;><td>2</td><td>63 MM</td><td><input type=&quot;number&quot; class=&quot;tbl-input weight-input&quot; oninput=&quot;calculate(this.closest(&#39;.report-container&#39;))&quot;></td><td class=&quot;res-pct&quot;></td><td class=&quot;res-cum&quot;></td><td class=&quot;res-pass&quot;></td><td>90-100</td><td><input type=&quot;text&quot; class=&quot;tbl-input&quot;></td></tr>
                <tr data-min=&quot;25&quot; data-max=&quot;75&quot;><td>3</td><td>45 MM</td><td><input type=&quot;number&quot; class=&quot;tbl-input weight-input&quot; oninput=&quot;calculate(this.closest(&#39;.report-container&#39;))&quot;></td><td class=&quot;res-pct&quot;></td><td class=&quot;res-cum&quot;></td><td class=&quot;res-pass&quot;></td><td>25-75</td><td><input type=&quot;text&quot; class=&quot;tbl-input&quot;></td></tr>
                <tr data-min=&quot;0&quot; data-max=&quot;15&quot;><td>4</td><td>22.4 MM</td><td><input type=&quot;number&quot; class=&quot;tbl-input weight-input&quot; oninput=&quot;calculate(this.closest(&#39;.report-container&#39;))&quot;></td><td class=&quot;res-pct&quot;></td><td class=&quot;res-cum&quot;></td><td class=&quot;res-pass&quot;></td><td>0-15</td><td><input type=&quot;text&quot; class=&quot;tbl-input&quot;></td></tr>
                <tr data-min=&quot;0&quot; data-max=&quot;5&quot;><td>5</td><td>11.2 MM</td><td><input type=&quot;number&quot; class=&quot;tbl-input weight-input&quot; oninput=&quot;calculate(this.closest(&#39;.report-container&#39;))&quot;></td><td class=&quot;res-pct&quot;></td><td class=&quot;res-cum&quot;></td><td class=&quot;res-pass&quot;></td><td>0-5</td><td><input type=&quot;text&quot; class=&quot;tbl-input&quot;></td></tr>
                <tr class=&quot;pan-row&quot;><td>6</td><td>PAN</td><td><input type=&quot;number&quot; class=&quot;tbl-input weight-input&quot; oninput=&quot;calculate(this.closest(&#39;.report-container&#39;))&quot;></td><td class=&quot;res-pct&quot;></td><td class=&quot;res-cum&quot;></td><td class=&quot;res-pass&quot;></td><td></td><td><input type=&quot;text&quot; class=&quot;tbl-input&quot;></td></tr>
                <tr style=&quot;font-weight: bold;&quot;>
                    <td></td><td>Total Wt.</td><td class=&quot;totalWtDisplay&quot;></td><td colspan=&quot;5&quot;></td>
                </tr>
            </tbody>
        </table>
        
        <div class=&quot;footer-section&quot;>
            <p>
                <strong>Memo No:</strong> <span class=&quot;editable&quot; contenteditable=&quot;true&quot; style=&quot;min-width: 100px; display: inline-block;&quot;></span>
                <span style=&quot;float:right;&quot;><strong>Date:</strong> <span class=&quot;editable&quot; contenteditable=&quot;true&quot; style=&quot;min-width: 100px; display: inline-block;&quot;></span></span>
            </p>
            <p><strong>Copy Forwarded to:-</strong> Executive Engineer, R.W.D, Works Division, <span class=&quot;editable location-placeholder&quot; contenteditable=&quot;true&quot;>Nawada</span></p>
            <div class=&quot;signature-row&quot;>
                <div class=&quot;signature-box&quot;><br><br><strong>T.S.</strong></div>
                <div class=&quot;signature-box&quot;>
                    <br><br><strong>A.E.</strong><br>
                    R.W.D, Testing and Quality Control Laboratory,<br>
                    <span class=&quot;editable location-placeholder&quot; contenteditable=&quot;true&quot;>Nawada</span>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // Toggle Logic
    function toggleMode() {
        const mode = document.querySelector(&#39;input[name=&quot;genMode&quot;]:checked&#39;).value;
        const qtyBox = document.getElementById(&#39;quantityBox&#39;);
        const listBox = document.getElementById(&#39;listBox&#39;);
        
        if (mode === &#39;quantity&#39;) {
            qtyBox.classList.remove(&#39;hidden&#39;);
            listBox.classList.add(&#39;hidden&#39;);
        } else {
            qtyBox.classList.add(&#39;hidden&#39;);
            listBox.classList.remove(&#39;hidden&#39;);
        }
    }

    // Line Numbers & Sync Scroll
    function updateLineNumbers() {
        const textarea = document.getElementById(&#39;roadListInput&#39;);
        const lines = textarea.value.split(&#39;\n&#39;).length;
        const lineNumbersElem = document.getElementById(&#39;lineNumbers&#39;);
        
        let numbersHTML = &#39;&#39;;
        for (let i = 1; i <= lines; i++) {
            numbersHTML += i + &#39;<br>&#39;;
        }
        lineNumbersElem.innerHTML = numbersHTML;
        
        const nonEmptyLines = textarea.value.split(&#39;\n&#39;).filter(line => line.trim() !== &quot;&quot;).length;
        document.getElementById(&#39;roadCountDisplay&#39;).innerText = nonEmptyLines;
    }

    function syncScroll() {
        const textarea = document.getElementById(&#39;roadListInput&#39;);
        const lineNumbersElem = document.getElementById(&#39;lineNumbers&#39;);
        lineNumbersElem.scrollTop = textarea.scrollTop;
    }

    function generateBulkReports() {
        const minWt = parseFloat(document.getElementById(&#39;minRange&#39;).value);
        const maxWt = parseFloat(document.getElementById(&#39;maxRange&#39;).value);
        const locName = document.getElementById(&#39;locationInput&#39;).value || &quot;Nawada&quot;;
        
        if (!minWt || !maxWt) {
            alert(&quot;Please enter Min and Max Weight.&quot;);
            return;
        }

        // Determine Mode
        const mode = document.querySelector(&#39;input[name=&quot;genMode&quot;]:checked&#39;).value;
        let reportsToGenerate = []; 

        if (mode === &#39;quantity&#39;) {
            const count = parseInt(document.getElementById(&#39;reportCount&#39;).value);
            if (!count) { alert(&quot;Please enter Quantity.&quot;); return; }
            for(let i=0; i<count; i++) {
                reportsToGenerate.push({ roadName: &quot;&quot; }); 
            }
        } else {
            // List Mode
            const listText = document.getElementById(&#39;roadListInput&#39;).value;
            const lines = listText.split(&#39;\n&#39;);
            
            lines.forEach(line => {
                if(line.trim() !== &quot;&quot;) {
                    reportsToGenerate.push({ roadName: line.trim() });
                }
            });
            
            if (reportsToGenerate.length === 0) {
                alert(&quot;Please paste at least one road name in the list.&quot;);
                return;
            }
        }

        const container = document.getElementById(&#39;main-output-area&#39;);
        const template = container.querySelector(&#39;.template-report&#39;).cloneNode(true);
        container.innerHTML = &#39;&#39;;

        reportsToGenerate.forEach(item => {
            let newReport = template.cloneNode(true);
            
            // Random Weight
            let randomSampleWt = Math.floor(Math.random() * (maxWt - minWt + 1)) + minWt;
            newReport.querySelector(&#39;.manualSampleWt&#39;).value = randomSampleWt;

            // Update Location
            newReport.querySelectorAll(&#39;.location-placeholder&#39;).forEach(span => {
                span.innerText = locName;
            });

            // Update Road Name
            if (item.roadName) {
                newReport.querySelector(&#39;.road-name-field&#39;).innerText = item.roadName;
            }
            
            container.appendChild(newReport);
            autoFillWeights(newReport, randomSampleWt);
        });
    }

    function autoFillWeights(reportElement, sampleWt) {
        if (!sampleWt) sampleWt = parseFloat(reportElement.querySelector(&#39;.manualSampleWt&#39;).value);
        
        const rows = reportElement.querySelectorAll(&#39;.calcTable tr[data-min]&#39;);
        let accumulatedWeight = 0;
        let currentPassing = 100;
        
        rows.forEach((row) => {
            const minLim = parseFloat(row.getAttribute(&#39;data-min&#39;));
            const maxLim = parseFloat(row.getAttribute(&#39;data-max&#39;));
            let effectiveMax = Math.min(maxLim, currentPassing);
            let effectiveMin = minLim;
            if (effectiveMin > effectiveMax) effectiveMin = effectiveMax; 
            
            let randomPassing = (Math.random() * (effectiveMax - effectiveMin)) + effectiveMin;
            randomPassing = Math.round(randomPassing * 100) / 100;
            
            let targetCumWeight = ((100 - randomPassing) / 100) * sampleWt;
            let individualWeight = Math.round(targetCumWeight - accumulatedWeight);
            if (individualWeight < 0) individualWeight = 0;
            
            row.querySelector(&#39;.weight-input&#39;).value = individualWeight;
            accumulatedWeight += individualWeight;
            
            // Specific logic for WBM-Gr-II
            currentPassing = randomPassing;
        });
        
        const panRow = reportElement.querySelector(&#39;.pan-row&#39;);
        let panWeight = Math.max(0, sampleWt - accumulatedWeight);
        panRow.querySelector(&#39;.weight-input&#39;).value = panWeight;
        
        calculate(reportElement);
    }

    function calculate(reportElement) {
        if (!reportElement) return;
        const rows = reportElement.querySelectorAll(&#39;.calcTable tr&#39;);
        let totalSumWeight = 0;
        let manualSampleWt = parseFloat(reportElement.querySelector(&#39;.manualSampleWt&#39;).value);
        
        rows.forEach((row, index) => {
            if (index < rows.length - 1) { 
                const input = row.querySelector(&#39;.weight-input&#39;);
                if (input) {
                    const val = parseFloat(input.value);
                    if (!isNaN(val)) totalSumWeight += val;
                }
            }
        });
        
        const totalDisp = reportElement.querySelector(&#39;.totalWtDisplay&#39;);
        if (manualSampleWt > 0) {
             if(totalDisp) totalDisp.innerText = manualSampleWt.toFixed(0);
        } else {
             if(totalDisp) totalDisp.innerText = totalSumWeight > 0 ? totalSumWeight.toFixed(0) : &quot;&quot;;
        }
        
        let divisor = manualSampleWt > 0 ? manualSampleWt : totalSumWeight;
        let accumulatedWeight = 0;
        
        rows.forEach((row, index) => {
            if (index < rows.length - 1) {
                const input = row.querySelector(&#39;.weight-input&#39;);
                if (input) {
                    const weight = parseFloat(input.value) || 0;
                    accumulatedWeight += weight;
                    if (divisor > 0) {
                        let pctRetained = (weight / divisor) * 100;
                        let cumRetained = (accumulatedWeight / divisor) * 100;
                        let passing = Math.max(0, Math.min(100, 100 - cumRetained));
                        
                        row.querySelector(&#39;.res-pct&#39;).innerText = pctRetained.toFixed(2);
                        row.querySelector(&#39;.res-cum&#39;).innerText = cumRetained.toFixed(2);
                        row.querySelector(&#39;.res-pass&#39;).innerText = passing.toFixed(2);
                    }
                }
            }
        });
    }

    // ========== DRAGGABLE CONTROLS (MOBILE FIXED) ==========
    (function() {
        let isDragging = false;
        let currentPanel = null;
        let offsetX = 0;
        let offsetY = 0;
        let startX = 0;
        let startY = 0;
        let hasMoved = false;

        document.querySelectorAll('.drag-handle').forEach(handle => {
            handle.addEventListener('touchstart', handleTouchStart, { passive: false });
            handle.addEventListener('mousedown', handleMouseStart);
        });

        function handleTouchStart(e) {
            const panel = e.target.closest('.action-btn-container') || e.target.closest('.controls');
            if (!panel) return;
            
            if (panel.classList.contains('minimized')) {
                toggleMinimize(e.target);
                return;
            }
            
            const touch = e.touches[0];
            startX = touch.clientX;
            startY = touch.clientY;
            
            const rect = panel.getBoundingClientRect();
            offsetX = touch.clientX - rect.left;
            offsetY = touch.clientY - rect.top;
            
            isDragging = true;
            currentPanel = panel;
            hasMoved = false;
            
            panel.style.transition = 'none';
            
            document.addEventListener('touchmove', handleTouchMove, { passive: false });
            document.addEventListener('touchend', handleTouchEnd);
        }

        function handleMouseStart(e) {
            const panel = e.target.closest('.action-btn-container') || e.target.closest('.controls');
            if (!panel) return;
            
            if (panel.classList.contains('minimized')) {
                toggleMinimize(e.target);
                return;
            }
            
            startX = e.clientX;
            startY = e.clientY;
            
            const rect = panel.getBoundingClientRect();
            offsetX = e.clientX - rect.left;
            offsetY = e.clientY - rect.top;
            
            isDragging = true;
            currentPanel = panel;
            hasMoved = false;
            
            panel.style.transition = 'none';
            
            document.addEventListener('mousemove', handleMouseMove);
            document.addEventListener('mouseup', handleMouseEnd);
        }

        function handleTouchMove(e) {
            if (!isDragging || !currentPanel) return;
            
            const touch = e.touches[0];
            const deltaX = Math.abs(touch.clientX - startX);
            const deltaY = Math.abs(touch.clientY - startY);
            
            // Only drag if moved more than 5px
            if (deltaX > 5 || deltaY > 5) {
                hasMoved = true;
                
                let newX = touch.clientX - offsetX;
                let newY = touch.clientY - offsetY;
                
                const maxX = window.innerWidth - currentPanel.offsetWidth;
                const maxY = window.innerHeight - currentPanel.offsetHeight;
                
                newX = Math.max(0, Math.min(newX, maxX));
                newY = Math.max(0, Math.min(newY, maxY));
                
                currentPanel.style.left = newX + 'px';
                currentPanel.style.top = newY + 'px';
                currentPanel.style.right = 'auto';
                
                e.preventDefault();
            }
        }

        function handleMouseMove(e) {
            if (!isDragging || !currentPanel) return;
            
            const deltaX = Math.abs(e.clientX - startX);
            const deltaY = Math.abs(e.clientY - startY);
            
            if (deltaX > 5 || deltaY > 5) {
                hasMoved = true;
                
                let newX = e.clientX - offsetX;
                let newY = e.clientY - offsetY;
                
                const maxX = window.innerWidth - currentPanel.offsetWidth;
                const maxY = window.innerHeight - currentPanel.offsetHeight;
                
                newX = Math.max(0, Math.min(newX, maxX));
                newY = Math.max(0, Math.min(newY, maxY));
                
                currentPanel.style.left = newX + 'px';
                currentPanel.style.top = newY + 'px';
                currentPanel.style.right = 'auto';
            }
        }

        function handleTouchEnd() {
            if (isDragging && currentPanel) {
                currentPanel.style.transition = 'all 0.3s ease';
            }
            isDragging = false;
            currentPanel = null;
            
            document.removeEventListener('touchmove', handleTouchMove);
            document.removeEventListener('touchend', handleTouchEnd);
        }

        function handleMouseEnd() {
            if (isDragging && currentPanel) {
                currentPanel.style.transition = 'all 0.3s ease';
            }
            isDragging = false;
            currentPanel = null;
            
            document.removeEventListener('mousemove', handleMouseMove);
            document.removeEventListener('mouseup', handleMouseEnd);
        }

        window.toggleMinimize = function(btn) {
            const panel = btn.closest('.action-btn-container') || btn.closest('.controls');
            if (!panel) return;
            panel.classList.toggle('minimized');
        };
    })();

</script>
</body>
</html>"
            style="width: 100%; height: calc(100vh - 160px); border: none; display: block;"
            sandbox="allow-scripts allow-same-origin allow-forms allow-modals"
        ></iframe>
    </div>

    <!-- WBM-III Gradation TEST -->
    <div id="wbm_iii_gradation" class="test-wrapper">
        <iframe 
            srcdoc="<!DOCTYPE html>
<html lang=&quot;en&quot;>
<head>
    <meta charset=&quot;UTF-8&quot;>
    <meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;>
    <title>Bulk WBM Gr-III Generator</title>
    <style>
        body { font-family: &quot;Times New Roman&quot;, Times, serif; margin: 0; padding: 20px; background-color: #f0f0f0; }
        
        /* Report Container Style */
        .report-container { 
            width: 210mm; 
            min-height: 297mm; 
            background-color: white; 
            margin: auto; 
            padding: 20px 40px; 
            box-shadow: 0 0 10px rgba(0,0,0,0.1); 
            box-sizing: border-box; 
            position: relative; 
            margin-bottom: 20px; 
        }
        
        .header { text-align: center; margin-bottom: 20px; }
        .header h2, .header h3 { margin: 5px 0; text-transform: uppercase; }
        .header h3 { font-size: 16px; font-weight: bold; }
        .title { text-align: center; font-weight: bold; text-decoration: underline; margin: 20px 0; font-size: 18px; }
        
        .info-table { width: 100%; margin-bottom: 20px; font-size: 14px; border-collapse: collapse; }
        .info-table td { padding: 5px 2px; vertical-align: top; border: none; line-height: 1.6; }
        
        .data-table { width: 100%; border-collapse: collapse; font-size: 13px; margin-bottom: 30px; text-align: center; }
        .data-table th, .data-table td { border: 1px solid black; padding: 5px; height: 30px; vertical-align: middle; }
        .data-table th { background-color: #f2f2f2; font-weight: bold; }
        
        .footer-section { margin-top: 50px; font-size: 14px; line-height: 1.6; }
        .signature-row { display: flex; justify-content: space-between; margin-top: 80px; align-items: flex-start; }
        .signature-box { text-align: center; width: 250px; }

        .editable {
            border-bottom: 1px dotted #999;
            outline: none;
            font-weight: bold;
            color: #000;
            display: inline; 
            min-width: 50px;
        }
        .editable:empty::before { content: &quot;\00a0\00a0\00a0\00a0\00a0\00a0\00a0&quot;; color: #ccc; }
        
        .tbl-input { width: 100%; border: none; text-align: center; font-family: inherit; font-size: inherit; background: transparent; outline: none; }
        .weight-input { background-color: #eef; font-weight: bold; } 
        
        .wt-input { 
            width: 70px; 
            text-align: right; 
            border: none; 
            border-bottom: 1px dotted #999; 
            font-family: inherit; 
            font-size: inherit; 
            font-weight: bold; 
            outline: none;
            margin-right: 2px; 
        }

        /* Control Panel Styles - DRAGGABLE */
        .action-btn-container {
            position: fixed; top: 20px; right: 20px; z-index: 9999;
            background: rgba(255, 255, 255, 0.98);
            padding: 0; border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            border: 1px solid #ccc; width: 260px;
            transition: all 0.3s ease;
        }
        .action-btn-container.minimized { width: 50px; height: 50px; border-radius: 50%; }
        .drag-handle {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white; padding: 10px; cursor: move;
            display: flex; justify-content: space-between; align-items: center;
            border-radius: 8px 8px 0 0; user-select: none; touch-action: none;
            -webkit-user-select: none;
            -webkit-touch-callout: none;
        }
        .minimized .drag-handle { border-radius: 50%; width: 50px; height: 50px; justify-content: center; padding: 0; }
        .drag-handle h4 { margin: 0; font-size: 14px; font-weight: bold; flex: 1; }
        .minimized .drag-handle h4 { display: none; }
        .minimize-btn {
            background: rgba(255,255,255,0.3); border: none; color: white;
            width: 24px; height: 24px; border-radius: 4px; cursor: pointer; font-size: 16px;
        }
        .minimized .minimize-btn { display: none; }
        .control-content { padding: 15px; max-height: calc(90vh - 44px); overflow-y: auto; }
        .minimized .control-content { display: none; }
        .minimized-icon { display: none; font-size: 24px; }
        .minimized .minimized-icon { display: block; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); }
        .action-btn-container h4 { margin: 0 0 10px 0; font-family: sans-serif; text-align: center; color: #333; border-bottom: 1px solid #ddd; padding-bottom: 5px; }
        
        .input-group { display: flex; flex-direction: column; margin-bottom: 8px; }
        .input-group label { font-size: 12px; font-family: sans-serif; font-weight: bold; margin-bottom: 3px; }
        .input-group input, .input-group select { padding: 5px; border: 1px solid #aaa; border-radius: 4px; }

        /* Toggle Switch Style */
        .mode-toggle { display: flex; align-items: center; margin-bottom: 10px; background: #eee; padding: 5px; border-radius: 5px; }
        .mode-toggle label { flex: 1; font-size: 12px; font-family: sans-serif; cursor: pointer; display: flex; align-items: center; }
        .mode-toggle input { margin-right: 5px; }

        /* List Editor Style with Line Numbers */
        .list-editor-container {
            display: flex;
            border: 1px solid #aaa;
            border-radius: 4px;
            height: 120px;
            font-family: monospace;
            font-size: 12px;
            background: white;
            margin-bottom: 8px;
        }
        .line-numbers {
            width: 25px;
            background-color: #f0f0f0;
            color: #888;
            text-align: right;
            padding: 5px 2px;
            border-right: 1px solid #ddd;
            line-height: 1.4;
            overflow: hidden;
            user-select: none;
        }
        .road-list-area {
            flex: 1;
            border: none;
            padding: 5px;
            line-height: 1.4;
            resize: none;
            outline: none;
            white-space: pre;
            overflow-y: scroll;
        }

        .hidden { display: none; }

        .btn { color: white; border: none; padding: 10px; font-size: 14px; font-weight: bold; cursor: pointer; border-radius: 5px; font-family: sans-serif; margin-top: 5px; transition: 0.2s; }
        .print-btn { background-color: #dc3545; }
        .magic-btn { background-color: #28a745; }
        .clear-btn { background-color: #6c757d; }
        .btn:hover { opacity: 0.9; transform: scale(1.02); }

        @media print { 
            body { background-color: white; padding: 0; } 
            .report-container { 
                box-shadow: none; margin: 0; width: 100%; 
                page-break-after: always; 
            } 
            .report-container:last-child { page-break-after: auto; }
            .action-btn-container { display: none; }
            .weight-input { background-color: transparent; }
            .editable, .wt-input, .tbl-input { border: none !important; }
            .editable:empty::before { display: none; }
        }
        @media screen { .editable:hover { background-color: rgba(0, 0, 255, 0.05); } }
    </style>
</head>
<body>

<div class=&quot;action-btn-container&quot;>
    <div class=&quot;drag-handle&quot;>
        <h4>WBM Gr-III AI Control</h4>
        <button class=&quot;minimize-btn&quot; onclick=&quot;toggleMinimize(this)&quot;>‚àí</button>
        <span class=&quot;minimized-icon&quot;>‚öôÔ∏è</span>
    </div>
    <div class=&quot;control-content&quot;>
    
    <div class=&quot;input-group&quot;>
        <label>Division/Location:</label>
        <input type=&quot;text&quot; id=&quot;locationInput&quot; value=&quot;Nawada&quot; placeholder=&quot;e.g. RAJAULI&quot;>
    </div>

    <div class=&quot;mode-toggle&quot;>
        <label>
            <input type=&quot;radio&quot; name=&quot;genMode&quot; value=&quot;quantity&quot; onchange=&quot;toggleMode()&quot; checked> 
            <strong>Quantity Only</strong>
        </label>
        <label>
            <input type=&quot;radio&quot; name=&quot;genMode&quot; value=&quot;list&quot; onchange=&quot;toggleMode()&quot;> 
            <strong>Road Name List</strong>
        </label>
    </div>

    <div id=&quot;quantityBox&quot; class=&quot;input-group&quot;>
        <label>Quantity (No. of Reports):</label>
        <input type=&quot;number&quot; id=&quot;reportCount&quot; value=&quot;10&quot;>
    </div>

    <div id=&quot;listBox&quot; class=&quot;input-group hidden&quot;>
        <label>Paste Road Names Below:</label>
        <div class=&quot;list-editor-container&quot;>
            <div class=&quot;line-numbers&quot; id=&quot;lineNumbers&quot;>1</div>
            <textarea id=&quot;roadListInput&quot; class=&quot;road-list-area&quot; placeholder=&quot;Paste list here...&quot; oninput=&quot;updateLineNumbers()&quot; onscroll=&quot;syncScroll()&quot;></textarea>
        </div>
        <div style=&quot;font-size: 11px; color: #666; text-align: right;&quot;>Total Roads: <span id=&quot;roadCountDisplay&quot;>0</span></div>
    </div>

    <div class=&quot;input-group&quot;>
        <label>Min Weight (gm):</label>
        <input type=&quot;number&quot; id=&quot;minRange&quot; value=&quot;19000&quot;>
    </div>
    
    <div class=&quot;input-group&quot;>
        <label>Max Weight (gm):</label>
        <input type=&quot;number&quot; id=&quot;maxRange&quot; value=&quot;19500&quot;>
    </div>

    <button class=&quot;btn magic-btn&quot; onclick=&quot;generateBulkReports()&quot;>‚ö° GENERATE BULK</button>
    <button class=&quot;btn print-btn&quot; onclick=&quot;window.print()&quot;>PRINT ALL üñ®Ô∏è</button>
    <button class=&quot;btn clear-btn&quot; onclick=&quot;location.reload()&quot;>RESET</button>
    </div></div>

<div id=&quot;main-output-area&quot;>
    <div class=&quot;report-container template-report&quot;>
        <div class=&quot;header&quot;>
            <h2>RURAL WORKS DEPARTMENT</h2>
            <h3>Testing and Quality Control Laboratory, <span class=&quot;editable location-placeholder&quot; contenteditable=&quot;true&quot;>Nawada</span></h3>
        </div>
        <div class=&quot;title&quot;>GRADATION TEST OF (WBM-Gr-III)</div>
        
        <table class=&quot;info-table&quot;>
            <tr>
                <td width=&quot;60%&quot;><strong>NAME OF ROAD :-</strong> <span class=&quot;editable road-name-field&quot; contenteditable=&quot;true&quot;></span></td>
                <td width=&quot;40%&quot;><strong>DATE OF COLLECTION/RECEIPT:-</strong> <span class=&quot;editable&quot; contenteditable=&quot;true&quot;></span></td>
            </tr>
            <tr>
                <td><strong>NAME OF WORKS DIVISION:-</strong> <span class=&quot;editable&quot; contenteditable=&quot;true&quot;>R.W.D WORKS DIVISION</span></td>
                <td><strong>DATE OF TEST:-</strong> <span class=&quot;editable&quot; contenteditable=&quot;true&quot;></span></td>
            </tr>
            <tr>
                <td><strong>NAME OF AGENCY :-</strong> <span class=&quot;editable&quot; contenteditable=&quot;true&quot;></span></td>
                <td><strong>PACKAGE NO:-</strong> <span class=&quot;editable&quot; contenteditable=&quot;true&quot;></span></td>
            </tr>
            <tr>
                <td colspan=&quot;2&quot;><strong>AGREEMENT NO:-</strong> <span class=&quot;editable&quot; contenteditable=&quot;true&quot;></span></td>
            </tr>
            <tr>
                <td colspan=&quot;2&quot;>
                    <strong>Ref:-</strong> <span class=&quot;editable&quot; contenteditable=&quot;true&quot;>A.E, R.W.D WORKS SUB DIV</span>
                    <span style=&quot;margin-left: 30px;&quot;>
                        <strong>Chainage:-</strong> 
                        <span class=&quot;editable&quot; contenteditable=&quot;true&quot; style=&quot;min-width: 50px;&quot;></span> <strong>km</strong>
                    </span>
                </td>
            </tr>
            <tr>
                <td colspan=&quot;2&quot; style=&quot;padding-top: 10px;&quot;>
                    <strong>LT NO:-</strong> <span class=&quot;editable&quot; contenteditable=&quot;true&quot; style=&quot;min-width: 80px;&quot;></span> 
                    <span style=&quot;margin-left: 50px;&quot;><strong>DT:-</strong> <span class=&quot;editable&quot; contenteditable=&quot;true&quot; style=&quot;min-width: 80px;&quot;></span></span>
                    <span style=&quot;margin-left: 50px;&quot;>
                        <strong>Sample Wt:-</strong> 
                        <input type=&quot;number&quot; class=&quot;wt-input manualSampleWt&quot; value=&quot;19200&quot; oninput=&quot;calculate(this.closest(&#39;.report-container&#39;))&quot;><strong>gm</strong>
                    </span>
                </td>
            </tr>
        </table>
        
        <table class=&quot;data-table&quot;>
            <thead>
                <tr>
                    <th width=&quot;8%&quot;>SL. NO</th>
                    <th width=&quot;15%&quot;>Sieve No.<br>mm</th>
                    <th width=&quot;15%&quot;>Weight Retained<br>(gm)</th>
                    <th width=&quot;12%&quot;>% Wt. Of<br>Retained</th>
                    <th width=&quot;15%&quot;>Cumulative %<br>Retained</th>
                    <th width=&quot;12%&quot;>% Of Passing</th>
                    <th width=&quot;13%&quot;>Required<br>Limit %</th>
                    <th>Remarks</th>
                </tr>
            </thead>
            <tbody class=&quot;calcTable&quot;>
                <tr data-min=&quot;100&quot; data-max=&quot;100&quot;><td>1</td><td>63 MM</td><td><input type=&quot;number&quot; class=&quot;tbl-input weight-input&quot; oninput=&quot;calculate(this.closest(&#39;.report-container&#39;))&quot;></td><td class=&quot;res-pct&quot;></td><td class=&quot;res-cum&quot;></td><td class=&quot;res-pass&quot;></td><td>100</td><td><input type=&quot;text&quot; class=&quot;tbl-input&quot;></td></tr>
                <tr data-min=&quot;95&quot; data-max=&quot;100&quot;><td>2</td><td>53 MM</td><td><input type=&quot;number&quot; class=&quot;tbl-input weight-input&quot; oninput=&quot;calculate(this.closest(&#39;.report-container&#39;))&quot;></td><td class=&quot;res-pct&quot;></td><td class=&quot;res-cum&quot;></td><td class=&quot;res-pass&quot;></td><td>95-100</td><td><input type=&quot;text&quot; class=&quot;tbl-input&quot;></td></tr>
                <tr data-min=&quot;65&quot; data-max=&quot;90&quot;><td>3</td><td>45 MM</td><td><input type=&quot;number&quot; class=&quot;tbl-input weight-input&quot; oninput=&quot;calculate(this.closest(&#39;.report-container&#39;))&quot;></td><td class=&quot;res-pct&quot;></td><td class=&quot;res-cum&quot;></td><td class=&quot;res-pass&quot;></td><td>65-90</td><td><input type=&quot;text&quot; class=&quot;tbl-input&quot;></td></tr>
                <tr data-min=&quot;0&quot; data-max=&quot;10&quot;><td>4</td><td>22.4 MM</td><td><input type=&quot;number&quot; class=&quot;tbl-input weight-input&quot; oninput=&quot;calculate(this.closest(&#39;.report-container&#39;))&quot;></td><td class=&quot;res-pct&quot;></td><td class=&quot;res-cum&quot;></td><td class=&quot;res-pass&quot;></td><td>0-10</td><td><input type=&quot;text&quot; class=&quot;tbl-input&quot;></td></tr>
                <tr data-min=&quot;0&quot; data-max=&quot;5&quot;><td>5</td><td>11.2 MM</td><td><input type=&quot;number&quot; class=&quot;tbl-input weight-input&quot; oninput=&quot;calculate(this.closest(&#39;.report-container&#39;))&quot;></td><td class=&quot;res-pct&quot;></td><td class=&quot;res-cum&quot;></td><td class=&quot;res-pass&quot;></td><td>0-5</td><td><input type=&quot;text&quot; class=&quot;tbl-input&quot;></td></tr>
                <tr><td>6</td><td>PAN</td><td><input type=&quot;number&quot; class=&quot;tbl-input weight-input&quot; oninput=&quot;calculate(this.closest(&#39;.report-container&#39;))&quot;></td><td class=&quot;res-pct&quot;></td><td class=&quot;res-cum&quot;></td><td class=&quot;res-pass&quot;></td><td></td><td><input type=&quot;text&quot; class=&quot;tbl-input&quot;></td></tr>
                <tr style=&quot;font-weight: bold;&quot;>
                    <td></td><td>Total Wt.</td><td class=&quot;totalWtDisplay&quot;></td><td colspan=&quot;5&quot;></td>
                </tr>
            </tbody>
        </table>
        
        <div class=&quot;footer-section&quot;>
            <div style=&quot;display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px;&quot;>
                <div><strong>Memo No:</strong> <span class=&quot;editable&quot; contenteditable=&quot;true&quot; style=&quot;min-width: 100px;&quot;></span></div>
                <div style=&quot;margin-right: 150px;&quot;><strong>Date:</strong> <span class=&quot;editable&quot; contenteditable=&quot;true&quot; style=&quot;min-width: 150px;&quot;></span></div>
            </div>
            <p><strong>Copy Forwarded to:-</strong> Executive Engineer, R.W.D, Works Division, <span class=&quot;editable location-placeholder&quot; contenteditable=&quot;true&quot;>Nawada</span></p>
            <div class=&quot;signature-row&quot;>
                <div class=&quot;signature-box&quot;><br><br><strong>T.S.</strong></div>
                <div class=&quot;signature-box&quot;>
                    <br><br><strong>A.E.</strong><br>
                    R.W.D, Testing and Quality Control Laboratory,<br>
                    <span class=&quot;editable location-placeholder&quot; contenteditable=&quot;true&quot;>Nawada</span>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // Toggle Logic
    function toggleMode() {
        const mode = document.querySelector(&#39;input[name=&quot;genMode&quot;]:checked&#39;).value;
        const qtyBox = document.getElementById(&#39;quantityBox&#39;);
        const listBox = document.getElementById(&#39;listBox&#39;);
        
        if (mode === &#39;quantity&#39;) {
            qtyBox.classList.remove(&#39;hidden&#39;);
            listBox.classList.add(&#39;hidden&#39;);
        } else {
            qtyBox.classList.add(&#39;hidden&#39;);
            listBox.classList.remove(&#39;hidden&#39;);
        }
    }

    // Line Numbers & Sync Scroll
    function updateLineNumbers() {
        const textarea = document.getElementById(&#39;roadListInput&#39;);
        const lines = textarea.value.split(&#39;\n&#39;).length;
        const lineNumbersElem = document.getElementById(&#39;lineNumbers&#39;);
        
        let numbersHTML = &#39;&#39;;
        for (let i = 1; i <= lines; i++) {
            numbersHTML += i + &#39;<br>&#39;;
        }
        lineNumbersElem.innerHTML = numbersHTML;
        
        const nonEmptyLines = textarea.value.split(&#39;\n&#39;).filter(line => line.trim() !== &quot;&quot;).length;
        document.getElementById(&#39;roadCountDisplay&#39;).innerText = nonEmptyLines;
    }

    function syncScroll() {
        const textarea = document.getElementById(&#39;roadListInput&#39;);
        const lineNumbersElem = document.getElementById(&#39;lineNumbers&#39;);
        lineNumbersElem.scrollTop = textarea.scrollTop;
    }

    function generateBulkReports() {
        const minWt = parseFloat(document.getElementById(&#39;minRange&#39;).value);
        const maxWt = parseFloat(document.getElementById(&#39;maxRange&#39;).value);
        const locName = document.getElementById(&#39;locationInput&#39;).value || &quot;Nawada&quot;;
        
        if (!minWt || !maxWt) {
            alert(&quot;Please enter Min and Max Weight.&quot;);
            return;
        }

        // Determine Mode
        const mode = document.querySelector(&#39;input[name=&quot;genMode&quot;]:checked&#39;).value;
        let reportsToGenerate = []; 

        if (mode === &#39;quantity&#39;) {
            const count = parseInt(document.getElementById(&#39;reportCount&#39;).value);
            if (!count) { alert(&quot;Please enter Quantity.&quot;); return; }
            for(let i=0; i<count; i++) {
                reportsToGenerate.push({ roadName: &quot;&quot; }); 
            }
        } else {
            // List Mode
            const listText = document.getElementById(&#39;roadListInput&#39;).value;
            const lines = listText.split(&#39;\n&#39;);
            
            lines.forEach(line => {
                if(line.trim() !== &quot;&quot;) {
                    reportsToGenerate.push({ roadName: line.trim() });
                }
            });
            
            if (reportsToGenerate.length === 0) {
                alert(&quot;Please paste at least one road name in the list.&quot;);
                return;
            }
        }

        const container = document.getElementById(&#39;main-output-area&#39;);
        const template = container.querySelector(&#39;.template-report&#39;).cloneNode(true);
        container.innerHTML = &#39;&#39;;

        reportsToGenerate.forEach(item => {
            let newReport = template.cloneNode(true);
            
            // Random Weight
            let randomSampleWt = Math.floor(Math.random() * (maxWt - minWt + 1)) + minWt;
            newReport.querySelector(&#39;.manualSampleWt&#39;).value = randomSampleWt;

            // Update Location
            newReport.querySelectorAll(&#39;.location-placeholder&#39;).forEach(span => {
                span.innerText = locName;
            });
            
            // Update Road Name
            if (item.roadName) {
                newReport.querySelector(&#39;.road-name-field&#39;).innerText = item.roadName;
            }

            container.appendChild(newReport);
            autoFillWeights(newReport, randomSampleWt);
        });
    }

    function autoFillWeights(reportElement, sampleWt) {
        if (!sampleWt) sampleWt = parseFloat(reportElement.querySelector(&#39;.manualSampleWt&#39;).value);
        
        const rows = reportElement.querySelectorAll(&#39;.calcTable tr[data-min]&#39;);
        let accumulatedWeight = 0;
        let currentPassing = 100;
        
        rows.forEach((row) => {
            const minLim = parseFloat(row.getAttribute(&#39;data-min&#39;));
            const maxLim = parseFloat(row.getAttribute(&#39;data-max&#39;));
            let effectiveMax = Math.min(maxLim, currentPassing);
            let effectiveMin = minLim;
            if (effectiveMin > effectiveMax) effectiveMin = effectiveMax; 
            
            let randomPassing = (Math.random() * (effectiveMax - effectiveMin)) + effectiveMin;
            randomPassing = Math.round(randomPassing * 100) / 100;
            
            let targetCumWeight = ((100 - randomPassing) / 100) * sampleWt;
            let individualWeight = Math.round(targetCumWeight - accumulatedWeight);
            if (individualWeight < 0) individualWeight = 0;
            
            row.querySelector(&#39;.weight-input&#39;).value = individualWeight;
            accumulatedWeight += individualWeight;
            
            currentPassing = 100 - ((accumulatedWeight / sampleWt) * 100);
        });
        
        const panRow = reportElement.querySelector(&#39;.calcTable tr:nth-last-child(2)&#39;);
        let panWeight = Math.max(0, sampleWt - accumulatedWeight);
        panRow.querySelector(&#39;.weight-input&#39;).value = panWeight;
        
        calculate(reportElement);
    }

    function calculate(reportElement) {
        if (!reportElement) return;
        const rows = reportElement.querySelectorAll(&#39;.calcTable tr&#39;);
        let totalSumWeight = 0;
        let manualSampleWt = parseFloat(reportElement.querySelector(&#39;.manualSampleWt&#39;).value);
        
        rows.forEach((row, index) => {
            if (index < rows.length - 1) { 
                const input = row.querySelector(&#39;.weight-input&#39;);
                if (input) {
                    const val = parseFloat(input.value);
                    if (!isNaN(val)) totalSumWeight += val;
                }
            }
        });
        
        const totalDisp = reportElement.querySelector(&#39;.totalWtDisplay&#39;);
        if (manualSampleWt > 0) {
             if(totalDisp) totalDisp.innerText = manualSampleWt.toFixed(0);
        } else {
             if(totalDisp) totalDisp.innerText = totalSumWeight > 0 ? totalSumWeight.toFixed(0) : &quot;&quot;;
        }
        
        let divisor = manualSampleWt > 0 ? manualSampleWt : totalSumWeight;
        let accumulatedWeight = 0;
        
        rows.forEach((row, index) => {
            if (index < rows.length - 1) {
                const input = row.querySelector(&#39;.weight-input&#39;);
                if (input) {
                    const weight = parseFloat(input.value) || 0;
                    accumulatedWeight += weight;
                    if (divisor > 0) {
                        let pctRetained = (weight / divisor) * 100;
                        let cumRetained = (accumulatedWeight / divisor) * 100;
                        let passing = Math.max(0, 100 - cumRetained);
                        if (passing < 0.01) passing = 0.00; 
                        
                        row.querySelector(&#39;.res-pct&#39;).innerText = pctRetained.toFixed(2);
                        row.querySelector(&#39;.res-cum&#39;).innerText = cumRetained.toFixed(2);
                        row.querySelector(&#39;.res-pass&#39;).innerText = passing.toFixed(2);
                    }
                }
            }
        });
    }

    // ========== DRAGGABLE CONTROLS (MOBILE FIXED) ==========
    (function() {
        let isDragging = false;
        let currentPanel = null;
        let offsetX = 0;
        let offsetY = 0;
        let startX = 0;
        let startY = 0;
        let hasMoved = false;

        document.querySelectorAll('.drag-handle').forEach(handle => {
            handle.addEventListener('touchstart', handleTouchStart, { passive: false });
            handle.addEventListener('mousedown', handleMouseStart);
        });

        function handleTouchStart(e) {
            const panel = e.target.closest('.action-btn-container') || e.target.closest('.controls');
            if (!panel) return;
            
            if (panel.classList.contains('minimized')) {
                toggleMinimize(e.target);
                return;
            }
            
            const touch = e.touches[0];
            startX = touch.clientX;
            startY = touch.clientY;
            
            const rect = panel.getBoundingClientRect();
            offsetX = touch.clientX - rect.left;
            offsetY = touch.clientY - rect.top;
            
            isDragging = true;
            currentPanel = panel;
            hasMoved = false;
            
            panel.style.transition = 'none';
            
            document.addEventListener('touchmove', handleTouchMove, { passive: false });
            document.addEventListener('touchend', handleTouchEnd);
        }

        function handleMouseStart(e) {
            const panel = e.target.closest('.action-btn-container') || e.target.closest('.controls');
            if (!panel) return;
            
            if (panel.classList.contains('minimized')) {
                toggleMinimize(e.target);
                return;
            }
            
            startX = e.clientX;
            startY = e.clientY;
            
            const rect = panel.getBoundingClientRect();
            offsetX = e.clientX - rect.left;
            offsetY = e.clientY - rect.top;
            
            isDragging = true;
            currentPanel = panel;
            hasMoved = false;
            
            panel.style.transition = 'none';
            
            document.addEventListener('mousemove', handleMouseMove);
            document.addEventListener('mouseup', handleMouseEnd);
        }

        function handleTouchMove(e) {
            if (!isDragging || !currentPanel) return;
            
            const touch = e.touches[0];
            const deltaX = Math.abs(touch.clientX - startX);
            const deltaY = Math.abs(touch.clientY - startY);
            
            // Only drag if moved more than 5px
            if (deltaX > 5 || deltaY > 5) {
                hasMoved = true;
                
                let newX = touch.clientX - offsetX;
                let newY = touch.clientY - offsetY;
                
                const maxX = window.innerWidth - currentPanel.offsetWidth;
                const maxY = window.innerHeight - currentPanel.offsetHeight;
                
                newX = Math.max(0, Math.min(newX, maxX));
                newY = Math.max(0, Math.min(newY, maxY));
                
                currentPanel.style.left = newX + 'px';
                currentPanel.style.top = newY + 'px';
                currentPanel.style.right = 'auto';
                
                e.preventDefault();
            }
        }

        function handleMouseMove(e) {
            if (!isDragging || !currentPanel) return;
            
            const deltaX = Math.abs(e.clientX - startX);
            const deltaY = Math.abs(e.clientY - startY);
            
            if (deltaX > 5 || deltaY > 5) {
                hasMoved = true;
                
                let newX = e.clientX - offsetX;
                let newY = e.clientY - offsetY;
                
                const maxX = window.innerWidth - currentPanel.offsetWidth;
                const maxY = window.innerHeight - currentPanel.offsetHeight;
                
                newX = Math.max(0, Math.min(newX, maxX));
                newY = Math.max(0, Math.min(newY, maxY));
                
                currentPanel.style.left = newX + 'px';
                currentPanel.style.top = newY + 'px';
                currentPanel.style.right = 'auto';
            }
        }

        function handleTouchEnd() {
            if (isDragging && currentPanel) {
                currentPanel.style.transition = 'all 0.3s ease';
            }
            isDragging = false;
            currentPanel = null;
            
            document.removeEventListener('touchmove', handleTouchMove);
            document.removeEventListener('touchend', handleTouchEnd);
        }

        function handleMouseEnd() {
            if (isDragging && currentPanel) {
                currentPanel.style.transition = 'all 0.3s ease';
            }
            isDragging = false;
            currentPanel = null;
            
            document.removeEventListener('mousemove', handleMouseMove);
            document.removeEventListener('mouseup', handleMouseEnd);
        }

        window.toggleMinimize = function(btn) {
            const panel = btn.closest('.action-btn-container') || btn.closest('.controls');
            if (!panel) return;
            panel.classList.toggle('minimized');
        };
    })();

</script>
</body>
</html>"
            style="width: 100%; height: calc(100vh - 160px); border: none; display: block;"
            sandbox="allow-scripts allow-same-origin allow-forms allow-modals"
        ></iframe>
    </div>

    <!-- WMM Gradation TEST -->
    <div id="wmm_gradation" class="test-wrapper">
        <iframe 
            srcdoc="<!DOCTYPE html>
<html lang=&quot;en&quot;>
<head>
    <meta charset=&quot;UTF-8&quot;>
    <meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;>
    <title>Bulk WMM Gradation Generator</title>
    <style>
        body { font-family: &quot;Times New Roman&quot;, Times, serif; margin: 0; padding: 20px; background-color: #f0f0f0; }
        
        /* Report Container Style */
        .report-container { 
            width: 210mm; 
            min-height: 297mm; 
            background-color: white; 
            margin: auto; 
            padding: 20px 40px; 
            box-shadow: 0 0 10px rgba(0,0,0,0.1); 
            box-sizing: border-box; 
            position: relative; 
            margin-bottom: 20px; 
        }
        
        .header { text-align: center; margin-bottom: 20px; }
        .header h2, .header h3 { margin: 5px 0; text-transform: uppercase; }
        .header h3 { font-size: 16px; font-weight: bold; }
        .title { text-align: center; font-weight: bold; text-decoration: underline; margin: 20px 0; font-size: 18px; }
        
        .info-table { width: 100%; margin-bottom: 20px; font-size: 14px; border-collapse: collapse; }
        .info-table td { padding: 5px 2px; vertical-align: top; border: none; line-height: 1.6; }
        
        .data-table { width: 100%; border-collapse: collapse; font-size: 13px; margin-bottom: 30px; text-align: center; }
        .data-table th, .data-table td { border: 1px solid black; padding: 5px; height: 30px; vertical-align: middle; }
        .data-table th { background-color: #f2f2f2; font-weight: bold; }
        
        .footer-section { margin-top: 50px; font-size: 14px; line-height: 1.6; }
        .signature-row { display: flex; justify-content: space-between; margin-top: 80px; align-items: flex-start; }
        .signature-box { text-align: center; width: 250px; }

        /* Editable Fields */
        .editable {
            border-bottom: 1px dotted #999;
            outline: none;
            font-weight: bold;
            color: #000;
            display: inline; 
            min-width: 50px;
        }
        .editable:empty::before { content: &quot;\00a0\00a0\00a0\00a0\00a0\00a0\00a0&quot;; color: #ccc; }
        
        /* Inputs */
        .tbl-input { width: 100%; border: none; text-align: center; font-family: inherit; font-size: inherit; background: transparent; outline: none; }
        .weight-input { background-color: #eef; font-weight: bold; } 
        
        .wt-input { 
            width: 70px; 
            text-align: right; 
            border: none; 
            border-bottom: 1px dotted #999; 
            font-family: inherit; 
            font-size: inherit; 
            font-weight: bold; 
            outline: none;
            margin-right: 2px; 
        }

        /* Control Panel Styles - DRAGGABLE */
        .action-btn-container {
            position: fixed; top: 20px; right: 20px; z-index: 9999;
            background: rgba(255, 255, 255, 0.98);
            padding: 0; border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            border: 1px solid #ccc; width: 260px;
            transition: all 0.3s ease;
        }
        .action-btn-container.minimized { width: 50px; height: 50px; border-radius: 50%; }
        .drag-handle {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white; padding: 10px; cursor: move;
            display: flex; justify-content: space-between; align-items: center;
            border-radius: 8px 8px 0 0; user-select: none; touch-action: none;
            -webkit-user-select: none;
            -webkit-touch-callout: none;
        }
        .minimized .drag-handle { border-radius: 50%; width: 50px; height: 50px; justify-content: center; padding: 0; }
        .drag-handle h4 { margin: 0; font-size: 14px; font-weight: bold; flex: 1; }
        .minimized .drag-handle h4 { display: none; }
        .minimize-btn {
            background: rgba(255,255,255,0.3); border: none; color: white;
            width: 24px; height: 24px; border-radius: 4px; cursor: pointer; font-size: 16px;
        }
        .minimized .minimize-btn { display: none; }
        .control-content { padding: 15px; max-height: calc(90vh - 44px); overflow-y: auto; }
        .minimized .control-content { display: none; }
        .minimized-icon { display: none; font-size: 24px; }
        .minimized .minimized-icon { display: block; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); }
        .action-btn-container h4 { margin: 0 0 10px 0; font-family: sans-serif; text-align: center; color: #333; border-bottom: 1px solid #ddd; padding-bottom: 5px; }
        
        .input-group { display: flex; flex-direction: column; margin-bottom: 8px; }
        .input-group label { font-size: 12px; font-family: sans-serif; font-weight: bold; margin-bottom: 3px; }
        .input-group input, .input-group select { padding: 5px; border: 1px solid #aaa; border-radius: 4px; }

        /* Toggle Switch Style */
        .mode-toggle { display: flex; align-items: center; margin-bottom: 10px; background: #eee; padding: 5px; border-radius: 5px; }
        .mode-toggle label { flex: 1; font-size: 12px; font-family: sans-serif; cursor: pointer; display: flex; align-items: center; }
        .mode-toggle input { margin-right: 5px; }

        /* List Editor Style with Line Numbers */
        .list-editor-container {
            display: flex;
            border: 1px solid #aaa;
            border-radius: 4px;
            height: 120px;
            font-family: monospace;
            font-size: 12px;
            background: white;
            margin-bottom: 8px;
        }
        .line-numbers {
            width: 25px;
            background-color: #f0f0f0;
            color: #888;
            text-align: right;
            padding: 5px 2px;
            border-right: 1px solid #ddd;
            line-height: 1.4;
            overflow: hidden;
            user-select: none;
        }
        .road-list-area {
            flex: 1;
            border: none;
            padding: 5px;
            line-height: 1.4;
            resize: none;
            outline: none;
            white-space: pre;
            overflow-y: scroll;
        }

        .hidden { display: none; }

        .btn { color: white; border: none; padding: 10px; font-size: 14px; font-weight: bold; cursor: pointer; border-radius: 5px; font-family: sans-serif; margin-top: 5px; transition: 0.2s; }
        .print-btn { background-color: #dc3545; }
        .magic-btn { background-color: #28a745; }
        .clear-btn { background-color: #6c757d; }
        .btn:hover { opacity: 0.9; transform: scale(1.02); }

        /* Print Rules */
        @media print { 
            body { background-color: white; padding: 0; } 
            .report-container { 
                box-shadow: none; margin: 0; width: 100%; 
                page-break-after: always; 
            } 
            .report-container:last-child { page-break-after: auto; }
            .action-btn-container { display: none; }
            .weight-input { background-color: transparent; }
            .editable, .wt-input, .tbl-input { border: none !important; }
            .editable:empty::before { display: none; }
        }
        @media screen { .editable:hover { background-color: rgba(0, 0, 255, 0.05); } }
    </style>
</head>
<body>

<div class=&quot;action-btn-container&quot;>
    <div class=&quot;drag-handle&quot;>
        <h4>WMM AI Control</h4>
        <button class=&quot;minimize-btn&quot; onclick=&quot;toggleMinimize(this)&quot;>‚àí</button>
        <span class=&quot;minimized-icon&quot;>‚öôÔ∏è</span>
    </div>
    <div class=&quot;control-content&quot;>
    
    <div class=&quot;input-group&quot;>
        <label>Division/Location:</label>
        <input type=&quot;text&quot; id=&quot;locationInput&quot; value=&quot;Nawada&quot; placeholder=&quot;e.g. RAJAULI&quot;>
    </div>

    <div class=&quot;mode-toggle&quot;>
        <label>
            <input type=&quot;radio&quot; name=&quot;genMode&quot; value=&quot;quantity&quot; onchange=&quot;toggleMode()&quot; checked> 
            <strong>Quantity Only</strong>
        </label>
        <label>
            <input type=&quot;radio&quot; name=&quot;genMode&quot; value=&quot;list&quot; onchange=&quot;toggleMode()&quot;> 
            <strong>Road Name List</strong>
        </label>
    </div>

    <div id=&quot;quantityBox&quot; class=&quot;input-group&quot;>
        <label>Quantity (No. of Reports):</label>
        <input type=&quot;number&quot; id=&quot;reportCount&quot; value=&quot;10&quot;>
    </div>

    <div id=&quot;listBox&quot; class=&quot;input-group hidden&quot;>
        <label>Paste Road Names Below:</label>
        <div class=&quot;list-editor-container&quot;>
            <div class=&quot;line-numbers&quot; id=&quot;lineNumbers&quot;>1</div>
            <textarea id=&quot;roadListInput&quot; class=&quot;road-list-area&quot; placeholder=&quot;Paste list here...&quot; oninput=&quot;updateLineNumbers()&quot; onscroll=&quot;syncScroll()&quot;></textarea>
        </div>
        <div style=&quot;font-size: 11px; color: #666; text-align: right;&quot;>Total Roads: <span id=&quot;roadCountDisplay&quot;>0</span></div>
    </div>

    <div class=&quot;input-group&quot;>
        <label>Min Weight (gm):</label>
        <input type=&quot;number&quot; id=&quot;minRange&quot; value=&quot;10000&quot;>
    </div>
    
    <div class=&quot;input-group&quot;>
        <label>Max Weight (gm):</label>
        <input type=&quot;number&quot; id=&quot;maxRange&quot; value=&quot;10500&quot;>
    </div>

    <button class=&quot;btn magic-btn&quot; onclick=&quot;generateBulkReports()&quot;>‚ö° GENERATE BULK</button>
    <button class=&quot;btn print-btn&quot; onclick=&quot;window.print()&quot;>PRINT ALL üñ®Ô∏è</button>
    <button class=&quot;btn clear-btn&quot; onclick=&quot;location.reload()&quot;>RESET</button>
    </div></div>

<div id=&quot;main-output-area&quot;>
    <div class=&quot;report-container template-report&quot;>
        <div class=&quot;header&quot;>
            <h2>RURAL WORKS DEPARTMENT</h2>
            <h3>Testing and Quality Control Laboratory, <span class=&quot;editable location-placeholder&quot; contenteditable=&quot;true&quot;>Nawada</span></h3>
        </div>
        <div class=&quot;title&quot;>GRADATION TEST OF (WMM)</div>
        
        <table class=&quot;info-table&quot;>
            <tr>
                <td width=&quot;60%&quot;><strong>NAME OF ROAD :-</strong> <span class=&quot;editable road-name-field&quot; contenteditable=&quot;true&quot;></span></td>
                <td width=&quot;40%&quot;><strong>DATE OF COLLECTION/RECEIPT:-</strong> <span class=&quot;editable&quot; contenteditable=&quot;true&quot;></span></td>
            </tr>
            <tr>
                <td><strong>NAME OF WORKS DIVISION:-</strong> <span class=&quot;editable&quot; contenteditable=&quot;true&quot;>R.W.D WORKS DIVISION</span></td>
                <td><strong>DATE OF TEST:-</strong> <span class=&quot;editable&quot; contenteditable=&quot;true&quot;></span></td>
            </tr>
            <tr>
                <td><strong>NAME OF AGENCY :-</strong> <span class=&quot;editable&quot; contenteditable=&quot;true&quot;></span></td>
                <td><strong>PACKAGE NO:-</strong> <span class=&quot;editable&quot; contenteditable=&quot;true&quot;></span></td>
            </tr>
            <tr>
                <td colspan=&quot;2&quot;><strong>AGREEMENT NO:-</strong> <span class=&quot;editable&quot; contenteditable=&quot;true&quot;></span></td>
            </tr>
            <tr>
                <td colspan=&quot;2&quot;>
                    <strong>Ref:-</strong> <span class=&quot;editable&quot; contenteditable=&quot;true&quot;>A.E, R.W.D WORKS SUB DIV</span>
                    <span style=&quot;margin-left: 30px;&quot;>
                        <strong>Chainage:-</strong> 
                        <span class=&quot;editable&quot; contenteditable=&quot;true&quot; style=&quot;min-width: 50px;&quot;></span> <strong>km</strong>
                    </span>
                </td>
            </tr>
            <tr>
                <td colspan=&quot;2&quot; style=&quot;padding-top: 10px;&quot;>
                    <strong>LT NO:-</strong> <span class=&quot;editable&quot; contenteditable=&quot;true&quot; style=&quot;min-width: 80px;&quot;></span> 
                    <span style=&quot;margin-left: 50px;&quot;><strong>DT:-</strong> <span class=&quot;editable&quot; contenteditable=&quot;true&quot; style=&quot;min-width: 80px;&quot;></span></span>
                    <span style=&quot;margin-left: 50px;&quot;>
                        <strong>Sample Wt:-</strong> 
                        <input type=&quot;number&quot; class=&quot;wt-input manualSampleWt&quot; value=&quot;10000&quot; oninput=&quot;calculate(this.closest(&#39;.report-container&#39;))&quot;><strong>gm</strong>
                    </span>
                </td>
            </tr>
        </table>
        
        <table class=&quot;data-table&quot;>
            <thead>
                <tr>
                    <th width=&quot;8%&quot;>SL. NO</th>
                    <th width=&quot;15%&quot;>Sieve No.<br>mm</th>
                    <th width=&quot;15%&quot;>Weight Retained<br>(gm)</th>
                    <th width=&quot;12%&quot;>% Wt. Of<br>Retained</th>
                    <th width=&quot;15%&quot;>Cumulative %<br>Retained</th>
                    <th width=&quot;12%&quot;>% Of Passing</th>
                    <th width=&quot;13%&quot;>Required<br>Limit %</th>
                    <th>Remarks</th>
                </tr>
            </thead>
            <tbody class=&quot;calcTable&quot;>
                <tr data-min=&quot;100&quot; data-max=&quot;100&quot;><td>1</td><td>53.0 MM</td><td><input type=&quot;number&quot; class=&quot;tbl-input weight-input&quot; oninput=&quot;calculate(this.closest(&#39;.report-container&#39;))&quot;></td><td class=&quot;res-pct&quot;></td><td class=&quot;res-cum&quot;></td><td class=&quot;res-pass&quot;></td><td>100</td><td><input type=&quot;text&quot; class=&quot;tbl-input&quot;></td></tr>
                <tr data-min=&quot;95&quot; data-max=&quot;100&quot;><td>2</td><td>45.0 MM</td><td><input type=&quot;number&quot; class=&quot;tbl-input weight-input&quot; oninput=&quot;calculate(this.closest(&#39;.report-container&#39;))&quot;></td><td class=&quot;res-pct&quot;></td><td class=&quot;res-cum&quot;></td><td class=&quot;res-pass&quot;></td><td>95-100</td><td><input type=&quot;text&quot; class=&quot;tbl-input&quot;></td></tr>
                <tr data-min=&quot;60&quot; data-max=&quot;80&quot;><td>3</td><td>22.4 MM</td><td><input type=&quot;number&quot; class=&quot;tbl-input weight-input&quot; oninput=&quot;calculate(this.closest(&#39;.report-container&#39;))&quot;></td><td class=&quot;res-pct&quot;></td><td class=&quot;res-cum&quot;></td><td class=&quot;res-pass&quot;></td><td>60-80</td><td><input type=&quot;text&quot; class=&quot;tbl-input&quot;></td></tr>
                <tr data-min=&quot;40&quot; data-max=&quot;60&quot;><td>4</td><td>11.2 MM</td><td><input type=&quot;number&quot; class=&quot;tbl-input weight-input&quot; oninput=&quot;calculate(this.closest(&#39;.report-container&#39;))&quot;></td><td class=&quot;res-pct&quot;></td><td class=&quot;res-cum&quot;></td><td class=&quot;res-pass&quot;></td><td>40-60</td><td><input type=&quot;text&quot; class=&quot;tbl-input&quot;></td></tr>
                <tr data-min=&quot;25&quot; data-max=&quot;40&quot;><td>5</td><td>4.75 MM</td><td><input type=&quot;number&quot; class=&quot;tbl-input weight-input&quot; oninput=&quot;calculate(this.closest(&#39;.report-container&#39;))&quot;></td><td class=&quot;res-pct&quot;></td><td class=&quot;res-cum&quot;></td><td class=&quot;res-pass&quot;></td><td>25-40</td><td><input type=&quot;text&quot; class=&quot;tbl-input&quot;></td></tr>
                <tr data-min=&quot;15&quot; data-max=&quot;30&quot;><td>6</td><td>2.36 MM</td><td><input type=&quot;number&quot; class=&quot;tbl-input weight-input&quot; oninput=&quot;calculate(this.closest(&#39;.report-container&#39;))&quot;></td><td class=&quot;res-pct&quot;></td><td class=&quot;res-cum&quot;></td><td class=&quot;res-pass&quot;></td><td>15-30</td><td><input type=&quot;text&quot; class=&quot;tbl-input&quot;></td></tr>
                <tr data-min=&quot;8&quot; data-max=&quot;22&quot;><td>7</td><td>600 Mic.</td><td><input type=&quot;number&quot; class=&quot;tbl-input weight-input&quot; oninput=&quot;calculate(this.closest(&#39;.report-container&#39;))&quot;></td><td class=&quot;res-pct&quot;></td><td class=&quot;res-cum&quot;></td><td class=&quot;res-pass&quot;></td><td>8-22</td><td><input type=&quot;text&quot; class=&quot;tbl-input&quot;></td></tr>
                <tr data-min=&quot;0&quot; data-max=&quot;5&quot;><td>8</td><td>75 Mic.</td><td><input type=&quot;number&quot; class=&quot;tbl-input weight-input&quot; oninput=&quot;calculate(this.closest(&#39;.report-container&#39;))&quot;></td><td class=&quot;res-pct&quot;></td><td class=&quot;res-cum&quot;></td><td class=&quot;res-pass&quot;></td><td>0-5</td><td><input type=&quot;text&quot; class=&quot;tbl-input&quot;></td></tr>
                <tr style=&quot;font-weight: bold;&quot;>
                    <td></td><td>Total Wt.</td><td class=&quot;totalWtDisplay&quot;></td><td colspan=&quot;5&quot;></td>
                </tr>
            </tbody>
        </table>
        
        <div class=&quot;footer-section&quot;>
            <div style=&quot;display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px;&quot;>
                <div><strong>Memo No:</strong> <span class=&quot;editable&quot; contenteditable=&quot;true&quot; style=&quot;min-width: 100px;&quot;></span></div>
                <div style=&quot;margin-right: 150px;&quot;><strong>Date:</strong> <span class=&quot;editable&quot; contenteditable=&quot;true&quot; style=&quot;min-width: 150px;&quot;></span></div>
            </div>
            <p><strong>Copy Forwarded to:-</strong> Executive Engineer, R.W.D, Works Division, <span class=&quot;editable location-placeholder&quot; contenteditable=&quot;true&quot;>Nawada</span></p>
            <div class=&quot;signature-row&quot;>
                <div class=&quot;signature-box&quot;><br><br><strong>T.S.</strong></div>
                <div class=&quot;signature-box&quot;>
                    <br><br><strong>A.E.</strong><br>
                    R.W.D, Testing and Quality Control Laboratory,<br>
                    <span class=&quot;editable location-placeholder&quot; contenteditable=&quot;true&quot;>Nawada</span>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // Toggle Logic
    function toggleMode() {
        const mode = document.querySelector(&#39;input[name=&quot;genMode&quot;]:checked&#39;).value;
        const qtyBox = document.getElementById(&#39;quantityBox&#39;);
        const listBox = document.getElementById(&#39;listBox&#39;);
        
        if (mode === &#39;quantity&#39;) {
            qtyBox.classList.remove(&#39;hidden&#39;);
            listBox.classList.add(&#39;hidden&#39;);
        } else {
            qtyBox.classList.add(&#39;hidden&#39;);
            listBox.classList.remove(&#39;hidden&#39;);
        }
    }

    // Line Numbers & Sync Scroll
    function updateLineNumbers() {
        const textarea = document.getElementById(&#39;roadListInput&#39;);
        const lines = textarea.value.split(&#39;\n&#39;).length;
        const lineNumbersElem = document.getElementById(&#39;lineNumbers&#39;);
        
        let numbersHTML = &#39;&#39;;
        for (let i = 1; i <= lines; i++) {
            numbersHTML += i + &#39;<br>&#39;;
        }
        lineNumbersElem.innerHTML = numbersHTML;
        
        const nonEmptyLines = textarea.value.split(&#39;\n&#39;).filter(line => line.trim() !== &quot;&quot;).length;
        document.getElementById(&#39;roadCountDisplay&#39;).innerText = nonEmptyLines;
    }

    function syncScroll() {
        const textarea = document.getElementById(&#39;roadListInput&#39;);
        const lineNumbersElem = document.getElementById(&#39;lineNumbers&#39;);
        lineNumbersElem.scrollTop = textarea.scrollTop;
    }

    function generateBulkReports() {
        const minWt = parseFloat(document.getElementById(&#39;minRange&#39;).value);
        const maxWt = parseFloat(document.getElementById(&#39;maxRange&#39;).value);
        const locName = document.getElementById(&#39;locationInput&#39;).value || &quot;Nawada&quot;;
        
        if (!minWt || !maxWt) {
            alert(&quot;Please enter Min and Max Weight.&quot;);
            return;
        }

        // Determine Mode
        const mode = document.querySelector(&#39;input[name=&quot;genMode&quot;]:checked&#39;).value;
        let reportsToGenerate = []; 

        if (mode === &#39;quantity&#39;) {
            const count = parseInt(document.getElementById(&#39;reportCount&#39;).value);
            if (!count) { alert(&quot;Please enter Quantity.&quot;); return; }
            for(let i=0; i<count; i++) {
                reportsToGenerate.push({ roadName: &quot;&quot; }); 
            }
        } else {
            // List Mode
            const listText = document.getElementById(&#39;roadListInput&#39;).value;
            const lines = listText.split(&#39;\n&#39;);
            
            lines.forEach(line => {
                if(line.trim() !== &quot;&quot;) {
                    reportsToGenerate.push({ roadName: line.trim() });
                }
            });
            
            if (reportsToGenerate.length === 0) {
                alert(&quot;Please paste at least one road name in the list.&quot;);
                return;
            }
        }

        const container = document.getElementById(&#39;main-output-area&#39;);
        const template = container.querySelector(&#39;.template-report&#39;).cloneNode(true);
        container.innerHTML = &#39;&#39;;

        reportsToGenerate.forEach(item => {
            let newReport = template.cloneNode(true);
            
            // Random Weight
            let randomSampleWt = Math.floor(Math.random() * (maxWt - minWt + 1)) + minWt;
            newReport.querySelector(&#39;.manualSampleWt&#39;).value = randomSampleWt;

            // Update Location
            newReport.querySelectorAll(&#39;.location-placeholder&#39;).forEach(span => {
                span.innerText = locName;
            });
            
            // Update Road Name
            if (item.roadName) {
                newReport.querySelector(&#39;.road-name-field&#39;).innerText = item.roadName;
            }

            container.appendChild(newReport);
            autoFillWeights(newReport, randomSampleWt);
        });
    }

    function autoFillWeights(reportElement, sampleWt) {
        if (!sampleWt) sampleWt = parseFloat(reportElement.querySelector(&#39;.manualSampleWt&#39;).value);
        
        const rows = reportElement.querySelectorAll(&#39;.calcTable tr[data-min]&#39;);
        let accumulatedWeight = 0;
        let currentPassing = 100;
        
        // Loop through all except the last one for random generation
        for (let i = 0; i < rows.length - 1; i++) {
            let row = rows[i];
            const minLim = parseFloat(row.getAttribute(&#39;data-min&#39;));
            const maxLim = parseFloat(row.getAttribute(&#39;data-max&#39;));
            let effectiveMax = Math.min(maxLim, currentPassing);
            let effectiveMin = minLim;
            if (effectiveMin > effectiveMax) effectiveMin = effectiveMax; 
            
            let randomPassing = (Math.random() * (effectiveMax - effectiveMin)) + effectiveMin;
            randomPassing = Math.round(randomPassing * 100) / 100;
            
            let targetCumWeight = ((100 - randomPassing) / 100) * sampleWt;
            let individualWeight = Math.round(targetCumWeight - accumulatedWeight);
            if (individualWeight < 0) individualWeight = 0;
            
            row.querySelector(&#39;.weight-input&#39;).value = individualWeight;
            accumulatedWeight += individualWeight;
            
            currentPassing = 100 - ((accumulatedWeight / sampleWt) * 100);
        }
        
        // The last row (75 Mic) takes the remainder
        let lastRow = rows[rows.length - 1];
        let finalWeight = Math.max(0, sampleWt - accumulatedWeight);
        lastRow.querySelector(&#39;.weight-input&#39;).value = finalWeight;
        
        calculate(reportElement);
    }

    function calculate(reportElement) {
        if (!reportElement) return;
        const rows = reportElement.querySelectorAll(&#39;.calcTable tr&#39;);
        let totalSumWeight = 0;
        let manualSampleWt = parseFloat(reportElement.querySelector(&#39;.manualSampleWt&#39;).value);
        
        rows.forEach((row, index) => {
            if (index < rows.length - 1) { 
                const input = row.querySelector(&#39;.weight-input&#39;);
                if (input) {
                    const val = parseFloat(input.value);
                    if (!isNaN(val)) totalSumWeight += val;
                }
            }
        });
        
        const totalDisp = reportElement.querySelector(&#39;.totalWtDisplay&#39;);
        if (manualSampleWt > 0) {
             if(totalDisp) totalDisp.innerText = manualSampleWt.toFixed(0);
        } else {
             if(totalDisp) totalDisp.innerText = totalSumWeight > 0 ? totalSumWeight.toFixed(0) : &quot;&quot;;
        }
        
        let divisor = manualSampleWt > 0 ? manualSampleWt : totalSumWeight;
        let accumulatedWeight = 0;
        
        rows.forEach((row, index) => {
            if (index < rows.length - 1) {
                const input = row.querySelector(&#39;.weight-input&#39;);
                if (input) {
                    const weight = parseFloat(input.value) || 0;
                    accumulatedWeight += weight;
                    if (divisor > 0) {
                        let pctRetained = (weight / divisor) * 100;
                        let cumRetained = (accumulatedWeight / divisor) * 100;
                        let passing = Math.max(0, 100 - cumRetained);
                        if (passing < 0.01) passing = 0.00; 
                        
                        row.querySelector(&#39;.res-pct&#39;).innerText = pctRetained.toFixed(2);
                        row.querySelector(&#39;.res-cum&#39;).innerText = cumRetained.toFixed(2);
                        row.querySelector(&#39;.res-pass&#39;).innerText = passing.toFixed(2);
                    }
                }
            }
        });
    }

    // ========== DRAGGABLE CONTROLS (MOBILE FIXED) ==========
    (function() {
        let isDragging = false;
        let currentPanel = null;
        let offsetX = 0;
        let offsetY = 0;
        let startX = 0;
        let startY = 0;
        let hasMoved = false;

        document.querySelectorAll('.drag-handle').forEach(handle => {
            handle.addEventListener('touchstart', handleTouchStart, { passive: false });
            handle.addEventListener('mousedown', handleMouseStart);
        });

        function handleTouchStart(e) {
            const panel = e.target.closest('.action-btn-container') || e.target.closest('.controls');
            if (!panel) return;
            
            if (panel.classList.contains('minimized')) {
                toggleMinimize(e.target);
                return;
            }
            
            const touch = e.touches[0];
            startX = touch.clientX;
            startY = touch.clientY;
            
            const rect = panel.getBoundingClientRect();
            offsetX = touch.clientX - rect.left;
            offsetY = touch.clientY - rect.top;
            
            isDragging = true;
            currentPanel = panel;
            hasMoved = false;
            
            panel.style.transition = 'none';
            
            document.addEventListener('touchmove', handleTouchMove, { passive: false });
            document.addEventListener('touchend', handleTouchEnd);
        }

        function handleMouseStart(e) {
            const panel = e.target.closest('.action-btn-container') || e.target.closest('.controls');
            if (!panel) return;
            
            if (panel.classList.contains('minimized')) {
                toggleMinimize(e.target);
                return;
            }
            
            startX = e.clientX;
            startY = e.clientY;
            
            const rect = panel.getBoundingClientRect();
            offsetX = e.clientX - rect.left;
            offsetY = e.clientY - rect.top;
            
            isDragging = true;
            currentPanel = panel;
            hasMoved = false;
            
            panel.style.transition = 'none';
            
            document.addEventListener('mousemove', handleMouseMove);
            document.addEventListener('mouseup', handleMouseEnd);
        }

        function handleTouchMove(e) {
            if (!isDragging || !currentPanel) return;
            
            const touch = e.touches[0];
            const deltaX = Math.abs(touch.clientX - startX);
            const deltaY = Math.abs(touch.clientY - startY);
            
            // Only drag if moved more than 5px
            if (deltaX > 5 || deltaY > 5) {
                hasMoved = true;
                
                let newX = touch.clientX - offsetX;
                let newY = touch.clientY - offsetY;
                
                const maxX = window.innerWidth - currentPanel.offsetWidth;
                const maxY = window.innerHeight - currentPanel.offsetHeight;
                
                newX = Math.max(0, Math.min(newX, maxX));
                newY = Math.max(0, Math.min(newY, maxY));
                
                currentPanel.style.left = newX + 'px';
                currentPanel.style.top = newY + 'px';
                currentPanel.style.right = 'auto';
                
                e.preventDefault();
            }
        }

        function handleMouseMove(e) {
            if (!isDragging || !currentPanel) return;
            
            const deltaX = Math.abs(e.clientX - startX);
            const deltaY = Math.abs(e.clientY - startY);
            
            if (deltaX > 5 || deltaY > 5) {
                hasMoved = true;
                
                let newX = e.clientX - offsetX;
                let newY = e.clientY - offsetY;
                
                const maxX = window.innerWidth - currentPanel.offsetWidth;
                const maxY = window.innerHeight - currentPanel.offsetHeight;
                
                newX = Math.max(0, Math.min(newX, maxX));
                newY = Math.max(0, Math.min(newY, maxY));
                
                currentPanel.style.left = newX + 'px';
                currentPanel.style.top = newY + 'px';
                currentPanel.style.right = 'auto';
            }
        }

        function handleTouchEnd() {
            if (isDragging && currentPanel) {
                currentPanel.style.transition = 'all 0.3s ease';
            }
            isDragging = false;
            currentPanel = null;
            
            document.removeEventListener('touchmove', handleTouchMove);
            document.removeEventListener('touchend', handleTouchEnd);
        }

        function handleMouseEnd() {
            if (isDragging && currentPanel) {
                currentPanel.style.transition = 'all 0.3s ease';
            }
            isDragging = false;
            currentPanel = null;
            
            document.removeEventListener('mousemove', handleMouseMove);
            document.removeEventListener('mouseup', handleMouseEnd);
        }

        window.toggleMinimize = function(btn) {
            const panel = btn.closest('.action-btn-container') || btn.closest('.controls');
            if (!panel) return;
            panel.classList.toggle('minimized');
        };
    })();

</script>
</body>
</html>"
            style="width: 100%; height: calc(100vh - 160px); border: none; display: block;"
            sandbox="allow-scripts allow-same-origin allow-forms allow-modals"
        ></iframe>
    </div>

    <!-- GSB-I Gradation TEST -->
    <div id="gsb_i_gradation" class="test-wrapper">
        <iframe 
            srcdoc="<!DOCTYPE html>
<html lang=&quot;en&quot;>
<head>
    <meta charset=&quot;UTF-8&quot;>
    <meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;>
    <title>Bulk GSB Grade-I Generator</title>
    <style>
        /* --- SDBC STYLE CSS --- */
        body { font-family: &quot;Times New Roman&quot;, Times, serif; margin: 0; padding: 20px; background-color: #f0f0f0; }
        
        /* Report Container Style */
        .report-container { 
            width: 210mm; 
            min-height: 297mm; 
            background-color: white; 
            margin: auto; 
            padding: 20px 40px; 
            box-shadow: 0 0 10px rgba(0,0,0,0.1); 
            box-sizing: border-box; 
            position: relative; 
            margin-bottom: 20px; 
        }
        
        .header { text-align: center; margin-bottom: 20px; }
        .header h2, .header h3 { margin: 5px 0; text-transform: uppercase; }
        .header h3 { font-size: 16px; font-weight: bold; }
        .title { text-align: center; font-weight: bold; text-decoration: underline; margin: 20px 0; font-size: 18px; }
        
        .info-table { width: 100%; margin-bottom: 20px; font-size: 14px; border-collapse: collapse; }
        .info-table td { padding: 5px 2px; vertical-align: top; border: none; line-height: 1.6; }
        
        .data-table { width: 100%; border-collapse: collapse; font-size: 13px; margin-bottom: 30px; text-align: center; }
        .data-table th, .data-table td { border: 1px solid black; padding: 5px; height: 30px; vertical-align: middle; }
        .data-table th { background-color: #f2f2f2; font-weight: bold; }
        
        .footer-section { margin-top: 50px; font-size: 14px; line-height: 1.6; }
        .signature-row { display: flex; justify-content: space-between; margin-top: 80px; align-items: flex-start; }
        .signature-box { text-align: center; width: 250px; }

        /* EDITABLE FIELDS */
        .editable {
            border-bottom: 1px dotted #999;
            outline: none;
            font-weight: bold;
            color: #000;
            display: inline; 
            min-width: 50px;
        }
        .editable:empty::before { content: &quot;\00a0\00a0\00a0\00a0\00a0\00a0\00a0&quot;; color: #ccc; }
        
        .tbl-input { width: 100%; border: none; text-align: center; font-family: inherit; font-size: inherit; background: transparent; outline: none; }
        .weight-input { background-color: #eef; font-weight: bold; } 
        
        .wt-input { 
            width: 70px; 
            text-align: right; 
            border: none; 
            border-bottom: 1px dotted #999; 
            font-family: inherit; 
            font-size: inherit; 
            font-weight: bold; 
            outline: none;
        }

        /* Control Panel Styles - DRAGGABLE */
        .action-btn-container {
            position: fixed; top: 20px; right: 20px; z-index: 9999;
            background: rgba(255, 255, 255, 0.98);
            padding: 0; border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            border: 1px solid #ccc; width: 260px;
            transition: all 0.3s ease;
        }
        .action-btn-container.minimized { width: 50px; height: 50px; border-radius: 50%; }
        .drag-handle {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white; padding: 10px; cursor: move;
            display: flex; justify-content: space-between; align-items: center;
            border-radius: 8px 8px 0 0; user-select: none; touch-action: none;
            -webkit-user-select: none;
            -webkit-touch-callout: none;
        }
        .minimized .drag-handle { border-radius: 50%; width: 50px; height: 50px; justify-content: center; padding: 0; }
        .drag-handle h4 { margin: 0; font-size: 14px; font-weight: bold; flex: 1; }
        .minimized .drag-handle h4 { display: none; }
        .minimize-btn {
            background: rgba(255,255,255,0.3); border: none; color: white;
            width: 24px; height: 24px; border-radius: 4px; cursor: pointer; font-size: 16px;
        }
        .minimized .minimize-btn { display: none; }
        .control-content { padding: 15px; max-height: calc(90vh - 44px); overflow-y: auto; }
        .minimized .control-content { display: none; }
        .minimized-icon { display: none; font-size: 24px; }
        .minimized .minimized-icon { display: block; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); }
        .action-btn-container h4 { margin: 0 0 10px 0; font-family: sans-serif; text-align: center; color: #333; border-bottom: 1px solid #ddd; padding-bottom: 5px; }
        
        .input-group { display: flex; flex-direction: column; margin-bottom: 8px; }
        .input-group label { font-size: 12px; font-family: sans-serif; font-weight: bold; margin-bottom: 3px; }
        .input-group input, .input-group select { padding: 5px; border: 1px solid #aaa; border-radius: 4px; }

        /* Toggle Switch Style */
        .mode-toggle { display: flex; align-items: center; margin-bottom: 10px; background: #eee; padding: 5px; border-radius: 5px; }
        .mode-toggle label { flex: 1; font-size: 12px; font-family: sans-serif; cursor: pointer; display: flex; align-items: center; }
        .mode-toggle input { margin-right: 5px; }

        /* List Editor Style with Line Numbers */
        .list-editor-container {
            display: flex;
            border: 1px solid #aaa;
            border-radius: 4px;
            height: 120px;
            font-family: monospace;
            font-size: 12px;
            background: white;
            margin-bottom: 8px;
        }
        .line-numbers {
            width: 25px;
            background-color: #f0f0f0;
            color: #888;
            text-align: right;
            padding: 5px 2px;
            border-right: 1px solid #ddd;
            line-height: 1.4;
            overflow: hidden;
            user-select: none;
        }
        .road-list-area {
            flex: 1;
            border: none;
            padding: 5px;
            line-height: 1.4;
            resize: none;
            outline: none;
            white-space: pre;
            overflow-y: scroll;
        }

        .hidden { display: none; }

        .btn { color: white; border: none; padding: 10px; font-size: 14px; font-weight: bold; cursor: pointer; border-radius: 5px; font-family: sans-serif; margin-top: 5px; transition: 0.2s; }
        .print-btn { background-color: #dc3545; }
        .magic-btn { background-color: #28a745; }
        .clear-btn { background-color: #6c757d; }
        .btn:hover { opacity: 0.9; transform: scale(1.02); }

        @media print { 
            body { background-color: white; padding: 0; } 
            .report-container { 
                box-shadow: none; margin: 0; width: 100%; 
                page-break-after: always; 
            }
            .report-container:last-child { page-break-after: auto; }
            .action-btn-container { display: none; }
            .weight-input { background-color: transparent; }
            .editable, .wt-input, .tbl-input { border: none !important; }
            .editable:empty::before { display: none; }
        }
        @media screen { .editable:hover { background-color: rgba(0, 0, 255, 0.05); } }
    </style>
</head>
<body>

<div class=&quot;action-btn-container&quot;>
    <div class=&quot;drag-handle&quot;>
        <h4>GSB Gr-I AI Control</h4>
        <button class=&quot;minimize-btn&quot; onclick=&quot;toggleMinimize(this)&quot;>‚àí</button>
        <span class=&quot;minimized-icon&quot;>‚öôÔ∏è</span>
    </div>
    <div class=&quot;control-content&quot;>
    
    <div class=&quot;input-group&quot;>
        <label>Division/Location:</label>
        <input type=&quot;text&quot; id=&quot;locationInput&quot; value=&quot;Nawada&quot; placeholder=&quot;e.g. RAJAULI&quot;>
    </div>

    <div class=&quot;mode-toggle&quot;>
        <label>
            <input type=&quot;radio&quot; name=&quot;genMode&quot; value=&quot;quantity&quot; onchange=&quot;toggleMode()&quot; checked> 
            <strong>Quantity Only</strong>
        </label>
        <label>
            <input type=&quot;radio&quot; name=&quot;genMode&quot; value=&quot;list&quot; onchange=&quot;toggleMode()&quot;> 
            <strong>Road Name List</strong>
        </label>
    </div>

    <div id=&quot;quantityBox&quot; class=&quot;input-group&quot;>
        <label>Quantity (No. of Reports):</label>
        <input type=&quot;number&quot; id=&quot;reportCount&quot; value=&quot;10&quot;>
    </div>

    <div id=&quot;listBox&quot; class=&quot;input-group hidden&quot;>
        <label>Paste Road Names Below:</label>
        <div class=&quot;list-editor-container&quot;>
            <div class=&quot;line-numbers&quot; id=&quot;lineNumbers&quot;>1</div>
            <textarea id=&quot;roadListInput&quot; class=&quot;road-list-area&quot; placeholder=&quot;Paste list here...&quot; oninput=&quot;updateLineNumbers()&quot; onscroll=&quot;syncScroll()&quot;></textarea>
        </div>
        <div style=&quot;font-size: 11px; color: #666; text-align: right;&quot;>Total Roads: <span id=&quot;roadCountDisplay&quot;>0</span></div>
    </div>

    <div class=&quot;input-group&quot;>
        <label>Min Weight (gm):</label>
        <input type=&quot;number&quot; id=&quot;minRange&quot; value=&quot;80000&quot;>
    </div>
    
    <div class=&quot;input-group&quot;>
        <label>Max Weight (gm):</label>
        <input type=&quot;number&quot; id=&quot;maxRange&quot; value=&quot;81000&quot;>
    </div>

    <button class=&quot;btn magic-btn&quot; onclick=&quot;generateBulkReports()&quot;>‚ö° GENERATE BULK</button>
    <button class=&quot;btn print-btn&quot; onclick=&quot;window.print()&quot;>PRINT ALL üñ®Ô∏è</button>
    <button class=&quot;btn clear-btn&quot; onclick=&quot;location.reload()&quot;>RESET</button>
    </div></div>

<div id=&quot;main-output-area&quot;>
    <div class=&quot;report-container template-report&quot;>
        <div class=&quot;header&quot;>
            <h2>RURAL WORKS DEPARTMENT</h2>
            <h3>Testing and Quality Control Laboratory, <span class=&quot;editable location-placeholder&quot; contenteditable=&quot;true&quot;>Nawada</span></h3>
        </div>
        <div class=&quot;title&quot;>GRADATION TEST OF GSB (GRADE-I)</div>
        
        <table class=&quot;info-table&quot;>
            <tr>
                <td width=&quot;60%&quot;><strong>NAME OF ROAD :-</strong> <span class=&quot;editable road-name-field&quot; contenteditable=&quot;true&quot;></span></td>
                <td width=&quot;40%&quot;><strong>DATE OF COLLECTION/RECEIPT:-</strong> <span class=&quot;editable&quot; contenteditable=&quot;true&quot;></span></td>
            </tr>
            <tr>
                <td><strong>NAME OF WORKS DIVISION:-</strong> <span class=&quot;editable&quot; contenteditable=&quot;true&quot;>R.W.D WORKS DIVISION </span></td>
                <td><strong>DATE OF TEST:-</strong> <span class=&quot;editable&quot; contenteditable=&quot;true&quot;></span></td>
            </tr>
            <tr>
                <td><strong>NAME OF AGENCY :-</strong> <span class=&quot;editable&quot; contenteditable=&quot;true&quot;></span></td>
                <td><strong>PACKAGE NO:-</strong> <span class=&quot;editable&quot; contenteditable=&quot;true&quot;></span></td>
            </tr>
            <tr>
                <td colspan=&quot;2&quot;><strong>AGREEMENT NO:-</strong> <span class=&quot;editable&quot; contenteditable=&quot;true&quot;></span></td>
            </tr>
            <tr>
                <td colspan=&quot;2&quot;>
                    <strong>Ref:-</strong> <span class=&quot;editable&quot; contenteditable=&quot;true&quot;>A.E, R.W.D WORKS SUB DIV-         </span>
                    <span style=&quot;margin-left: 30px;&quot;><strong>Chainage:-</strong> <span class=&quot;editable&quot; contenteditable=&quot;true&quot;></span></span>
                </td>
            </tr>
            <tr>
                <td colspan=&quot;2&quot; style=&quot;padding-top: 10px;&quot;>
                    <strong>LT NO:-</strong> <span class=&quot;editable&quot; contenteditable=&quot;true&quot; style=&quot;min-width: 80px;&quot;></span> 
                    <span style=&quot;margin-left: 50px;&quot;><strong>DT:-</strong> <span class=&quot;editable&quot; contenteditable=&quot;true&quot; style=&quot;min-width: 80px;&quot;></span></span>
                    <span style=&quot;margin-left: 50px;&quot;>
                        <strong>Sample Wt:-</strong> 
                        <input type=&quot;number&quot; class=&quot;wt-input manualSampleWt&quot; value=&quot;80475&quot; oninput=&quot;calculate(this.closest(&#39;.report-container&#39;))&quot;>gm
                    </span>
                </td>
            </tr>
        </table>
        
        <table class=&quot;data-table&quot;>
            <thead>
                <tr>
                    <th width=&quot;8%&quot;>SL. NO</th>
                    <th width=&quot;15%&quot;>Sieve No.<br>mm</th>
                    <th width=&quot;15%&quot;>Weight Retained<br>(gm)</th>
                    <th width=&quot;12%&quot;>% Wt. Of<br>Retained</th>
                    <th width=&quot;15%&quot;>Cumulative %<br>Retained</th>
                    <th width=&quot;12%&quot;>% Of Passing</th>
                    <th width=&quot;13%&quot;>Required<br>Limit %</th>
                    <th>Remarks</th>
                </tr>
            </thead>
            <tbody class=&quot;calcTable&quot;>
                <tr data-min=&quot;100&quot; data-max=&quot;100&quot;><td>1</td><td>75 mm</td><td><input type=&quot;number&quot; class=&quot;tbl-input weight-input&quot; oninput=&quot;calculate(this.closest(&#39;.report-container&#39;))&quot;></td><td class=&quot;res-pct&quot;></td><td class=&quot;res-cum&quot;></td><td class=&quot;res-pass&quot;></td><td>100</td><td><input type=&quot;text&quot; class=&quot;tbl-input&quot;></td></tr>
                <tr data-min=&quot;55&quot; data-max=&quot;75&quot;><td>2</td><td>26.5 mm</td><td><input type=&quot;number&quot; class=&quot;tbl-input weight-input&quot; oninput=&quot;calculate(this.closest(&#39;.report-container&#39;))&quot;></td><td class=&quot;res-pct&quot;></td><td class=&quot;res-cum&quot;></td><td class=&quot;res-pass&quot;></td><td>55-75</td><td><input type=&quot;text&quot; class=&quot;tbl-input&quot;></td></tr>
                <tr data-min=&quot;25&quot; data-max=&quot;55&quot;><td>3</td><td>4.75 mm</td><td><input type=&quot;number&quot; class=&quot;tbl-input weight-input&quot; oninput=&quot;calculate(this.closest(&#39;.report-container&#39;))&quot;></td><td class=&quot;res-pct&quot;></td><td class=&quot;res-cum&quot;></td><td class=&quot;res-pass&quot;></td><td>25-55</td><td><input type=&quot;text&quot; class=&quot;tbl-input&quot;></td></tr>
                <tr data-min=&quot;3&quot; data-max=&quot;10&quot; class=&quot;last-sieve-row&quot;><td>4</td><td>0.075 mm</td><td><input type=&quot;number&quot; class=&quot;tbl-input weight-input&quot; oninput=&quot;calculate(this.closest(&#39;.report-container&#39;))&quot;></td><td class=&quot;res-pct&quot;></td><td class=&quot;res-cum&quot;></td><td class=&quot;res-pass&quot;></td><td>3-10</td><td><input type=&quot;text&quot; class=&quot;tbl-input&quot;></td></tr>
                <tr style=&quot;font-weight: bold;&quot;>
                    <td></td><td>Total Wt.</td><td class=&quot;totalWtDisplay&quot;></td><td colspan=&quot;5&quot;></td>
                </tr>
            </tbody>
        </table>
        
        <div class=&quot;footer-section&quot;>
            <div style=&quot;display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px;&quot;>
                <div><strong>Memo No:</strong> <span class=&quot;editable&quot; contenteditable=&quot;true&quot; style=&quot;min-width: 100px;&quot;></span></div>
                <div style=&quot;margin-right: 150px;&quot;><strong>Date:</strong> <span class=&quot;editable&quot; contenteditable=&quot;true&quot; style=&quot;min-width: 150px;&quot;></span></div>
            </div>
            <p><strong>Copy Forwarded to:-</strong> Executive Engineer, R.W.D, Works Division, <span class=&quot;editable location-placeholder&quot; contenteditable=&quot;true&quot;>Nawada</span></p>
            <div class=&quot;signature-row&quot;>
                <div class=&quot;signature-box&quot;><br><br><strong>T.S.</strong></div>
                <div class=&quot;signature-box&quot;>
                    <br><br><strong>A.E.</strong><br>
                    R.W.D, Testing and Quality Control Laboratory,<br>
                    <span class=&quot;editable location-placeholder&quot; contenteditable=&quot;true&quot;>Nawada</span>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // Toggle Logic
    function toggleMode() {
        const mode = document.querySelector(&#39;input[name=&quot;genMode&quot;]:checked&#39;).value;
        const qtyBox = document.getElementById(&#39;quantityBox&#39;);
        const listBox = document.getElementById(&#39;listBox&#39;);
        
        if (mode === &#39;quantity&#39;) {
            qtyBox.classList.remove(&#39;hidden&#39;);
            listBox.classList.add(&#39;hidden&#39;);
        } else {
            qtyBox.classList.add(&#39;hidden&#39;);
            listBox.classList.remove(&#39;hidden&#39;);
        }
    }

    // Line Numbers & Sync Scroll
    function updateLineNumbers() {
        const textarea = document.getElementById(&#39;roadListInput&#39;);
        const lines = textarea.value.split(&#39;\n&#39;).length;
        const lineNumbersElem = document.getElementById(&#39;lineNumbers&#39;);
        
        let numbersHTML = &#39;&#39;;
        for (let i = 1; i <= lines; i++) {
            numbersHTML += i + &#39;<br>&#39;;
        }
        lineNumbersElem.innerHTML = numbersHTML;
        
        const nonEmptyLines = textarea.value.split(&#39;\n&#39;).filter(line => line.trim() !== &quot;&quot;).length;
        document.getElementById(&#39;roadCountDisplay&#39;).innerText = nonEmptyLines;
    }

    function syncScroll() {
        const textarea = document.getElementById(&#39;roadListInput&#39;);
        const lineNumbersElem = document.getElementById(&#39;lineNumbers&#39;);
        lineNumbersElem.scrollTop = textarea.scrollTop;
    }

    function generateBulkReports() {
        const minWt = parseFloat(document.getElementById(&#39;minRange&#39;).value);
        const maxWt = parseFloat(document.getElementById(&#39;maxRange&#39;).value);
        const locName = document.getElementById(&#39;locationInput&#39;).value || &quot;Nawada&quot;;
        
        if (!minWt || !maxWt) {
            alert(&quot;Please enter Min and Max Weight.&quot;);
            return;
        }

        // Determine Mode
        const mode = document.querySelector(&#39;input[name=&quot;genMode&quot;]:checked&#39;).value;
        let reportsToGenerate = []; 

        if (mode === &#39;quantity&#39;) {
            const count = parseInt(document.getElementById(&#39;reportCount&#39;).value);
            if (!count) { alert(&quot;Please enter Quantity.&quot;); return; }
            for(let i=0; i<count; i++) {
                reportsToGenerate.push({ roadName: &quot;&quot; }); 
            }
        } else {
            // List Mode
            const listText = document.getElementById(&#39;roadListInput&#39;).value;
            const lines = listText.split(&#39;\n&#39;);
            
            lines.forEach(line => {
                if(line.trim() !== &quot;&quot;) {
                    reportsToGenerate.push({ roadName: line.trim() });
                }
            });
            
            if (reportsToGenerate.length === 0) {
                alert(&quot;Please paste at least one road name in the list.&quot;);
                return;
            }
        }

        const container = document.getElementById(&#39;main-output-area&#39;);
        const template = container.querySelector(&#39;.template-report&#39;).cloneNode(true);
        container.innerHTML = &#39;&#39;;

        reportsToGenerate.forEach(item => {
            let newReport = template.cloneNode(true);
            
            // Random Weight
            let randomSampleWt = Math.floor(Math.random() * (maxWt - minWt + 1)) + minWt;
            newReport.querySelector(&#39;.manualSampleWt&#39;).value = randomSampleWt;

            // Update Location
            newReport.querySelectorAll(&#39;.location-placeholder&#39;).forEach(span => {
                span.innerText = locName;
            });
            
            // Update Road Name
            if (item.roadName) {
                newReport.querySelector(&#39;.road-name-field&#39;).innerText = item.roadName;
            }

            container.appendChild(newReport);
            autoFillWeights(newReport, randomSampleWt);
        });
    }

    function autoFillWeights(reportElement, sampleWt) {
        if (!sampleWt) sampleWt = parseFloat(reportElement.querySelector(&#39;.manualSampleWt&#39;).value);
        
        const rows = reportElement.querySelectorAll(&#39;.calcTable tr[data-min]&#39;);
        let accumulatedWeight = 0;
        let currentPassing = 100;
        let targetPassingFactor = 0.94; // Preserved Logic

        rows.forEach((row) => {
            if (row.classList.contains(&#39;last-sieve-row&#39;)) {
                let remaining = Math.max(0, sampleWt - accumulatedWeight);
                row.querySelector(&#39;.weight-input&#39;).value = remaining;
                return;
            }
            const minLim = parseFloat(row.getAttribute(&#39;data-min&#39;));
            const maxLim = parseFloat(row.getAttribute(&#39;data-max&#39;));
            let effectiveMax = Math.min(maxLim, currentPassing);
            let effectiveMin = minLim;
            if (effectiveMin > effectiveMax) effectiveMin = effectiveMax; 
            
            let randomPassing = Math.round((Math.random() * (effectiveMax - effectiveMin) + effectiveMin) * 100) / 100;
            let targetCumWeight = ((100 - randomPassing) / 100) * sampleWt * targetPassingFactor; 
            let individualWeight = Math.round(Math.max(0, targetCumWeight - accumulatedWeight));
            
            row.querySelector(&#39;.weight-input&#39;).value = individualWeight;
            accumulatedWeight += individualWeight;
            currentPassing = randomPassing;
        });
        
        calculate(reportElement);
    }

    function calculate(reportElement) {
        if (!reportElement) return;
        const rows = reportElement.querySelectorAll(&#39;.calcTable tr&#39;);
        let totalSumWeight = 0;
        let manualSampleWt = parseFloat(reportElement.querySelector(&#39;.manualSampleWt&#39;).value);
        
        rows.forEach((row, index) => {
            if (index < rows.length - 1) { 
                const input = row.querySelector(&#39;.weight-input&#39;);
                if (input) {
                    const val = parseFloat(input.value);
                    if (!isNaN(val)) totalSumWeight += val;
                }
            }
        });
        
        const totalDisp = reportElement.querySelector(&#39;.totalWtDisplay&#39;);
        if(totalDisp) {
            totalDisp.innerText = (manualSampleWt > 0) ? manualSampleWt.toFixed(0) : (totalSumWeight > 0 ? totalSumWeight.toFixed(0) : &quot;&quot;);
        }

        let passingTarget = 0.055; // Preserved Logic
        let virtualDivisor = (manualSampleWt > 0) ? (manualSampleWt / (1 - passingTarget)) : totalSumWeight;
        let accumulatedWeight = 0;
        
        rows.forEach((row, index) => {
            if (index < rows.length - 1) {
                const input = row.querySelector(&#39;.weight-input&#39;);
                if (input) {
                    const weight = parseFloat(input.value) || 0;
                    accumulatedWeight += weight;
                    if (virtualDivisor > 0) {
                        let pctRetained = (weight / virtualDivisor) * 100;
                        let cumRetained = (accumulatedWeight / virtualDivisor) * 100;
                        let passing = Math.max(0, 100 - cumRetained);
                        
                        row.querySelector(&#39;.res-pct&#39;).innerText = pctRetained.toFixed(2);
                        row.querySelector(&#39;.res-cum&#39;).innerText = cumRetained.toFixed(2);
                        row.querySelector(&#39;.res-pass&#39;).innerText = passing.toFixed(2);
                    }
                }
            }
        });
    }

    // ========== DRAGGABLE CONTROLS (MOBILE FIXED) ==========
    (function() {
        let isDragging = false;
        let currentPanel = null;
        let offsetX = 0;
        let offsetY = 0;
        let startX = 0;
        let startY = 0;
        let hasMoved = false;

        document.querySelectorAll('.drag-handle').forEach(handle => {
            handle.addEventListener('touchstart', handleTouchStart, { passive: false });
            handle.addEventListener('mousedown', handleMouseStart);
        });

        function handleTouchStart(e) {
            const panel = e.target.closest('.action-btn-container') || e.target.closest('.controls');
            if (!panel) return;
            
            if (panel.classList.contains('minimized')) {
                toggleMinimize(e.target);
                return;
            }
            
            const touch = e.touches[0];
            startX = touch.clientX;
            startY = touch.clientY;
            
            const rect = panel.getBoundingClientRect();
            offsetX = touch.clientX - rect.left;
            offsetY = touch.clientY - rect.top;
            
            isDragging = true;
            currentPanel = panel;
            hasMoved = false;
            
            panel.style.transition = 'none';
            
            document.addEventListener('touchmove', handleTouchMove, { passive: false });
            document.addEventListener('touchend', handleTouchEnd);
        }

        function handleMouseStart(e) {
            const panel = e.target.closest('.action-btn-container') || e.target.closest('.controls');
            if (!panel) return;
            
            if (panel.classList.contains('minimized')) {
                toggleMinimize(e.target);
                return;
            }
            
            startX = e.clientX;
            startY = e.clientY;
            
            const rect = panel.getBoundingClientRect();
            offsetX = e.clientX - rect.left;
            offsetY = e.clientY - rect.top;
            
            isDragging = true;
            currentPanel = panel;
            hasMoved = false;
            
            panel.style.transition = 'none';
            
            document.addEventListener('mousemove', handleMouseMove);
            document.addEventListener('mouseup', handleMouseEnd);
        }

        function handleTouchMove(e) {
            if (!isDragging || !currentPanel) return;
            
            const touch = e.touches[0];
            const deltaX = Math.abs(touch.clientX - startX);
            const deltaY = Math.abs(touch.clientY - startY);
            
            // Only drag if moved more than 5px
            if (deltaX > 5 || deltaY > 5) {
                hasMoved = true;
                
                let newX = touch.clientX - offsetX;
                let newY = touch.clientY - offsetY;
                
                const maxX = window.innerWidth - currentPanel.offsetWidth;
                const maxY = window.innerHeight - currentPanel.offsetHeight;
                
                newX = Math.max(0, Math.min(newX, maxX));
                newY = Math.max(0, Math.min(newY, maxY));
                
                currentPanel.style.left = newX + 'px';
                currentPanel.style.top = newY + 'px';
                currentPanel.style.right = 'auto';
                
                e.preventDefault();
            }
        }

        function handleMouseMove(e) {
            if (!isDragging || !currentPanel) return;
            
            const deltaX = Math.abs(e.clientX - startX);
            const deltaY = Math.abs(e.clientY - startY);
            
            if (deltaX > 5 || deltaY > 5) {
                hasMoved = true;
                
                let newX = e.clientX - offsetX;
                let newY = e.clientY - offsetY;
                
                const maxX = window.innerWidth - currentPanel.offsetWidth;
                const maxY = window.innerHeight - currentPanel.offsetHeight;
                
                newX = Math.max(0, Math.min(newX, maxX));
                newY = Math.max(0, Math.min(newY, maxY));
                
                currentPanel.style.left = newX + 'px';
                currentPanel.style.top = newY + 'px';
                currentPanel.style.right = 'auto';
            }
        }

        function handleTouchEnd() {
            if (isDragging && currentPanel) {
                currentPanel.style.transition = 'all 0.3s ease';
            }
            isDragging = false;
            currentPanel = null;
            
            document.removeEventListener('touchmove', handleTouchMove);
            document.removeEventListener('touchend', handleTouchEnd);
        }

        function handleMouseEnd() {
            if (isDragging && currentPanel) {
                currentPanel.style.transition = 'all 0.3s ease';
            }
            isDragging = false;
            currentPanel = null;
            
            document.removeEventListener('mousemove', handleMouseMove);
            document.removeEventListener('mouseup', handleMouseEnd);
        }

        window.toggleMinimize = function(btn) {
            const panel = btn.closest('.action-btn-container') || btn.closest('.controls');
            if (!panel) return;
            panel.classList.toggle('minimized');
        };
    })();

</script>
</body>
</html>"
            style="width: 100%; height: calc(100vh - 160px); border: none; display: block;"
            sandbox="allow-scripts allow-same-origin allow-forms allow-modals"
        ></iframe>
    </div>

    <!-- GSB-II Gradation TEST -->
    <div id="gsb_ii_gradation" class="test-wrapper">
        <iframe 
            srcdoc="<!DOCTYPE html>
<html lang=&quot;en&quot;>
<head>
    <meta charset=&quot;UTF-8&quot;>
    <meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;>
    <title>Bulk GSB Grade-II Generator</title>
    <style>
        body { font-family: &quot;Times New Roman&quot;, Times, serif; margin: 0; padding: 20px; background-color: #f0f0f0; }
        
        /* Report Container Style */
        .report-container { 
            width: 210mm; 
            min-height: 297mm; 
            background-color: white; 
            margin: auto; 
            padding: 20px 40px; 
            box-shadow: 0 0 10px rgba(0,0,0,0.1); 
            box-sizing: border-box; 
            position: relative; 
            margin-bottom: 20px; 
        }
        
        .header { text-align: center; margin-bottom: 20px; }
        .header h2, .header h3 { margin: 5px 0; text-transform: uppercase; }
        .header h3 { font-size: 16px; font-weight: bold; }
        .title { text-align: center; font-weight: bold; text-decoration: underline; margin: 20px 0; font-size: 18px; }
        
        .info-table { width: 100%; margin-bottom: 20px; font-size: 14px; border-collapse: collapse; }
        .info-table td { padding: 5px 2px; vertical-align: top; border: none; line-height: 1.6; }
        
        .data-table { width: 100%; border-collapse: collapse; font-size: 13px; margin-bottom: 30px; text-align: center; }
        .data-table th, .data-table td { border: 1px solid black; padding: 5px; height: 30px; vertical-align: middle; }
        .data-table th { background-color: #f2f2f2; font-weight: bold; }
        
        .footer-section { margin-top: 50px; font-size: 14px; line-height: 1.6; }
        .signature-row { display: flex; justify-content: space-between; margin-top: 80px; align-items: flex-start; }
        .signature-box { text-align: center; width: 250px; }

        .editable {
            border-bottom: 1px dotted #999;
            outline: none;
            font-weight: bold;
            color: #000;
            display: inline; 
            min-width: 50px;
        }
        .editable:empty::before { content: &quot;\00a0\00a0\00a0\00a0\00a0\00a0\00a0&quot;; color: #ccc; }
        
        .tbl-input { width: 100%; border: none; text-align: center; font-family: inherit; font-size: inherit; background: transparent; outline: none; }
        .weight-input { background-color: #eef; font-weight: bold; } 
        
        .wt-input { 
            width: 70px; 
            text-align: right; 
            border: none; 
            border-bottom: 1px dotted #999; 
            font-family: inherit; 
            font-size: inherit; 
            font-weight: bold; 
            outline: none;
            margin-right: 2px;
        }

        /* Control Panel Styles - DRAGGABLE */
        .action-btn-container {
            position: fixed; top: 20px; right: 20px; z-index: 9999;
            background: rgba(255, 255, 255, 0.98);
            padding: 0; border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            border: 1px solid #ccc; width: 260px;
            transition: all 0.3s ease;
        }
        .action-btn-container.minimized { width: 50px; height: 50px; border-radius: 50%; }
        .drag-handle {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white; padding: 10px; cursor: move;
            display: flex; justify-content: space-between; align-items: center;
            border-radius: 8px 8px 0 0; user-select: none; touch-action: none;
            -webkit-user-select: none;
            -webkit-touch-callout: none;
        }
        .minimized .drag-handle { border-radius: 50%; width: 50px; height: 50px; justify-content: center; padding: 0; }
        .drag-handle h4 { margin: 0; font-size: 14px; font-weight: bold; flex: 1; }
        .minimized .drag-handle h4 { display: none; }
        .minimize-btn {
            background: rgba(255,255,255,0.3); border: none; color: white;
            width: 24px; height: 24px; border-radius: 4px; cursor: pointer; font-size: 16px;
        }
        .minimized .minimize-btn { display: none; }
        .control-content { padding: 15px; max-height: calc(90vh - 44px); overflow-y: auto; }
        .minimized .control-content { display: none; }
        .minimized-icon { display: none; font-size: 24px; }
        .minimized .minimized-icon { display: block; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); }
        .action-btn-container h4 { margin: 0 0 10px 0; font-family: sans-serif; text-align: center; color: #333; border-bottom: 1px solid #ddd; padding-bottom: 5px; }
        
        .input-group { display: flex; flex-direction: column; margin-bottom: 8px; }
        .input-group label { font-size: 12px; font-family: sans-serif; font-weight: bold; margin-bottom: 3px; }
        .input-group input, .input-group select { padding: 5px; border: 1px solid #aaa; border-radius: 4px; }

        /* Toggle Switch Style */
        .mode-toggle { display: flex; align-items: center; margin-bottom: 10px; background: #eee; padding: 5px; border-radius: 5px; }
        .mode-toggle label { flex: 1; font-size: 12px; font-family: sans-serif; cursor: pointer; display: flex; align-items: center; }
        .mode-toggle input { margin-right: 5px; }

        /* List Editor Style with Line Numbers */
        .list-editor-container {
            display: flex;
            border: 1px solid #aaa;
            border-radius: 4px;
            height: 120px;
            font-family: monospace;
            font-size: 12px;
            background: white;
            margin-bottom: 8px;
        }
        .line-numbers {
            width: 25px;
            background-color: #f0f0f0;
            color: #888;
            text-align: right;
            padding: 5px 2px;
            border-right: 1px solid #ddd;
            line-height: 1.4;
            overflow: hidden;
            user-select: none;
        }
        .road-list-area {
            flex: 1;
            border: none;
            padding: 5px;
            line-height: 1.4;
            resize: none;
            outline: none;
            white-space: pre;
            overflow-y: scroll;
        }

        .hidden { display: none; }

        .btn { color: white; border: none; padding: 10px; font-size: 14px; font-weight: bold; cursor: pointer; border-radius: 5px; font-family: sans-serif; margin-top: 5px; transition: 0.2s; }
        .print-btn { background-color: #dc3545; }
        .magic-btn { background-color: #28a745; }
        .clear-btn { background-color: #6c757d; }
        .btn:hover { opacity: 0.9; transform: scale(1.02); }

        @media print { 
            body { background-color: white; padding: 0; } 
            .report-container { 
                box-shadow: none; margin: 0; width: 100%; 
                page-break-after: always; 
            }
            .report-container:last-child { page-break-after: auto; }
            .action-btn-container { display: none; }
            .weight-input { background-color: transparent; }
            .editable, .wt-input, .tbl-input { border: none !important; }
            .editable:empty::before { display: none; }
        }
        @media screen { .editable:hover { background-color: rgba(0, 0, 255, 0.05); } }
    </style>
</head>
<body>

<div class=&quot;action-btn-container&quot;>
    <div class=&quot;drag-handle&quot;>
        <h4>GSB Gr-II AI Control</h4>
        <button class=&quot;minimize-btn&quot; onclick=&quot;toggleMinimize(this)&quot;>‚àí</button>
        <span class=&quot;minimized-icon&quot;>‚öôÔ∏è</span>
    </div>
    <div class=&quot;control-content&quot;>
    
    <div class=&quot;input-group&quot;>
        <label>Division/Location:</label>
        <input type=&quot;text&quot; id=&quot;locationInput&quot; value=&quot;Nawada&quot; placeholder=&quot;e.g. RAJAULI&quot;>
    </div>

    <div class=&quot;mode-toggle&quot;>
        <label>
            <input type=&quot;radio&quot; name=&quot;genMode&quot; value=&quot;quantity&quot; onchange=&quot;toggleMode()&quot; checked> 
            <strong>Quantity Only</strong>
        </label>
        <label>
            <input type=&quot;radio&quot; name=&quot;genMode&quot; value=&quot;list&quot; onchange=&quot;toggleMode()&quot;> 
            <strong>Road Name List</strong>
        </label>
    </div>

    <div id=&quot;quantityBox&quot; class=&quot;input-group&quot;>
        <label>Quantity (No. of Reports):</label>
        <input type=&quot;number&quot; id=&quot;reportCount&quot; value=&quot;10&quot;>
    </div>

    <div id=&quot;listBox&quot; class=&quot;input-group hidden&quot;>
        <label>Paste Road Names Below:</label>
        <div class=&quot;list-editor-container&quot;>
            <div class=&quot;line-numbers&quot; id=&quot;lineNumbers&quot;>1</div>
            <textarea id=&quot;roadListInput&quot; class=&quot;road-list-area&quot; placeholder=&quot;Paste list here...&quot; oninput=&quot;updateLineNumbers()&quot; onscroll=&quot;syncScroll()&quot;></textarea>
        </div>
        <div style=&quot;font-size: 11px; color: #666; text-align: right;&quot;>Total Roads: <span id=&quot;roadCountDisplay&quot;>0</span></div>
    </div>

    <div class=&quot;input-group&quot;>
        <label>Min Weight (gm):</label>
        <input type=&quot;number&quot; id=&quot;minRange&quot; value=&quot;20000&quot;>
    </div>
    
    <div class=&quot;input-group&quot;>
        <label>Max Weight (gm):</label>
        <input type=&quot;number&quot; id=&quot;maxRange&quot; value=&quot;21000&quot;>
    </div>

    <button class=&quot;btn magic-btn&quot; onclick=&quot;generateBulkReports()&quot;>‚ö° GENERATE BULK</button>
    <button class=&quot;btn print-btn&quot; onclick=&quot;window.print()&quot;>PRINT ALL üñ®Ô∏è</button>
    <button class=&quot;btn clear-btn&quot; onclick=&quot;location.reload()&quot;>RESET</button>
    </div></div>

<div id=&quot;main-output-area&quot;>
    <div class=&quot;report-container template-report&quot;>
        <div class=&quot;header&quot;>
            <h2>RURAL WORKS DEPARTMENT</h2>
            <h3>Testing and Quality Control Laboratory, <span class=&quot;editable location-placeholder&quot; contenteditable=&quot;true&quot;>Nawada</span></h3>
        </div>
        <div class=&quot;title&quot;>GRADATION TEST OF GSB (GRADE-II)</div>
        
        <table class=&quot;info-table&quot;>
            <tr>
                <td width=&quot;60%&quot;><strong>NAME OF ROAD :-</strong> <span class=&quot;editable road-name-field&quot; contenteditable=&quot;true&quot;></span></td>
                <td width=&quot;40%&quot;><strong>DATE OF COLLECTION/RECEIPT:-</strong> <span class=&quot;editable&quot; contenteditable=&quot;true&quot;></span></td>
            </tr>
            <tr>
                <td><strong>NAME OF WORKS DIVISION:-</strong> <span class=&quot;editable&quot; contenteditable=&quot;true&quot;>R.W.D WORKS DIVISION</span></td>
                <td><strong>DATE OF TEST:-</strong> <span class=&quot;editable&quot; contenteditable=&quot;true&quot;></span></td>
            </tr>
            <tr>
                <td><strong>NAME OF AGENCY :-</strong> <span class=&quot;editable&quot; contenteditable=&quot;true&quot;></span></td>
                <td><strong>PACKAGE NO:-</strong> <span class=&quot;editable&quot; contenteditable=&quot;true&quot;></span></td>
            </tr>
            <tr>
                <td colspan=&quot;2&quot;><strong>AGREEMENT NO:-</strong> <span class=&quot;editable&quot; contenteditable=&quot;true&quot;></span></td>
            </tr>
            <tr>
                <td colspan=&quot;2&quot;>
                    <strong>Ref:-</strong> <span class=&quot;editable&quot; contenteditable=&quot;true&quot;>A.E, R.W.D WORKS SUB DIV</span>
                    <span style=&quot;margin-left: 30px;&quot;>
                        <strong>Chainage:-</strong> 
                        <span class=&quot;editable&quot; contenteditable=&quot;true&quot; style=&quot;min-width: 50px;&quot;></span> <strong>km</strong>
                    </span>
                </td>
            </tr>
            <tr>
                <td colspan=&quot;2&quot; style=&quot;padding-top: 10px;&quot;>
                    <strong>LT NO:-</strong> <span class=&quot;editable&quot; contenteditable=&quot;true&quot; style=&quot;min-width: 80px;&quot;></span> 
                    <span style=&quot;margin-left: 50px;&quot;><strong>DT:-</strong> <span class=&quot;editable&quot; contenteditable=&quot;true&quot; style=&quot;min-width: 80px;&quot;></span></span>
                    <span style=&quot;margin-left: 50px;&quot;>
                        <strong>Sample Wt:-</strong> 
                        <input type=&quot;number&quot; class=&quot;wt-input manualSampleWt&quot; value=&quot;20000&quot; oninput=&quot;calculate(this.closest(&#39;.report-container&#39;))&quot;><strong>gm</strong>
                    </span>
                </td>
            </tr>
        </table>
        
        <table class=&quot;data-table&quot;>
            <thead>
                <tr>
                    <th width=&quot;8%&quot;>SL. NO</th>
                    <th width=&quot;15%&quot;>Sieve No.<br>mm</th>
                    <th width=&quot;15%&quot;>Weight Retained<br>(gm)</th>
                    <th width=&quot;12%&quot;>% Wt. Of<br>Retained</th>
                    <th width=&quot;15%&quot;>Cumulative %<br>Retained</th>
                    <th width=&quot;12%&quot;>% Of Passing</th>
                    <th width=&quot;13%&quot;>Required<br>Limit %</th>
                    <th>Remarks</th>
                </tr>
            </thead>
            <tbody class=&quot;calcTable&quot;>
                <tr data-min=&quot;100&quot; data-max=&quot;100&quot;><td>1</td><td>53 MM</td><td><input type=&quot;number&quot; class=&quot;tbl-input weight-input&quot; oninput=&quot;calculate(this.closest(&#39;.report-container&#39;))&quot;></td><td class=&quot;res-pct&quot;></td><td class=&quot;res-cum&quot;></td><td class=&quot;res-pass&quot;></td><td>100</td><td><input type=&quot;text&quot; class=&quot;tbl-input&quot;></td></tr>
                <tr data-min=&quot;50&quot; data-max=&quot;80&quot;><td>2</td><td>26.5 MM</td><td><input type=&quot;number&quot; class=&quot;tbl-input weight-input&quot; oninput=&quot;calculate(this.closest(&#39;.report-container&#39;))&quot;></td><td class=&quot;res-pct&quot;></td><td class=&quot;res-cum&quot;></td><td class=&quot;res-pass&quot;></td><td>50-80</td><td><input type=&quot;text&quot; class=&quot;tbl-input&quot;></td></tr>
                <tr data-min=&quot;15&quot; data-max=&quot;35&quot;><td>3</td><td>4.75 MM</td><td><input type=&quot;number&quot; class=&quot;tbl-input weight-input&quot; oninput=&quot;calculate(this.closest(&#39;.report-container&#39;))&quot;></td><td class=&quot;res-pct&quot;></td><td class=&quot;res-cum&quot;></td><td class=&quot;res-pass&quot;></td><td>15-35</td><td><input type=&quot;text&quot; class=&quot;tbl-input&quot;></td></tr>
                <tr data-min=&quot;0&quot; data-max=&quot;10&quot;><td>4</td><td>0.075 MM</td><td><input type=&quot;number&quot; class=&quot;tbl-input weight-input&quot; oninput=&quot;calculate(this.closest(&#39;.report-container&#39;))&quot;></td><td class=&quot;res-pct&quot;></td><td class=&quot;res-cum&quot;></td><td class=&quot;res-pass&quot;></td><td>&lt;10</td><td><input type=&quot;text&quot; class=&quot;tbl-input&quot;></td></tr>
                <tr><td>5</td><td>PAN</td><td><input type=&quot;number&quot; class=&quot;tbl-input weight-input&quot; oninput=&quot;calculate(this.closest(&#39;.report-container&#39;))&quot;></td><td class=&quot;res-pct&quot;></td><td class=&quot;res-cum&quot;></td><td class=&quot;res-pass&quot;></td><td></td><td><input type=&quot;text&quot; class=&quot;tbl-input&quot;></td></tr>
                <tr style=&quot;font-weight: bold;&quot;>
                    <td></td><td>Total Wt.</td><td class=&quot;totalWtDisplay&quot;></td><td colspan=&quot;5&quot;></td>
                </tr>
            </tbody>
        </table>
        
        <div class=&quot;footer-section&quot;>
            <div style=&quot;display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px;&quot;>
                <div><strong>Memo No:</strong> <span class=&quot;editable&quot; contenteditable=&quot;true&quot; style=&quot;min-width: 100px;&quot;></span></div>
                <div style=&quot;margin-right: 150px;&quot;><strong>Date:</strong> <span class=&quot;editable&quot; contenteditable=&quot;true&quot; style=&quot;min-width: 150px;&quot;></span></div>
            </div>
            <p><strong>Copy Forwarded to:-</strong> Executive Engineer, R.W.D, Works Division, <span class=&quot;editable location-placeholder&quot; contenteditable=&quot;true&quot;>Nawada</span></p>
            <div class=&quot;signature-row&quot;>
                <div class=&quot;signature-box&quot;><br><br><strong>T.S.</strong></div>
                <div class=&quot;signature-box&quot;>
                    <br><br><strong>A.E.</strong><br>
                    R.W.D, Testing and Quality Control Laboratory,<br>
                    <span class=&quot;editable location-placeholder&quot; contenteditable=&quot;true&quot;>Nawada</span>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // Toggle Logic
    function toggleMode() {
        const mode = document.querySelector(&#39;input[name=&quot;genMode&quot;]:checked&#39;).value;
        const qtyBox = document.getElementById(&#39;quantityBox&#39;);
        const listBox = document.getElementById(&#39;listBox&#39;);
        
        if (mode === &#39;quantity&#39;) {
            qtyBox.classList.remove(&#39;hidden&#39;);
            listBox.classList.add(&#39;hidden&#39;);
        } else {
            qtyBox.classList.add(&#39;hidden&#39;);
            listBox.classList.remove(&#39;hidden&#39;);
        }
    }

    // Line Numbers & Sync Scroll
    function updateLineNumbers() {
        const textarea = document.getElementById(&#39;roadListInput&#39;);
        const lines = textarea.value.split(&#39;\n&#39;).length;
        const lineNumbersElem = document.getElementById(&#39;lineNumbers&#39;);
        
        let numbersHTML = &#39;&#39;;
        for (let i = 1; i <= lines; i++) {
            numbersHTML += i + &#39;<br>&#39;;
        }
        lineNumbersElem.innerHTML = numbersHTML;
        
        const nonEmptyLines = textarea.value.split(&#39;\n&#39;).filter(line => line.trim() !== &quot;&quot;).length;
        document.getElementById(&#39;roadCountDisplay&#39;).innerText = nonEmptyLines;
    }

    function syncScroll() {
        const textarea = document.getElementById(&#39;roadListInput&#39;);
        const lineNumbersElem = document.getElementById(&#39;lineNumbers&#39;);
        lineNumbersElem.scrollTop = textarea.scrollTop;
    }

    function generateBulkReports() {
        const minWt = parseFloat(document.getElementById(&#39;minRange&#39;).value);
        const maxWt = parseFloat(document.getElementById(&#39;maxRange&#39;).value);
        const locName = document.getElementById(&#39;locationInput&#39;).value || &quot;Nawada&quot;;
        
        if (!minWt || !maxWt) {
            alert(&quot;Please enter Min and Max Weight.&quot;);
            return;
        }

        // Determine Mode
        const mode = document.querySelector(&#39;input[name=&quot;genMode&quot;]:checked&#39;).value;
        let reportsToGenerate = []; 

        if (mode === &#39;quantity&#39;) {
            const count = parseInt(document.getElementById(&#39;reportCount&#39;).value);
            if (!count) { alert(&quot;Please enter Quantity.&quot;); return; }
            for(let i=0; i<count; i++) {
                reportsToGenerate.push({ roadName: &quot;&quot; }); 
            }
        } else {
            // List Mode
            const listText = document.getElementById(&#39;roadListInput&#39;).value;
            const lines = listText.split(&#39;\n&#39;);
            
            lines.forEach(line => {
                if(line.trim() !== &quot;&quot;) {
                    reportsToGenerate.push({ roadName: line.trim() });
                }
            });
            
            if (reportsToGenerate.length === 0) {
                alert(&quot;Please paste at least one road name in the list.&quot;);
                return;
            }
        }

        const container = document.getElementById(&#39;main-output-area&#39;);
        const template = container.querySelector(&#39;.template-report&#39;).cloneNode(true);
        container.innerHTML = &#39;&#39;;

        reportsToGenerate.forEach(item => {
            let newReport = template.cloneNode(true);
            
            // Random Weight
            let randomSampleWt = Math.floor(Math.random() * (maxWt - minWt + 1)) + minWt;
            newReport.querySelector(&#39;.manualSampleWt&#39;).value = randomSampleWt;

            // Update Location
            newReport.querySelectorAll(&#39;.location-placeholder&#39;).forEach(span => {
                span.innerText = locName;
            });
            
            // Update Road Name
            if (item.roadName) {
                newReport.querySelector(&#39;.road-name-field&#39;).innerText = item.roadName;
            }

            container.appendChild(newReport);
            autoFillWeights(newReport, randomSampleWt);
        });
    }

    function autoFillWeights(reportElement, sampleWt) {
        if (!sampleWt) sampleWt = parseFloat(reportElement.querySelector(&#39;.manualSampleWt&#39;).value);
        
        const rows = reportElement.querySelectorAll(&#39;.calcTable tr[data-min]&#39;);
        let accumulatedWeight = 0;
        let currentPassing = 100;
        
        rows.forEach((row) => {
            const minLim = parseFloat(row.getAttribute(&#39;data-min&#39;));
            const maxLim = parseFloat(row.getAttribute(&#39;data-max&#39;));
            let effectiveMax = Math.min(maxLim, currentPassing);
            let effectiveMin = minLim;
            if (effectiveMin > effectiveMax) effectiveMin = effectiveMax; 
            
            let randomPassing = (Math.random() * (effectiveMax - effectiveMin)) + effectiveMin;
            randomPassing = Math.round(randomPassing * 100) / 100;
            
            let targetCumWeight = ((100 - randomPassing) / 100) * sampleWt;
            let individualWeight = Math.round(targetCumWeight - accumulatedWeight);
            if (individualWeight < 0) individualWeight = 0;
            
            row.querySelector(&#39;.weight-input&#39;).value = individualWeight;
            accumulatedWeight += individualWeight;
            currentPassing = 100 - ((accumulatedWeight / sampleWt) * 100);
        });
        
        const panRow = reportElement.querySelector(&#39;.calcTable tr:nth-last-child(2)&#39;);
        let panWeight = Math.max(0, sampleWt - accumulatedWeight);
        panRow.querySelector(&#39;.weight-input&#39;).value = panWeight;
        
        calculate(reportElement);
    }

    function calculate(reportElement) {
        if (!reportElement) return;
        const rows = reportElement.querySelectorAll(&#39;.calcTable tr&#39;);
        let totalSumWeight = 0;
        let manualSampleWt = parseFloat(reportElement.querySelector(&#39;.manualSampleWt&#39;).value);
        
        rows.forEach((row, index) => {
            if (index < rows.length - 1) { 
                const input = row.querySelector(&#39;.weight-input&#39;);
                if (input) {
                    const val = parseFloat(input.value);
                    if (!isNaN(val)) totalSumWeight += val;
                }
            }
        });
        
        const totalDisp = reportElement.querySelector(&#39;.totalWtDisplay&#39;);
        if (manualSampleWt > 0) {
             if(totalDisp) totalDisp.innerText = manualSampleWt.toFixed(0);
        } else {
             if(totalDisp) totalDisp.innerText = totalSumWeight > 0 ? totalSumWeight.toFixed(0) : &quot;&quot;;
        }
        
        let divisor = manualSampleWt > 0 ? manualSampleWt : totalSumWeight;
        let accumulatedWeight = 0;
        
        rows.forEach((row, index) => {
            if (index < rows.length - 1) {
                const input = row.querySelector(&#39;.weight-input&#39;);
                if (input) {
                    const weight = parseFloat(input.value) || 0;
                    accumulatedWeight += weight;
                    if (divisor > 0) {
                        let pctRetained = (weight / divisor) * 100;
                        let cumRetained = (accumulatedWeight / divisor) * 100;
                        let passing = Math.max(0, 100 - cumRetained);
                        if (passing < 0.01) passing = 0.00; 
                        
                        row.querySelector(&#39;.res-pct&#39;).innerText = pctRetained.toFixed(2);
                        row.querySelector(&#39;.res-cum&#39;).innerText = cumRetained.toFixed(2);
                        row.querySelector(&#39;.res-pass&#39;).innerText = passing.toFixed(2);
                    }
                }
            }
        });
    }

    // ========== DRAGGABLE CONTROLS (MOBILE FIXED) ==========
    (function() {
        let isDragging = false;
        let currentPanel = null;
        let offsetX = 0;
        let offsetY = 0;
        let startX = 0;
        let startY = 0;
        let hasMoved = false;

        document.querySelectorAll('.drag-handle').forEach(handle => {
            handle.addEventListener('touchstart', handleTouchStart, { passive: false });
            handle.addEventListener('mousedown', handleMouseStart);
        });

        function handleTouchStart(e) {
            const panel = e.target.closest('.action-btn-container') || e.target.closest('.controls');
            if (!panel) return;
            
            if (panel.classList.contains('minimized')) {
                toggleMinimize(e.target);
                return;
            }
            
            const touch = e.touches[0];
            startX = touch.clientX;
            startY = touch.clientY;
            
            const rect = panel.getBoundingClientRect();
            offsetX = touch.clientX - rect.left;
            offsetY = touch.clientY - rect.top;
            
            isDragging = true;
            currentPanel = panel;
            hasMoved = false;
            
            panel.style.transition = 'none';
            
            document.addEventListener('touchmove', handleTouchMove, { passive: false });
            document.addEventListener('touchend', handleTouchEnd);
        }

        function handleMouseStart(e) {
            const panel = e.target.closest('.action-btn-container') || e.target.closest('.controls');
            if (!panel) return;
            
            if (panel.classList.contains('minimized')) {
                toggleMinimize(e.target);
                return;
            }
            
            startX = e.clientX;
            startY = e.clientY;
            
            const rect = panel.getBoundingClientRect();
            offsetX = e.clientX - rect.left;
            offsetY = e.clientY - rect.top;
            
            isDragging = true;
            currentPanel = panel;
            hasMoved = false;
            
            panel.style.transition = 'none';
            
            document.addEventListener('mousemove', handleMouseMove);
            document.addEventListener('mouseup', handleMouseEnd);
        }

        function handleTouchMove(e) {
            if (!isDragging || !currentPanel) return;
            
            const touch = e.touches[0];
            const deltaX = Math.abs(touch.clientX - startX);
            const deltaY = Math.abs(touch.clientY - startY);
            
            // Only drag if moved more than 5px
            if (deltaX > 5 || deltaY > 5) {
                hasMoved = true;
                
                let newX = touch.clientX - offsetX;
                let newY = touch.clientY - offsetY;
                
                const maxX = window.innerWidth - currentPanel.offsetWidth;
                const maxY = window.innerHeight - currentPanel.offsetHeight;
                
                newX = Math.max(0, Math.min(newX, maxX));
                newY = Math.max(0, Math.min(newY, maxY));
                
                currentPanel.style.left = newX + 'px';
                currentPanel.style.top = newY + 'px';
                currentPanel.style.right = 'auto';
                
                e.preventDefault();
            }
        }

        function handleMouseMove(e) {
            if (!isDragging || !currentPanel) return;
            
            const deltaX = Math.abs(e.clientX - startX);
            const deltaY = Math.abs(e.clientY - startY);
            
            if (deltaX > 5 || deltaY > 5) {
                hasMoved = true;
                
                let newX = e.clientX - offsetX;
                let newY = e.clientY - offsetY;
                
                const maxX = window.innerWidth - currentPanel.offsetWidth;
                const maxY = window.innerHeight - currentPanel.offsetHeight;
                
                newX = Math.max(0, Math.min(newX, maxX));
                newY = Math.max(0, Math.min(newY, maxY));
                
                currentPanel.style.left = newX + 'px';
                currentPanel.style.top = newY + 'px';
                currentPanel.style.right = 'auto';
            }
        }

        function handleTouchEnd() {
            if (isDragging && currentPanel) {
                currentPanel.style.transition = 'all 0.3s ease';
            }
            isDragging = false;
            currentPanel = null;
            
            document.removeEventListener('touchmove', handleTouchMove);
            document.removeEventListener('touchend', handleTouchEnd);
        }

        function handleMouseEnd() {
            if (isDragging && currentPanel) {
                currentPanel.style.transition = 'all 0.3s ease';
            }
            isDragging = false;
            currentPanel = null;
            
            document.removeEventListener('mousemove', handleMouseMove);
            document.removeEventListener('mouseup', handleMouseEnd);
        }

        window.toggleMinimize = function(btn) {
            const panel = btn.closest('.action-btn-container') || btn.closest('.controls');
            if (!panel) return;
            panel.classList.toggle('minimized');
        };
    })();

</script>
</body>
</html>"
            style="width: 100%; height: calc(100vh - 160px); border: none; display: block;"
            sandbox="allow-scripts allow-same-origin allow-forms allow-modals"
        ></iframe>
    </div>

    <!-- BM Binder TEST -->
    <div id="bm_binder" class="test-wrapper">
        <iframe 
            srcdoc="<!DOCTYPE html>
<html lang=&quot;en&quot;>
<head>
    <meta charset=&quot;UTF-8&quot;>
    <meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;>
    <title>Bulk Bitumen (BM) Generator Ultimate</title>
    <style>
        body { font-family: &quot;Times New Roman&quot;, Times, serif; margin: 0; padding: 20px; background-color: #f0f0f0; }
        
        /* Report Container Style */
        .report-container { 
            width: 210mm; 
            min-height: 297mm; 
            background-color: white; 
            margin: auto; 
            padding: 20px 40px; 
            box-shadow: 0 0 10px rgba(0,0,0,0.1); 
            box-sizing: border-box; 
            position: relative; 
            margin-bottom: 20px; 
        }
        
        .header { text-align: center; margin-bottom: 20px; }
        .header h2, .header h3 { margin: 5px 0; text-transform: uppercase; }
        .header h3 { font-size: 16px; font-weight: bold; }
        .title { text-align: center; font-weight: bold; text-decoration: underline; margin: 20px 0; font-size: 18px; }
        
        .info-table { width: 100%; margin-bottom: 20px; font-size: 14px; border-collapse: collapse; }
        .info-table td { padding: 5px 2px; vertical-align: top; border: none; line-height: 1.6; }

        .data-table { width: 100%; border-collapse: collapse; font-size: 13px; margin-bottom: 30px; text-align: center; }
        .data-table th, .data-table td { border: 1px solid black; padding: 6px 4px; height: 28px; vertical-align: middle; }
        .data-table th { background-color: #f2f2f2; font-weight: bold; }
        
        .footer-section { margin-top: 50px; font-size: 14px; line-height: 1.6; }
        .signature-row { display: flex; justify-content: space-between; margin-top: 80px; align-items: flex-start; }
        .signature-box { text-align: center; width: 250px; }

        .editable {
            border-bottom: 1px dotted #999;
            outline: none;
            font-weight: bold;
            color: #000;
            display: inline; 
            min-width: 50px;
        }
        .editable:empty::before { content: &quot;\00a0\00a0\00a0\00a0\00a0\00a0\00a0&quot;; color: #ccc; }
        
        .tbl-input { width: 100%; border: none; text-align: center; font-family: inherit; font-size: inherit; background: transparent; outline: none; }
        .weight-input { background-color: #eef; font-weight: bold; color: #000; } 
        
        /* Control Panel Styles - DRAGGABLE */
        .controls {
            position: fixed; top: 20px; right: 20px; width: 280px;
            background: rgba(255, 255, 255, 0.98);
            padding: 0; box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            border-radius: 8px; z-index: 9999;
            font-family: sans-serif; border: 1px solid #ccc;
            transition: all 0.3s ease;
        }
        .controls.minimized { width: 50px; height: 50px; border-radius: 50%; }
        .drag-handle {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white; padding: 10px; cursor: move;
            display: flex; justify-content: space-between; align-items: center;
            border-radius: 8px 8px 0 0; user-select: none; touch-action: none;
            -webkit-user-select: none;
            -webkit-touch-callout: none;
        }
        .minimized .drag-handle { border-radius: 50%; width: 50px; height: 50px; justify-content: center; padding: 0; }
        .drag-handle h4 { margin: 0; font-size: 14px; font-weight: bold; flex: 1; }
        .minimized .drag-handle h4 { display: none; }
        .minimize-btn {
            background: rgba(255,255,255,0.3); border: none; color: white;
            width: 24px; height: 24px; border-radius: 4px; cursor: pointer; font-size: 16px;
        }
        .minimized .minimize-btn { display: none; }
        .control-content { padding: 15px; max-height: calc(90vh - 44px); overflow-y: auto; }
        .minimized .control-content { display: none; }
        .minimized-icon { display: none; font-size: 24px; }
        .minimized .minimized-icon { display: block; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); }
        .controls h4 { margin: 0 0 10px 0; color: #333; text-align: center; font-size: 16px; border-bottom: 1px solid #ddd; padding-bottom: 5px; }
        
        .ctrl-group { margin-bottom: 8px; }
        .ctrl-group label { display: block; font-size: 12px; font-weight: bold; margin-bottom: 3px; color: #555; }
        .ctrl-input { width: 100%; padding: 5px; box-sizing: border-box; border: 1px solid #aaa; border-radius: 4px; font-weight: bold; }
        
        /* Toggle Switch Style */
        .mode-toggle { display: flex; align-items: center; margin-bottom: 10px; background: #eee; padding: 5px; border-radius: 5px; }
        .mode-toggle label { flex: 1; font-size: 12px; font-family: sans-serif; cursor: pointer; display: flex; align-items: center; }
        .mode-toggle input { margin-right: 5px; }

        /* List Editor Style with Line Numbers */
        .list-editor-container {
            display: flex; border: 1px solid #aaa; border-radius: 4px;
            height: 100px; font-family: monospace; font-size: 12px;
            background: white; margin-bottom: 8px;
        }
        .line-numbers {
            width: 25px; background-color: #f0f0f0; color: #888;
            text-align: right; padding: 5px 2px; border-right: 1px solid #ddd;
            line-height: 1.4; overflow: hidden; user-select: none;
        }
        .road-list-area {
            flex: 1; border: none; padding: 5px; line-height: 1.4;
            resize: none; outline: none; white-space: pre; overflow-y: scroll;
        }
        .hidden { display: none; }

        .btn { width: 100%; padding: 10px; margin-top: 5px; border: none; border-radius: 5px; font-weight: bold; cursor: pointer; color: white; font-size: 14px; transition: 0.2s; }
        .magic-btn { background-color: #28a745; margin-bottom: 10px; }
        .print-btn { background-color: #dc3545; margin-bottom: 10px; }
        .clear-btn { background-color: #6c757d; }
        .btn:hover { opacity: 0.9; transform: scale(1.02); }

        @media print { 
            body { background-color: white; padding: 0; } 
            .report-container { 
                box-shadow: none; margin: 0; width: 100%; 
                page-break-after: always; 
            }
            .report-container:last-child { page-break-after: auto; }
            .controls { display: none; } 
            .weight-input { background-color: transparent; }
            .editable, .tbl-input { border: none !important; border-bottom: none !important; }
            .editable:empty::before { content: &quot;&quot;; display: none; }
        }
        @media screen { .editable:hover { background-color: rgba(0, 0, 255, 0.05); cursor: text; } }
    </style>
</head>
<body>

<div class=&quot;controls&quot;>
    <div class=&quot;drag-handle&quot;>
        <h4>‚öôÔ∏è AI CONTROLS (BM)</h4>
        <button class=&quot;minimize-btn&quot; onclick=&quot;toggleMinimize(this)&quot;>‚àí</button>
        <span class=&quot;minimized-icon&quot;>‚öôÔ∏è</span>
    </div>
    <div class=&quot;control-content&quot;>
    
    <div class=&quot;ctrl-group&quot;>
        <label>Division/Location:</label>
        <input type=&quot;text&quot; id=&quot;locationInput&quot; class=&quot;ctrl-input&quot; value=&quot;Nawada&quot; placeholder=&quot;e.g. RAJAULI&quot;>
    </div>

    <div class=&quot;mode-toggle&quot;>
        <label>
            <input type=&quot;radio&quot; name=&quot;genMode&quot; value=&quot;quantity&quot; onchange=&quot;toggleMode()&quot; checked> 
            <strong>Quantity Only</strong>
        </label>
        <label>
            <input type=&quot;radio&quot; name=&quot;genMode&quot; value=&quot;list&quot; onchange=&quot;toggleMode()&quot;> 
            <strong>Road Name List</strong>
        </label>
    </div>

    <div id=&quot;quantityBox&quot; class=&quot;ctrl-group&quot;>
        <label>Quantity (No. of Reports):</label>
        <input type=&quot;number&quot; id=&quot;reportCount&quot; class=&quot;ctrl-input&quot; value=&quot;10&quot;>
    </div>

    <div id=&quot;listBox&quot; class=&quot;ctrl-group hidden&quot;>
        <label>Paste Road Names Below:</label>
        <div class=&quot;list-editor-container&quot;>
            <div class=&quot;line-numbers&quot; id=&quot;lineNumbers&quot;>1</div>
            <textarea id=&quot;roadListInput&quot; class=&quot;road-list-area&quot; placeholder=&quot;Paste list here...&quot; oninput=&quot;updateLineNumbers()&quot; onscroll=&quot;syncScroll()&quot;></textarea>
        </div>
        <div style=&quot;font-size: 11px; color: #666; text-align: right;&quot;>Total Roads: <span id=&quot;roadCountDisplay&quot;>0</span></div>
    </div>

    <div class=&quot;ctrl-group&quot;>
        <label>Min Sample Wt (gm):</label>
        <input type=&quot;number&quot; id=&quot;ctrlMinWt&quot; class=&quot;ctrl-input&quot; value=&quot;1000&quot;>
    </div>
    
    <div class=&quot;ctrl-group&quot;>
        <label>Max Sample Wt (gm):</label>
        <input type=&quot;number&quot; id=&quot;ctrlMaxWt&quot; class=&quot;ctrl-input&quot; value=&quot;1000&quot;>
    </div>

    <div class=&quot;ctrl-group&quot;>
        <label>Wt. of Filter Paper Before (B):</label>
        <input type=&quot;number&quot; id=&quot;ctrlFilterWt&quot; class=&quot;ctrl-input&quot; value=&quot;5.00&quot; step=&quot;0.01&quot;>
    </div>
    
    <div class=&quot;ctrl-group&quot; style=&quot;background-color: #e8f0fe; padding: 5px; border-radius: 4px;&quot;>
        <label style=&quot;color: #0056b3;&quot;>Target Wt. Filter Paper After (D):</label>
        <input type=&quot;number&quot; id=&quot;ctrlFilterAfter&quot; class=&quot;ctrl-input&quot; placeholder=&quot;Auto (Leave empty for random)&quot; step=&quot;0.01&quot;>
    </div>

    <div class=&quot;ctrl-group&quot;>
        <label>Number of Tests per Report (1-3):</label>
        <input type=&quot;number&quot; id=&quot;ctrlNumTests&quot; class=&quot;ctrl-input&quot; value=&quot;3&quot; min=&quot;1&quot; max=&quot;3&quot;>
    </div>
    
    <div class=&quot;ctrl-group&quot;>
        <label>Min Target Bitumen %:</label>
        <input type=&quot;number&quot; id=&quot;ctrlMinBitumen&quot; class=&quot;ctrl-input&quot; value=&quot;3.40&quot; step=&quot;0.01&quot;>
    </div>
    
    <div class=&quot;ctrl-group&quot;>
        <label>Max Target Bitumen %:</label>
        <input type=&quot;number&quot; id=&quot;ctrlMaxBitumen&quot; class=&quot;ctrl-input&quot; value=&quot;3.60&quot; step=&quot;0.01&quot;>
    </div>

    <button class=&quot;btn magic-btn&quot; onclick=&quot;generateBulkReports()&quot;>‚ö° GENERATE BULK</button>
    <button class=&quot;btn print-btn&quot; onclick=&quot;window.print()&quot;>PRINT REPORT üñ®Ô∏è</button>
    <button class=&quot;btn clear-btn&quot; onclick=&quot;location.reload()&quot;>RESET</button>
    </div></div>

<div id=&quot;main-output-area&quot;>
    <div class=&quot;report-container template-report&quot;>
        <div class=&quot;header&quot;>
            <h2>RURAL WORKS DEPARTMENT</h2>
            <h3>Testing and Quality Control Laboratory, <span class=&quot;editable location-placeholder&quot; contenteditable=&quot;true&quot;>Nawada</span></h3>
        </div>
        <div class=&quot;title&quot;>TEST RESULT FOR BINDER CONTENT (BITUMEN) OF BM</div>
        
        <table class=&quot;info-table&quot;>
            <tr>
                <td width=&quot;60%&quot;><strong>NAME OF ROAD :-</strong> <span class=&quot;editable road-name-field&quot; contenteditable=&quot;true&quot;></span></td>
                <td width=&quot;40%&quot;><strong>DATE OF COLLECTION/RECEIPT:-</strong> <span class=&quot;editable&quot; contenteditable=&quot;true&quot;></span></td>
            </tr>
            <tr>
                <td><strong>NAME OF WORKS DIVISION:-</strong> <span class=&quot;editable&quot; contenteditable=&quot;true&quot;>R.W.D WORKS DIVISION</span></td>
                <td><strong>DATE OF TEST:-</strong> <span class=&quot;editable&quot; contenteditable=&quot;true&quot;></span></td>
            </tr>
            <tr>
                <td><strong>NAME OF AGENCY :-</strong> <span class=&quot;editable&quot; contenteditable=&quot;true&quot;></span></td>
                <td><strong>PACKAGE NO:-</strong> <span class=&quot;editable&quot; contenteditable=&quot;true&quot;></span></td>
            </tr>
            <tr><td colspan=&quot;2&quot;><strong>AGREEMENT NO:-</strong> <span class=&quot;editable&quot; contenteditable=&quot;true&quot;></span></td></tr>
            <tr>
                <td colspan=&quot;2&quot;>
                    <strong>Ref:-</strong> <span class=&quot;editable&quot; contenteditable=&quot;true&quot;>A.E, R.W.D WORKS SUB DIV</span>
                    <span style=&quot;margin-left: 80px;&quot;><strong>Chainage:-</strong> <span class=&quot;editable&quot; contenteditable=&quot;true&quot;></span></span>
                </td>
            </tr>
            <tr>
                <td colspan=&quot;2&quot; style=&quot;padding-top: 15px;&quot;>
                    <strong>LT NO:-</strong> <span class=&quot;editable&quot; contenteditable=&quot;true&quot; style=&quot;min-width: 80px;&quot;></span> 
                    <span style=&quot;margin-left: 80px;&quot;><strong>DT:-</strong> <span class=&quot;editable&quot; contenteditable=&quot;true&quot; style=&quot;min-width: 80px;&quot;></span></span>
                    <span style=&quot;margin-left: 80px;&quot;><strong>Sample Wt:-</strong> <input type=&quot;text&quot; class=&quot;tbl-input dispSampleWt&quot; style=&quot;width: 50px; text-align: right; font-weight: bold;&quot; readonly> gm</span>
                </td>
            </tr>
        </table>
        
        <table class=&quot;data-table&quot;>
            <thead>
                <tr>
                    <th rowspan=&quot;2&quot; width=&quot;8%&quot;>SL.NO</th>
                    <th rowspan=&quot;2&quot; style=&quot;width: 40%;&quot;>OBSERVATIONS (All wt. in gm)</th>
                    <th colspan=&quot;3&quot;>NO. OF TEST</th>
                    <th rowspan=&quot;2&quot; width=&quot;10%&quot;>Mean Value</th>
                    <th rowspan=&quot;2&quot; width=&quot;10%&quot;>Remarks</th>
                </tr>
                <tr><th>1</th><th>2</th><th>3</th></tr>
            </thead>
            <tbody class=&quot;bitumenTable&quot;>
                <tr><td>1.</td><td style=&quot;text-align: left; padding-left: 10px;&quot;>Wt. of mix taken before extraction (A)</td><td><input class=&quot;tbl-input weight-input row-a&quot; readonly></td><td><input class=&quot;tbl-input weight-input row-a&quot; readonly></td><td><input class=&quot;tbl-input weight-input row-a&quot; readonly></td><td></td><td></td></tr>
                <tr><td>2.</td><td style=&quot;text-align: left; padding-left: 10px;&quot;>Wt. of Filter paper before extraction (B)</td><td><input class=&quot;tbl-input weight-input row-b&quot; readonly></td><td><input class=&quot;tbl-input weight-input row-b&quot; readonly></td><td><input class=&quot;tbl-input weight-input row-b&quot; readonly></td><td></td><td></td></tr>
                <tr><td>3.</td><td style=&quot;text-align: left; padding-left: 10px;&quot;>Wt. of mix after extraction (C)</td><td><input class=&quot;tbl-input weight-input row-c&quot; readonly></td><td><input class=&quot;tbl-input weight-input row-c&quot; readonly></td><td><input class=&quot;tbl-input weight-input row-c&quot; readonly></td><td></td><td></td></tr>
                <tr><td>4.</td><td style=&quot;text-align: left; padding-left: 10px;&quot;>Wt. of Filter paper after extraction (D)</td><td><input class=&quot;tbl-input weight-input row-d&quot; readonly></td><td><input class=&quot;tbl-input weight-input row-d&quot; readonly></td><td><input class=&quot;tbl-input weight-input row-d&quot; readonly></td><td></td><td></td></tr>
                <tr><td>5.</td><td style=&quot;text-align: left; padding-left: 10px;&quot;>Wt. of filler collected from extract (E)</td><td><input class=&quot;tbl-input weight-input row-e&quot; readonly></td><td><input class=&quot;tbl-input weight-input row-e&quot; readonly></td><td><input class=&quot;tbl-input weight-input row-e&quot; readonly></td><td><input class=&quot;tbl-input&quot; value=&quot;3.5%&quot;></td><td></td></tr>
                <tr><td>6.</td><td style=&quot;text-align: left; padding-left: 10px;&quot;>Wt. of filler collected in filter paper (D-B)=F</td><td><input class=&quot;tbl-input weight-input row-f&quot; readonly></td><td><input class=&quot;tbl-input weight-input row-f&quot; readonly></td><td><input class=&quot;tbl-input weight-input row-f&quot; readonly></td><td></td><td></td></tr>
                <tr><td>7.</td><td style=&quot;text-align: left; padding-left: 10px;&quot;>Wt. of agg. + filler after extraction (C+E+F)=G</td><td><input class=&quot;tbl-input weight-input row-g&quot; readonly></td><td><input class=&quot;tbl-input weight-input row-g&quot; readonly></td><td><input class=&quot;tbl-input weight-input row-g&quot; readonly></td><td></td><td></td></tr>
                <tr style=&quot;font-weight: bold;&quot;><td>8.</td><td style=&quot;text-align: left; padding-left: 10px;&quot;>Percentage of Bitumen (A-G)/A x 100</td><td><input class=&quot;tbl-input row-res&quot; readonly></td><td><input class=&quot;tbl-input row-res&quot; readonly></td><td><input class=&quot;tbl-input row-res&quot; readonly></td><td><input class=&quot;tbl-input meanBitumen&quot; readonly></td><td></td></tr>
            </tbody>
        </table>
        
        <div class=&quot;footer-section&quot;>
            <div style=&quot;display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px;&quot;>
                <div><strong>Memo No:</strong> <span class=&quot;editable&quot; contenteditable=&quot;true&quot; style=&quot;min-width: 100px;&quot;></span></div>
                <div style=&quot;margin-right: 150px;&quot;> <strong>Date:</strong> <span class=&quot;editable&quot; contenteditable=&quot;true&quot; style=&quot;min-width: 150px;&quot;></span></div>
            </div>
            <p><strong>Copy Forwarded to:-</strong> Executive Engineer, R.W.D, Works Division, <span class=&quot;editable location-placeholder&quot; contenteditable=&quot;true&quot;>Nawada</span></p>
            <div class=&quot;signature-row&quot;>
                <div class=&quot;signature-box&quot;><br><br><strong>T.S.</strong></div>
                <div class=&quot;signature-box&quot;>
                    <br><br><strong>A.E.</strong><br>
                    R.W.D, Testing and Quality Control Laboratory,<br>
                    <span class=&quot;editable location-placeholder&quot; contenteditable=&quot;true&quot;>Nawada</span>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // Toggle Logic
    function toggleMode() {
        const mode = document.querySelector(&#39;input[name=&quot;genMode&quot;]:checked&#39;).value;
        const qtyBox = document.getElementById(&#39;quantityBox&#39;);
        const listBox = document.getElementById(&#39;listBox&#39;);
        
        if (mode === &#39;quantity&#39;) {
            qtyBox.classList.remove(&#39;hidden&#39;);
            listBox.classList.add(&#39;hidden&#39;);
        } else {
            qtyBox.classList.add(&#39;hidden&#39;);
            listBox.classList.remove(&#39;hidden&#39;);
        }
    }

    // Line Numbers & Sync Scroll
    function updateLineNumbers() {
        const textarea = document.getElementById(&#39;roadListInput&#39;);
        const lines = textarea.value.split(&#39;\n&#39;).length;
        const lineNumbersElem = document.getElementById(&#39;lineNumbers&#39;);
        
        let numbersHTML = &#39;&#39;;
        for (let i = 1; i <= lines; i++) {
            numbersHTML += i + &#39;<br>&#39;;
        }
        lineNumbersElem.innerHTML = numbersHTML;
        
        const nonEmptyLines = textarea.value.split(&#39;\n&#39;).filter(line => line.trim() !== &quot;&quot;).length;
        document.getElementById(&#39;roadCountDisplay&#39;).innerText = nonEmptyLines;
    }

    function syncScroll() {
        const textarea = document.getElementById(&#39;roadListInput&#39;);
        const lineNumbersElem = document.getElementById(&#39;lineNumbers&#39;);
        lineNumbersElem.scrollTop = textarea.scrollTop;
    }

    function generateBulkReports() {
        const minWt = parseFloat(document.getElementById(&#39;ctrlMinWt&#39;).value) || 1000;
        const maxWt = parseFloat(document.getElementById(&#39;ctrlMaxWt&#39;).value) || 1000;
        
        const minBit = parseFloat(document.getElementById(&#39;ctrlMinBitumen&#39;).value) || 3.5;
        const maxBit = parseFloat(document.getElementById(&#39;ctrlMaxBitumen&#39;).value) || 3.5;
        const locName = document.getElementById(&#39;locationInput&#39;).value || &quot;Nawada&quot;;
        
        // Pass the B and D values if set
        const filterWtB = parseFloat(document.getElementById(&#39;ctrlFilterWt&#39;).value) || 5.00;
        const filterWtD_input = document.getElementById(&#39;ctrlFilterAfter&#39;).value;
        const filterWtD = filterWtD_input ? parseFloat(filterWtD_input) : null;
        
        // Determine Mode
        const mode = document.querySelector(&#39;input[name=&quot;genMode&quot;]:checked&#39;).value;
        let reportsToGenerate = []; 

        if (mode === &#39;quantity&#39;) {
            const count = parseInt(document.getElementById(&#39;reportCount&#39;).value);
            if (!count) { alert(&quot;Please enter Quantity.&quot;); return; }
            for(let i=0; i<count; i++) {
                reportsToGenerate.push({ roadName: &quot;&quot; }); 
            }
        } else {
            // List Mode
            const listText = document.getElementById(&#39;roadListInput&#39;).value;
            const lines = listText.split(&#39;\n&#39;);
            
            lines.forEach(line => {
                if(line.trim() !== &quot;&quot;) {
                    reportsToGenerate.push({ roadName: line.trim() });
                }
            });
            
            if (reportsToGenerate.length === 0) {
                alert(&quot;Please paste at least one road name in the list.&quot;);
                return;
            }
        }

        const container = document.getElementById(&#39;main-output-area&#39;);
        const template = container.querySelector(&#39;.template-report&#39;).cloneNode(true);
        container.innerHTML = &#39;&#39;; // Clear existing

        reportsToGenerate.forEach(item => {
            let newReport = template.cloneNode(true);
            
            // Random Weight for this specific report
            let randomSampleWt = Math.floor(Math.random() * (maxWt - minWt + 1)) + minWt;
            
            // Random Target Bitumen % for this specific report
            let randomTargetBit = (Math.random() * (maxBit - minBit)) + minBit;
            
            // Update Location Name
            newReport.querySelectorAll(&#39;.location-placeholder&#39;).forEach(span => {
                span.innerText = locName;
            });
            
            // Update Road Name
            if (item.roadName) {
                newReport.querySelector(&#39;.road-name-field&#39;).innerText = item.roadName;
            }

            container.appendChild(newReport);
            
            // Run calculation
            autoFillBitumen(newReport, randomSampleWt, randomTargetBit, filterWtB, filterWtD);
        });
    }

    function autoFillBitumen(reportElement, baseSampleWt, targetBitumen, filterB, filterTargetD) {
        const numTests = parseInt(document.getElementById(&#39;ctrlNumTests&#39;).value) || 3;
        
        // Display sample weight in the report
        reportElement.querySelector(&#39;.dispSampleWt&#39;).value = baseSampleWt;

        const rowsA = reportElement.querySelectorAll(&#39;.row-a&#39;);
        const rowsB = reportElement.querySelectorAll(&#39;.row-b&#39;);
        const rowsC = reportElement.querySelectorAll(&#39;.row-c&#39;);
        const rowsD = reportElement.querySelectorAll(&#39;.row-d&#39;);
        const rowsE = reportElement.querySelectorAll(&#39;.row-e&#39;);
        const rowsF = reportElement.querySelectorAll(&#39;.row-f&#39;);
        const rowsG = reportElement.querySelectorAll(&#39;.row-g&#39;);
        const rowsRes = reportElement.querySelectorAll(&#39;.row-res&#39;);

        let totalBitumen = 0;

        for (let i = 0; i < 3; i++) {
            if (i < numTests) {
                let currentSampleWt = baseSampleWt; 
                
                rowsA[i].value = currentSampleWt;
                rowsB[i].value = filterB.toFixed(2);
                
                // --- Logic for Filter Paper D ---
                let valD;
                if (filterTargetD !== null) {
                    valD = filterTargetD + (Math.random() * 0.04 - 0.02);
                } else {
                    let valF_approx = (Math.random() * 0.20) + 0.10; 
                    valD = filterB + valF_approx;
                }
                
                // Calculate actual F
                let valF = valD - filterB;

                // --- Logic for Bitumen Target ---
                let currentTargetBitumen = targetBitumen + ((Math.random() * 0.10) - 0.05);
                
                // Calculations
                let requiredG = currentSampleWt - ((currentTargetBitumen * currentSampleWt) / 100);
                
                // E (Filler from extract) - Estimate
                let valE_approx = (Math.random() * 1.0) + 0.8; 
                
                // C (Agg after extraction) = G - F - E
                let valC = Math.round(requiredG - valF - valE_approx); 
                
                // Recalculate E precisely
                let valE = requiredG - valF - valC;
                
                // Final Check
                let finalG = valC + valE + valF;
                let finalBitumenPct = ((currentSampleWt - finalG) / currentSampleWt) * 100;

                rowsC[i].value = valC;
                rowsD[i].value = valD.toFixed(2);
                rowsE[i].value = valE.toFixed(2);
                rowsF[i].value = valF.toFixed(2);
                rowsG[i].value = finalG.toFixed(2);
                rowsRes[i].value = finalBitumenPct.toFixed(2) + &quot;%&quot;;
                
                totalBitumen += finalBitumenPct;
            } else {
                [rowsA[i], rowsB[i], rowsC[i], rowsD[i], rowsE[i], rowsF[i], rowsG[i], rowsRes[i]].forEach(el => el.value = &quot;&quot;);
            }
        }
        
        if (numTests > 0) {
            reportElement.querySelector(&#39;.meanBitumen&#39;).value = (totalBitumen / numTests).toFixed(2) + &quot;%&quot;;
        }
    }

    // ========== DRAGGABLE CONTROLS (MOBILE FIXED) ==========
    (function() {
        let isDragging = false;
        let currentPanel = null;
        let offsetX = 0;
        let offsetY = 0;
        let startX = 0;
        let startY = 0;
        let hasMoved = false;

        document.querySelectorAll('.drag-handle').forEach(handle => {
            handle.addEventListener('touchstart', handleTouchStart, { passive: false });
            handle.addEventListener('mousedown', handleMouseStart);
        });

        function handleTouchStart(e) {
            const panel = e.target.closest('.action-btn-container') || e.target.closest('.controls');
            if (!panel) return;
            
            if (panel.classList.contains('minimized')) {
                toggleMinimize(e.target);
                return;
            }
            
            const touch = e.touches[0];
            startX = touch.clientX;
            startY = touch.clientY;
            
            const rect = panel.getBoundingClientRect();
            offsetX = touch.clientX - rect.left;
            offsetY = touch.clientY - rect.top;
            
            isDragging = true;
            currentPanel = panel;
            hasMoved = false;
            
            panel.style.transition = 'none';
            
            document.addEventListener('touchmove', handleTouchMove, { passive: false });
            document.addEventListener('touchend', handleTouchEnd);
        }

        function handleMouseStart(e) {
            const panel = e.target.closest('.action-btn-container') || e.target.closest('.controls');
            if (!panel) return;
            
            if (panel.classList.contains('minimized')) {
                toggleMinimize(e.target);
                return;
            }
            
            startX = e.clientX;
            startY = e.clientY;
            
            const rect = panel.getBoundingClientRect();
            offsetX = e.clientX - rect.left;
            offsetY = e.clientY - rect.top;
            
            isDragging = true;
            currentPanel = panel;
            hasMoved = false;
            
            panel.style.transition = 'none';
            
            document.addEventListener('mousemove', handleMouseMove);
            document.addEventListener('mouseup', handleMouseEnd);
        }

        function handleTouchMove(e) {
            if (!isDragging || !currentPanel) return;
            
            const touch = e.touches[0];
            const deltaX = Math.abs(touch.clientX - startX);
            const deltaY = Math.abs(touch.clientY - startY);
            
            // Only drag if moved more than 5px
            if (deltaX > 5 || deltaY > 5) {
                hasMoved = true;
                
                let newX = touch.clientX - offsetX;
                let newY = touch.clientY - offsetY;
                
                const maxX = window.innerWidth - currentPanel.offsetWidth;
                const maxY = window.innerHeight - currentPanel.offsetHeight;
                
                newX = Math.max(0, Math.min(newX, maxX));
                newY = Math.max(0, Math.min(newY, maxY));
                
                currentPanel.style.left = newX + 'px';
                currentPanel.style.top = newY + 'px';
                currentPanel.style.right = 'auto';
                
                e.preventDefault();
            }
        }

        function handleMouseMove(e) {
            if (!isDragging || !currentPanel) return;
            
            const deltaX = Math.abs(e.clientX - startX);
            const deltaY = Math.abs(e.clientY - startY);
            
            if (deltaX > 5 || deltaY > 5) {
                hasMoved = true;
                
                let newX = e.clientX - offsetX;
                let newY = e.clientY - offsetY;
                
                const maxX = window.innerWidth - currentPanel.offsetWidth;
                const maxY = window.innerHeight - currentPanel.offsetHeight;
                
                newX = Math.max(0, Math.min(newX, maxX));
                newY = Math.max(0, Math.min(newY, maxY));
                
                currentPanel.style.left = newX + 'px';
                currentPanel.style.top = newY + 'px';
                currentPanel.style.right = 'auto';
            }
        }

        function handleTouchEnd() {
            if (isDragging && currentPanel) {
                currentPanel.style.transition = 'all 0.3s ease';
            }
            isDragging = false;
            currentPanel = null;
            
            document.removeEventListener('touchmove', handleTouchMove);
            document.removeEventListener('touchend', handleTouchEnd);
        }

        function handleMouseEnd() {
            if (isDragging && currentPanel) {
                currentPanel.style.transition = 'all 0.3s ease';
            }
            isDragging = false;
            currentPanel = null;
            
            document.removeEventListener('mousemove', handleMouseMove);
            document.removeEventListener('mouseup', handleMouseEnd);
        }

        window.toggleMinimize = function(btn) {
            const panel = btn.closest('.action-btn-container') || btn.closest('.controls');
            if (!panel) return;
            panel.classList.toggle('minimized');
        };
    })();

</script>
</body>
</html>"
            style="width: 100%; height: calc(100vh - 160px); border: none; display: block;"
            sandbox="allow-scripts allow-same-origin allow-forms allow-modals"
        ></iframe>
    </div>

    <!-- MSS Binder TEST -->
    <div id="mss_binder" class="test-wrapper">
        <iframe 
            srcdoc="<!DOCTYPE html>
<html lang=&quot;en&quot;>
<head>
    <meta charset=&quot;UTF-8&quot;>
    <meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;>
    <title>Bulk Bitumen (MSS) Generator Ultimate</title>
    <style>
        body { font-family: &quot;Times New Roman&quot;, Times, serif; margin: 0; padding: 20px; background-color: #f0f0f0; }
        
        /* Report Container Style */
        .report-container { 
            width: 210mm; 
            min-height: 297mm; 
            background-color: white; 
            margin: auto; 
            padding: 20px 40px; 
            box-shadow: 0 0 10px rgba(0,0,0,0.1); 
            box-sizing: border-box; 
            position: relative; 
            margin-bottom: 20px; 
        }
        
        .header { text-align: center; margin-bottom: 20px; }
        .header h2, .header h3 { margin: 5px 0; text-transform: uppercase; }
        .header h3 { font-size: 16px; font-weight: bold; }
        .title { text-align: center; font-weight: bold; text-decoration: underline; margin: 20px 0; font-size: 18px; }
        
        .info-table { width: 100%; margin-bottom: 20px; font-size: 14px; border-collapse: collapse; }
        .info-table td { padding: 5px 2px; vertical-align: top; border: none; line-height: 1.6; }

        .data-table { width: 100%; border-collapse: collapse; font-size: 13px; margin-bottom: 30px; text-align: center; }
        .data-table th, .data-table td { border: 1px solid black; padding: 6px 4px; height: 28px; vertical-align: middle; }
        .data-table th { background-color: #f2f2f2; font-weight: bold; }
        
        .footer-section { margin-top: 50px; font-size: 14px; line-height: 1.6; }
        .signature-row { display: flex; justify-content: space-between; margin-top: 80px; align-items: flex-start; }
        .signature-box { text-align: center; width: 250px; }

        .editable {
            border-bottom: 1px dotted #999;
            outline: none;
            font-weight: bold;
            color: #000;
            display: inline; 
            min-width: 50px;
        }
        .editable:empty::before { content: &quot;\00a0\00a0\00a0\00a0\00a0\00a0\00a0&quot;; color: #ccc; }
        
        .tbl-input { width: 100%; border: none; text-align: center; font-family: inherit; font-size: inherit; background: transparent; outline: none; }
        .weight-input { background-color: #eef; font-weight: bold; color: #000; } 
        
        /* Control Panel Styles - DRAGGABLE */
        .controls {
            position: fixed; top: 20px; right: 20px; width: 280px;
            background: rgba(255, 255, 255, 0.98);
            padding: 0; box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            border-radius: 8px; z-index: 9999;
            font-family: sans-serif; border: 1px solid #ccc;
            transition: all 0.3s ease;
        }
        .controls.minimized { width: 50px; height: 50px; border-radius: 50%; }
        .drag-handle {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white; padding: 10px; cursor: move;
            display: flex; justify-content: space-between; align-items: center;
            border-radius: 8px 8px 0 0; user-select: none; touch-action: none;
            -webkit-user-select: none;
            -webkit-touch-callout: none;
        }
        .minimized .drag-handle { border-radius: 50%; width: 50px; height: 50px; justify-content: center; padding: 0; }
        .drag-handle h4 { margin: 0; font-size: 14px; font-weight: bold; flex: 1; }
        .minimized .drag-handle h4 { display: none; }
        .minimize-btn {
            background: rgba(255,255,255,0.3); border: none; color: white;
            width: 24px; height: 24px; border-radius: 4px; cursor: pointer; font-size: 16px;
        }
        .minimized .minimize-btn { display: none; }
        .control-content { padding: 15px; max-height: calc(90vh - 44px); overflow-y: auto; }
        .minimized .control-content { display: none; }
        .minimized-icon { display: none; font-size: 24px; }
        .minimized .minimized-icon { display: block; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); }
        .controls h4 { margin: 0 0 10px 0; color: #333; text-align: center; font-size: 16px; border-bottom: 1px solid #ddd; padding-bottom: 5px; }
        
        .ctrl-group { margin-bottom: 8px; }
        .ctrl-group label { display: block; font-size: 12px; font-weight: bold; margin-bottom: 3px; color: #555; }
        .ctrl-input { width: 100%; padding: 5px; box-sizing: border-box; border: 1px solid #aaa; border-radius: 4px; font-weight: bold; }
        
        /* Toggle Switch Style */
        .mode-toggle { display: flex; align-items: center; margin-bottom: 10px; background: #eee; padding: 5px; border-radius: 5px; }
        .mode-toggle label { flex: 1; font-size: 12px; font-family: sans-serif; cursor: pointer; display: flex; align-items: center; }
        .mode-toggle input { margin-right: 5px; }

        /* List Editor Style with Line Numbers */
        .list-editor-container {
            display: flex; border: 1px solid #aaa; border-radius: 4px;
            height: 100px; font-family: monospace; font-size: 12px;
            background: white; margin-bottom: 8px;
        }
        .line-numbers {
            width: 25px; background-color: #f0f0f0; color: #888;
            text-align: right; padding: 5px 2px; border-right: 1px solid #ddd;
            line-height: 1.4; overflow: hidden; user-select: none;
        }
        .road-list-area {
            flex: 1; border: none; padding: 5px; line-height: 1.4;
            resize: none; outline: none; white-space: pre; overflow-y: scroll;
        }
        .hidden { display: none; }

        .btn { width: 100%; padding: 10px; margin-top: 5px; border: none; border-radius: 5px; font-weight: bold; cursor: pointer; color: white; font-size: 14px; transition: 0.2s; }
        .magic-btn { background-color: #28a745; margin-bottom: 10px; }
        .print-btn { background-color: #dc3545; margin-bottom: 10px; }
        .clear-btn { background-color: #6c757d; }
        .btn:hover { opacity: 0.9; transform: scale(1.02); }

        @media print { 
            body { background-color: white; padding: 0; } 
            .report-container { 
                box-shadow: none; margin: 0; width: 100%; 
                page-break-after: always; 
            }
            .report-container:last-child { page-break-after: auto; }
            .controls { display: none; } 
            .weight-input { background-color: transparent; }
            .editable, .tbl-input { border: none !important; border-bottom: none !important; }
            .editable:empty::before { content: &quot;&quot;; display: none; }
        }
        @media screen { .editable:hover { background-color: rgba(0, 0, 255, 0.05); cursor: text; } }
    </style>
</head>
<body>

<div class=&quot;controls&quot;>
    <div class=&quot;drag-handle&quot;>
        <h4>‚öôÔ∏è AI CONTROLS (MSS)</h4>
        <button class=&quot;minimize-btn&quot; onclick=&quot;toggleMinimize(this)&quot;>‚àí</button>
        <span class=&quot;minimized-icon&quot;>‚öôÔ∏è</span>
    </div>
    <div class=&quot;control-content&quot;>
    
    <div class=&quot;ctrl-group&quot;>
        <label>Division/Location:</label>
        <input type=&quot;text&quot; id=&quot;locationInput&quot; class=&quot;ctrl-input&quot; value=&quot;Nawada&quot; placeholder=&quot;e.g. RAJAULI&quot;>
    </div>

    <div class=&quot;mode-toggle&quot;>
        <label>
            <input type=&quot;radio&quot; name=&quot;genMode&quot; value=&quot;quantity&quot; onchange=&quot;toggleMode()&quot; checked> 
            <strong>Quantity Only</strong>
        </label>
        <label>
            <input type=&quot;radio&quot; name=&quot;genMode&quot; value=&quot;list&quot; onchange=&quot;toggleMode()&quot;> 
            <strong>Road Name List</strong>
        </label>
    </div>

    <div id=&quot;quantityBox&quot; class=&quot;ctrl-group&quot;>
        <label>Quantity (No. of Reports):</label>
        <input type=&quot;number&quot; id=&quot;reportCount&quot; class=&quot;ctrl-input&quot; value=&quot;10&quot;>
    </div>

    <div id=&quot;listBox&quot; class=&quot;ctrl-group hidden&quot;>
        <label>Paste Road Names Below:</label>
        <div class=&quot;list-editor-container&quot;>
            <div class=&quot;line-numbers&quot; id=&quot;lineNumbers&quot;>1</div>
            <textarea id=&quot;roadListInput&quot; class=&quot;road-list-area&quot; placeholder=&quot;Paste list here...&quot; oninput=&quot;updateLineNumbers()&quot; onscroll=&quot;syncScroll()&quot;></textarea>
        </div>
        <div style=&quot;font-size: 11px; color: #666; text-align: right;&quot;>Total Roads: <span id=&quot;roadCountDisplay&quot;>0</span></div>
    </div>

    <div class=&quot;ctrl-group&quot;>
        <label>Min Sample Wt (gm):</label>
        <input type=&quot;number&quot; id=&quot;ctrlMinWt&quot; class=&quot;ctrl-input&quot; value=&quot;1000&quot;>
    </div>
    
    <div class=&quot;ctrl-group&quot;>
        <label>Max Sample Wt (gm):</label>
        <input type=&quot;number&quot; id=&quot;ctrlMaxWt&quot; class=&quot;ctrl-input&quot; value=&quot;1000&quot;>
    </div>

    <div class=&quot;ctrl-group&quot;>
        <label>Wt. of Filter Paper Before (B):</label>
        <input type=&quot;number&quot; id=&quot;ctrlFilterWt&quot; class=&quot;ctrl-input&quot; value=&quot;5.00&quot; step=&quot;0.01&quot;>
    </div>
    
    <div class=&quot;ctrl-group&quot; style=&quot;background-color: #e8f0fe; padding: 5px; border-radius: 4px;&quot;>
        <label style=&quot;color: #0056b3;&quot;>Target Wt. Filter Paper After (D):</label>
        <input type=&quot;number&quot; id=&quot;ctrlFilterAfter&quot; class=&quot;ctrl-input&quot; placeholder=&quot;Auto (Leave empty for random)&quot; step=&quot;0.01&quot;>
    </div>

    <div class=&quot;ctrl-group&quot;>
        <label>Number of Tests per Report (1-3):</label>
        <input type=&quot;number&quot; id=&quot;ctrlNumTests&quot; class=&quot;ctrl-input&quot; value=&quot;3&quot; min=&quot;1&quot; max=&quot;3&quot;>
    </div>
    
    <div class=&quot;ctrl-group&quot;>
        <label>Min Target Bitumen %:</label>
        <input type=&quot;number&quot; id=&quot;ctrlMinBitumen&quot; class=&quot;ctrl-input&quot; value=&quot;5.00&quot; step=&quot;0.01&quot;>
    </div>
    
    <div class=&quot;ctrl-group&quot;>
        <label>Max Target Bitumen %:</label>
        <input type=&quot;number&quot; id=&quot;ctrlMaxBitumen&quot; class=&quot;ctrl-input&quot; value=&quot;5.10&quot; step=&quot;0.01&quot;>
    </div>

    <button class=&quot;btn magic-btn&quot; onclick=&quot;generateBulkReports()&quot;>‚ö° GENERATE BULK</button>
    <button class=&quot;btn print-btn&quot; onclick=&quot;window.print()&quot;>PRINT REPORT üñ®Ô∏è</button>
    <button class=&quot;btn clear-btn&quot; onclick=&quot;location.reload()&quot;>RESET</button>
    </div></div>

<div id=&quot;main-output-area&quot;>
    <div class=&quot;report-container template-report&quot;>
        <div class=&quot;header&quot;>
            <h2>RURAL WORKS DEPARTMENT</h2>
            <h3>Testing and Quality Control Laboratory, <span class=&quot;editable location-placeholder&quot; contenteditable=&quot;true&quot;>Nawada</span></h3>
        </div>
        <div class=&quot;title&quot;>TEST RESULT FOR BINDER CONTENT (BITUMEN) OF MSS</div>
        
        <table class=&quot;info-table&quot;>
            <tr>
                <td width=&quot;60%&quot;><strong>NAME OF ROAD :-</strong> <span class=&quot;editable road-name-field&quot; contenteditable=&quot;true&quot;></span></td>
                <td width=&quot;40%&quot;><strong>DATE OF COLLECTION/RECEIPT:-</strong> <span class=&quot;editable&quot; contenteditable=&quot;true&quot;></span></td>
            </tr>
            <tr>
                <td><strong>NAME OF WORKS DIVISION:-</strong> <span class=&quot;editable&quot; contenteditable=&quot;true&quot;>R.W.D WORKS DIVISION</span></td>
                <td><strong>DATE OF TEST:-</strong> <span class=&quot;editable&quot; contenteditable=&quot;true&quot;></span></td>
            </tr>
            <tr>
                <td><strong>NAME OF AGENCY :-</strong> <span class=&quot;editable&quot; contenteditable=&quot;true&quot;></span></td>
                <td><strong>PACKAGE NO:-</strong> <span class=&quot;editable&quot; contenteditable=&quot;true&quot;></span></td>
            </tr>
            <tr><td colspan=&quot;2&quot;><strong>AGREEMENT NO:-</strong> <span class=&quot;editable&quot; contenteditable=&quot;true&quot;></span></td></tr>
            <tr>
                <td colspan=&quot;2&quot;>
                    <strong>Ref:-</strong> <span class=&quot;editable&quot; contenteditable=&quot;true&quot;>A.E, R.W.D WORKS SUB DIV</span>
                    <span style=&quot;margin-left: 80px;&quot;><strong>Chainage:-</strong> <span class=&quot;editable&quot; contenteditable=&quot;true&quot;></span></span>
                </td>
            </tr>
            <tr>
                <td colspan=&quot;2&quot; style=&quot;padding-top: 15px;&quot;>
                    <strong>LT NO:-</strong> <span class=&quot;editable&quot; contenteditable=&quot;true&quot; style=&quot;min-width: 80px;&quot;></span> 
                    <span style=&quot;margin-left: 80px;&quot;><strong>DT:-</strong> <span class=&quot;editable&quot; contenteditable=&quot;true&quot; style=&quot;min-width: 80px;&quot;></span></span>
                    <span style=&quot;margin-left: 80px;&quot;><strong>Sample Wt:-</strong> <input type=&quot;text&quot; class=&quot;tbl-input dispSampleWt&quot; style=&quot;width: 50px; text-align: right; font-weight: bold;&quot; readonly> gm</span>
                </td>
            </tr>
        </table>
        
        <table class=&quot;data-table&quot;>
            <thead>
                <tr>
                    <th rowspan=&quot;2&quot; width=&quot;8%&quot;>SL.NO</th>
                    <th rowspan=&quot;2&quot; style=&quot;width: 40%;&quot;>OBSERVATIONS (All wt. in gm)</th>
                    <th colspan=&quot;3&quot;>NO. OF TEST</th>
                    <th rowspan=&quot;2&quot; width=&quot;10%&quot;>Mean Value</th>
                    <th rowspan=&quot;2&quot; width=&quot;10%&quot;>Remarks</th>
                </tr>
                <tr><th>1</th><th>2</th><th>3</th></tr>
            </thead>
            <tbody class=&quot;bitumenTable&quot;>
                <tr><td>1.</td><td style=&quot;text-align: left; padding-left: 10px;&quot;>Wt. of mix taken before extraction (A)</td><td><input class=&quot;tbl-input weight-input row-a&quot; readonly></td><td><input class=&quot;tbl-input weight-input row-a&quot; readonly></td><td><input class=&quot;tbl-input weight-input row-a&quot; readonly></td><td></td><td></td></tr>
                <tr><td>2.</td><td style=&quot;text-align: left; padding-left: 10px;&quot;>Wt. of Filter paper before extraction (B)</td><td><input class=&quot;tbl-input weight-input row-b&quot; readonly></td><td><input class=&quot;tbl-input weight-input row-b&quot; readonly></td><td><input class=&quot;tbl-input weight-input row-b&quot; readonly></td><td></td><td></td></tr>
                <tr><td>3.</td><td style=&quot;text-align: left; padding-left: 10px;&quot;>Wt. of mix after extraction (C)</td><td><input class=&quot;tbl-input weight-input row-c&quot; readonly></td><td><input class=&quot;tbl-input weight-input row-c&quot; readonly></td><td><input class=&quot;tbl-input weight-input row-c&quot; readonly></td><td></td><td></td></tr>
                <tr><td>4.</td><td style=&quot;text-align: left; padding-left: 10px;&quot;>Wt. of Filter paper after extraction (D)</td><td><input class=&quot;tbl-input weight-input row-d&quot; readonly></td><td><input class=&quot;tbl-input weight-input row-d&quot; readonly></td><td><input class=&quot;tbl-input weight-input row-d&quot; readonly></td><td></td><td></td></tr>
                <tr><td>5.</td><td style=&quot;text-align: left; padding-left: 10px;&quot;>Wt. of filler collected from extract (E)</td><td><input class=&quot;tbl-input weight-input row-e&quot; readonly></td><td><input class=&quot;tbl-input weight-input row-e&quot; readonly></td><td><input class=&quot;tbl-input weight-input row-e&quot; readonly></td><td><input class=&quot;tbl-input&quot; value=&quot;5.0%&quot;></td><td></td></tr>
                <tr><td>6.</td><td style=&quot;text-align: left; padding-left: 10px;&quot;>Wt. of filler collected in filter paper (D-B)=F</td><td><input class=&quot;tbl-input weight-input row-f&quot; readonly></td><td><input class=&quot;tbl-input weight-input row-f&quot; readonly></td><td><input class=&quot;tbl-input weight-input row-f&quot; readonly></td><td></td><td></td></tr>
                <tr><td>7.</td><td style=&quot;text-align: left; padding-left: 10px;&quot;>Wt. of agg. + filler after extraction (C+E+F)=G</td><td><input class=&quot;tbl-input weight-input row-g&quot; readonly></td><td><input class=&quot;tbl-input weight-input row-g&quot; readonly></td><td><input class=&quot;tbl-input weight-input row-g&quot; readonly></td><td></td><td></td></tr>
                <tr style=&quot;font-weight: bold;&quot;><td>8.</td><td style=&quot;text-align: left; padding-left: 10px;&quot;>Percentage of Bitumen (A-G)/A x 100</td><td><input class=&quot;tbl-input row-res&quot; readonly></td><td><input class=&quot;tbl-input row-res&quot; readonly></td><td><input class=&quot;tbl-input row-res&quot; readonly></td><td><input class=&quot;tbl-input meanBitumen&quot; readonly></td><td></td></tr>
            </tbody>
        </table>
        
        <div class=&quot;footer-section&quot;>
            <div style=&quot;display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px;&quot;>
                <div><strong>Memo No:</strong> <span class=&quot;editable&quot; contenteditable=&quot;true&quot; style=&quot;min-width: 100px;&quot;></span></div>
                <div style=&quot;margin-right: 150px;&quot;> <strong>Date:</strong> <span class=&quot;editable&quot; contenteditable=&quot;true&quot; style=&quot;min-width: 150px;&quot;></span></div>
            </div>
            <p><strong>Copy Forwarded to:-</strong> Executive Engineer, R.W.D, Works Division, <span class=&quot;editable location-placeholder&quot; contenteditable=&quot;true&quot;>Nawada</span></p>
            <div class=&quot;signature-row&quot;>
                <div class=&quot;signature-box&quot;><br><br><strong>T.S.</strong></div>
                <div class=&quot;signature-box&quot;>
                    <br><br><strong>A.E.</strong><br>
                    R.W.D, Testing and Quality Control Laboratory,<br>
                    <span class=&quot;editable location-placeholder&quot; contenteditable=&quot;true&quot;>Nawada</span>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // Toggle Logic
    function toggleMode() {
        const mode = document.querySelector(&#39;input[name=&quot;genMode&quot;]:checked&#39;).value;
        const qtyBox = document.getElementById(&#39;quantityBox&#39;);
        const listBox = document.getElementById(&#39;listBox&#39;);
        
        if (mode === &#39;quantity&#39;) {
            qtyBox.classList.remove(&#39;hidden&#39;);
            listBox.classList.add(&#39;hidden&#39;);
        } else {
            qtyBox.classList.add(&#39;hidden&#39;);
            listBox.classList.remove(&#39;hidden&#39;);
        }
    }

    // Line Numbers & Sync Scroll
    function updateLineNumbers() {
        const textarea = document.getElementById(&#39;roadListInput&#39;);
        const lines = textarea.value.split(&#39;\n&#39;).length;
        const lineNumbersElem = document.getElementById(&#39;lineNumbers&#39;);
        
        let numbersHTML = &#39;&#39;;
        for (let i = 1; i <= lines; i++) {
            numbersHTML += i + &#39;<br>&#39;;
        }
        lineNumbersElem.innerHTML = numbersHTML;
        
        const nonEmptyLines = textarea.value.split(&#39;\n&#39;).filter(line => line.trim() !== &quot;&quot;).length;
        document.getElementById(&#39;roadCountDisplay&#39;).innerText = nonEmptyLines;
    }

    function syncScroll() {
        const textarea = document.getElementById(&#39;roadListInput&#39;);
        const lineNumbersElem = document.getElementById(&#39;lineNumbers&#39;);
        lineNumbersElem.scrollTop = textarea.scrollTop;
    }

    function generateBulkReports() {
        const minWt = parseFloat(document.getElementById(&#39;ctrlMinWt&#39;).value) || 1000;
        const maxWt = parseFloat(document.getElementById(&#39;ctrlMaxWt&#39;).value) || 1000;
        
        const minBit = parseFloat(document.getElementById(&#39;ctrlMinBitumen&#39;).value) || 5.0;
        const maxBit = parseFloat(document.getElementById(&#39;ctrlMaxBitumen&#39;).value) || 5.1;
        const locName = document.getElementById(&#39;locationInput&#39;).value || &quot;Nawada&quot;;
        
        // Pass the B and D values if set
        const filterWtB = parseFloat(document.getElementById(&#39;ctrlFilterWt&#39;).value) || 5.00;
        const filterWtD_input = document.getElementById(&#39;ctrlFilterAfter&#39;).value;
        const filterWtD = filterWtD_input ? parseFloat(filterWtD_input) : null;
        
        // Determine Mode
        const mode = document.querySelector(&#39;input[name=&quot;genMode&quot;]:checked&#39;).value;
        let reportsToGenerate = []; 

        if (mode === &#39;quantity&#39;) {
            const count = parseInt(document.getElementById(&#39;reportCount&#39;).value);
            if (!count) { alert(&quot;Please enter Quantity.&quot;); return; }
            for(let i=0; i<count; i++) {
                reportsToGenerate.push({ roadName: &quot;&quot; }); 
            }
        } else {
            // List Mode
            const listText = document.getElementById(&#39;roadListInput&#39;).value;
            const lines = listText.split(&#39;\n&#39;);
            
            lines.forEach(line => {
                if(line.trim() !== &quot;&quot;) {
                    reportsToGenerate.push({ roadName: line.trim() });
                }
            });
            
            if (reportsToGenerate.length === 0) {
                alert(&quot;Please paste at least one road name in the list.&quot;);
                return;
            }
        }

        const container = document.getElementById(&#39;main-output-area&#39;);
        const template = container.querySelector(&#39;.template-report&#39;).cloneNode(true);
        container.innerHTML = &#39;&#39;; // Clear existing

        reportsToGenerate.forEach(item => {
            let newReport = template.cloneNode(true);
            
            // Random Weight for this specific report
            let randomSampleWt = Math.floor(Math.random() * (maxWt - minWt + 1)) + minWt;
            
            // Random Target Bitumen % for this specific report
            let randomTargetBit = (Math.random() * (maxBit - minBit)) + minBit;
            
            // Update Location Name
            newReport.querySelectorAll(&#39;.location-placeholder&#39;).forEach(span => {
                span.innerText = locName;
            });
            
            // Update Road Name
            if (item.roadName) {
                newReport.querySelector(&#39;.road-name-field&#39;).innerText = item.roadName;
            }

            container.appendChild(newReport);
            
            // Run calculation
            autoFillBitumen(newReport, randomSampleWt, randomTargetBit, filterWtB, filterWtD);
        });
    }

    function autoFillBitumen(reportElement, baseSampleWt, targetBitumen, filterB, filterTargetD) {
        const numTests = parseInt(document.getElementById(&#39;ctrlNumTests&#39;).value) || 3;
        
        // Display sample weight in the report
        reportElement.querySelector(&#39;.dispSampleWt&#39;).value = baseSampleWt;

        const rowsA = reportElement.querySelectorAll(&#39;.row-a&#39;);
        const rowsB = reportElement.querySelectorAll(&#39;.row-b&#39;);
        const rowsC = reportElement.querySelectorAll(&#39;.row-c&#39;);
        const rowsD = reportElement.querySelectorAll(&#39;.row-d&#39;);
        const rowsE = reportElement.querySelectorAll(&#39;.row-e&#39;);
        const rowsF = reportElement.querySelectorAll(&#39;.row-f&#39;);
        const rowsG = reportElement.querySelectorAll(&#39;.row-g&#39;);
        const rowsRes = reportElement.querySelectorAll(&#39;.row-res&#39;);

        let totalBitumen = 0;

        for (let i = 0; i < 3; i++) {
            if (i < numTests) {
                let currentSampleWt = baseSampleWt; 
                
                rowsA[i].value = currentSampleWt;
                rowsB[i].value = filterB.toFixed(2);
                
                // --- Logic for Filter Paper D ---
                let valD;
                if (filterTargetD !== null) {
                    valD = filterTargetD + (Math.random() * 0.04 - 0.02);
                } else {
                    let valF_approx = (Math.random() * 0.20) + 0.10; 
                    valD = filterB + valF_approx;
                }
                
                let valF = valD - filterB;

                // --- Logic for Bitumen Target ---
                // Keep individual test variance tight (+/- 0.05) around the report&#39;s random target
                let currentTargetBitumen = targetBitumen + ((Math.random() * 0.10) - 0.05);
                
                // Calculations
                let requiredG = currentSampleWt - ((currentTargetBitumen * currentSampleWt) / 100);
                
                let valE_approx = (Math.random() * 1.0) + 0.8; 
                let valC = Math.round(requiredG - valF - valE_approx); 
                let valE = requiredG - valF - valC;
                
                let finalG = valC + valE + valF;
                let finalBitumenPct = ((currentSampleWt - finalG) / currentSampleWt) * 100;

                rowsC[i].value = valC;
                rowsD[i].value = valD.toFixed(2);
                rowsE[i].value = valE.toFixed(2);
                rowsF[i].value = valF.toFixed(2);
                rowsG[i].value = finalG.toFixed(2);
                rowsRes[i].value = finalBitumenPct.toFixed(2) + &quot;%&quot;;
                
                totalBitumen += finalBitumenPct;
            } else {
                [rowsA[i], rowsB[i], rowsC[i], rowsD[i], rowsE[i], rowsF[i], rowsG[i], rowsRes[i]].forEach(el => el.value = &quot;&quot;);
            }
        }
        
        if (numTests > 0) {
            reportElement.querySelector(&#39;.meanBitumen&#39;).value = (totalBitumen / numTests).toFixed(2) + &quot;%&quot;;
        }
    }

    // ========== DRAGGABLE CONTROLS (MOBILE FIXED) ==========
    (function() {
        let isDragging = false;
        let currentPanel = null;
        let offsetX = 0;
        let offsetY = 0;
        let startX = 0;
        let startY = 0;
        let hasMoved = false;

        document.querySelectorAll('.drag-handle').forEach(handle => {
            handle.addEventListener('touchstart', handleTouchStart, { passive: false });
            handle.addEventListener('mousedown', handleMouseStart);
        });

        function handleTouchStart(e) {
            const panel = e.target.closest('.action-btn-container') || e.target.closest('.controls');
            if (!panel) return;
            
            if (panel.classList.contains('minimized')) {
                toggleMinimize(e.target);
                return;
            }
            
            const touch = e.touches[0];
            startX = touch.clientX;
            startY = touch.clientY;
            
            const rect = panel.getBoundingClientRect();
            offsetX = touch.clientX - rect.left;
            offsetY = touch.clientY - rect.top;
            
            isDragging = true;
            currentPanel = panel;
            hasMoved = false;
            
            panel.style.transition = 'none';
            
            document.addEventListener('touchmove', handleTouchMove, { passive: false });
            document.addEventListener('touchend', handleTouchEnd);
        }

        function handleMouseStart(e) {
            const panel = e.target.closest('.action-btn-container') || e.target.closest('.controls');
            if (!panel) return;
            
            if (panel.classList.contains('minimized')) {
                toggleMinimize(e.target);
                return;
            }
            
            startX = e.clientX;
            startY = e.clientY;
            
            const rect = panel.getBoundingClientRect();
            offsetX = e.clientX - rect.left;
            offsetY = e.clientY - rect.top;
            
            isDragging = true;
            currentPanel = panel;
            hasMoved = false;
            
            panel.style.transition = 'none';
            
            document.addEventListener('mousemove', handleMouseMove);
            document.addEventListener('mouseup', handleMouseEnd);
        }

        function handleTouchMove(e) {
            if (!isDragging || !currentPanel) return;
            
            const touch = e.touches[0];
            const deltaX = Math.abs(touch.clientX - startX);
            const deltaY = Math.abs(touch.clientY - startY);
            
            // Only drag if moved more than 5px
            if (deltaX > 5 || deltaY > 5) {
                hasMoved = true;
                
                let newX = touch.clientX - offsetX;
                let newY = touch.clientY - offsetY;
                
                const maxX = window.innerWidth - currentPanel.offsetWidth;
                const maxY = window.innerHeight - currentPanel.offsetHeight;
                
                newX = Math.max(0, Math.min(newX, maxX));
                newY = Math.max(0, Math.min(newY, maxY));
                
                currentPanel.style.left = newX + 'px';
                currentPanel.style.top = newY + 'px';
                currentPanel.style.right = 'auto';
                
                e.preventDefault();
            }
        }

        function handleMouseMove(e) {
            if (!isDragging || !currentPanel) return;
            
            const deltaX = Math.abs(e.clientX - startX);
            const deltaY = Math.abs(e.clientY - startY);
            
            if (deltaX > 5 || deltaY > 5) {
                hasMoved = true;
                
                let newX = e.clientX - offsetX;
                let newY = e.clientY - offsetY;
                
                const maxX = window.innerWidth - currentPanel.offsetWidth;
                const maxY = window.innerHeight - currentPanel.offsetHeight;
                
                newX = Math.max(0, Math.min(newX, maxX));
                newY = Math.max(0, Math.min(newY, maxY));
                
                currentPanel.style.left = newX + 'px';
                currentPanel.style.top = newY + 'px';
                currentPanel.style.right = 'auto';
            }
        }

        function handleTouchEnd() {
            if (isDragging && currentPanel) {
                currentPanel.style.transition = 'all 0.3s ease';
            }
            isDragging = false;
            currentPanel = null;
            
            document.removeEventListener('touchmove', handleTouchMove);
            document.removeEventListener('touchend', handleTouchEnd);
        }

        function handleMouseEnd() {
            if (isDragging && currentPanel) {
                currentPanel.style.transition = 'all 0.3s ease';
            }
            isDragging = false;
            currentPanel = null;
            
            document.removeEventListener('mousemove', handleMouseMove);
            document.removeEventListener('mouseup', handleMouseEnd);
        }

        window.toggleMinimize = function(btn) {
            const panel = btn.closest('.action-btn-container') || btn.closest('.controls');
            if (!panel) return;
            panel.classList.toggle('minimized');
        };
    })();

</script>
</body>
</html>"
            style="width: 100%; height: calc(100vh - 160px); border: none; display: block;"
            sandbox="allow-scripts allow-same-origin allow-forms allow-modals"
        ></iframe>
    </div>

    <!-- SDBC Binder TEST -->
    <div id="sdbc_binder" class="test-wrapper">
        <iframe 
            srcdoc="<!DOCTYPE html>
<html lang=&quot;en&quot;>
<head>
    <meta charset=&quot;UTF-8&quot;>
    <meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;>
    <title>Bulk Bitumen (SDBC) Generator Ultimate</title>
    <style>
        body { font-family: &quot;Times New Roman&quot;, Times, serif; margin: 0; padding: 20px; background-color: #f0f0f0; }
        
        /* Report Container Style */
        .report-container { 
            width: 210mm; 
            min-height: 297mm; 
            background-color: white; 
            margin: auto; 
            padding: 20px 40px; 
            box-shadow: 0 0 10px rgba(0,0,0,0.1); 
            box-sizing: border-box; 
            position: relative; 
            margin-bottom: 20px; 
        }
        
        .header { text-align: center; margin-bottom: 20px; }
        .header h2, .header h3 { margin: 5px 0; text-transform: uppercase; }
        .header h3 { font-size: 16px; font-weight: bold; }
        .title { text-align: center; font-weight: bold; text-decoration: underline; margin: 20px 0; font-size: 18px; }
        
        .info-table { width: 100%; margin-bottom: 20px; font-size: 14px; border-collapse: collapse; }
        .info-table td { padding: 5px 2px; vertical-align: top; border: none; line-height: 1.6; }

        .data-table { width: 100%; border-collapse: collapse; font-size: 13px; margin-bottom: 30px; text-align: center; }
        .data-table th, .data-table td { border: 1px solid black; padding: 6px 4px; height: 28px; vertical-align: middle; }
        .data-table th { background-color: #f2f2f2; font-weight: bold; }
        
        .footer-section { margin-top: 50px; font-size: 14px; line-height: 1.6; }
        .signature-row { display: flex; justify-content: space-between; margin-top: 80px; align-items: flex-start; }
        .signature-box { text-align: center; width: 250px; }

        .editable {
            border-bottom: 1px dotted #999;
            outline: none;
            font-weight: bold;
            color: #000;
            display: inline; 
            min-width: 50px;
        }
        .editable:empty::before { content: &quot;\00a0\00a0\00a0\00a0\00a0\00a0\00a0&quot;; color: #ccc; }
        
        .tbl-input { width: 100%; border: none; text-align: center; font-family: inherit; font-size: inherit; background: transparent; outline: none; }
        .weight-input { background-color: #eef; font-weight: bold; color: #000; } 
        
        /* Control Panel Styles - DRAGGABLE */
        .controls {
            position: fixed; top: 20px; right: 20px; width: 280px;
            background: rgba(255, 255, 255, 0.98);
            padding: 0; box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            border-radius: 8px; z-index: 9999;
            font-family: sans-serif; border: 1px solid #ccc;
            transition: all 0.3s ease;
        }
        .controls.minimized { width: 50px; height: 50px; border-radius: 50%; }
        .drag-handle {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white; padding: 10px; cursor: move;
            display: flex; justify-content: space-between; align-items: center;
            border-radius: 8px 8px 0 0; user-select: none; touch-action: none;
            -webkit-user-select: none;
            -webkit-touch-callout: none;
        }
        .minimized .drag-handle { border-radius: 50%; width: 50px; height: 50px; justify-content: center; padding: 0; }
        .drag-handle h4 { margin: 0; font-size: 14px; font-weight: bold; flex: 1; }
        .minimized .drag-handle h4 { display: none; }
        .minimize-btn {
            background: rgba(255,255,255,0.3); border: none; color: white;
            width: 24px; height: 24px; border-radius: 4px; cursor: pointer; font-size: 16px;
        }
        .minimized .minimize-btn { display: none; }
        .control-content { padding: 15px; max-height: calc(90vh - 44px); overflow-y: auto; }
        .minimized .control-content { display: none; }
        .minimized-icon { display: none; font-size: 24px; }
        .minimized .minimized-icon { display: block; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); }
        .controls h4 { margin: 0 0 10px 0; color: #333; text-align: center; font-size: 16px; border-bottom: 1px solid #ddd; padding-bottom: 5px; }
        
        .ctrl-group { margin-bottom: 8px; }
        .ctrl-group label { display: block; font-size: 12px; font-weight: bold; margin-bottom: 3px; color: #555; }
        .ctrl-input { width: 100%; padding: 5px; box-sizing: border-box; border: 1px solid #aaa; border-radius: 4px; font-weight: bold; }
        
        /* Toggle Switch Style */
        .mode-toggle { display: flex; align-items: center; margin-bottom: 10px; background: #eee; padding: 5px; border-radius: 5px; }
        .mode-toggle label { flex: 1; font-size: 12px; font-family: sans-serif; cursor: pointer; display: flex; align-items: center; }
        .mode-toggle input { margin-right: 5px; }

        /* List Editor Style with Line Numbers */
        .list-editor-container {
            display: flex; border: 1px solid #aaa; border-radius: 4px;
            height: 100px; font-family: monospace; font-size: 12px;
            background: white; margin-bottom: 8px;
        }
        .line-numbers {
            width: 25px; background-color: #f0f0f0; color: #888;
            text-align: right; padding: 5px 2px; border-right: 1px solid #ddd;
            line-height: 1.4; overflow: hidden; user-select: none;
        }
        .road-list-area {
            flex: 1; border: none; padding: 5px; line-height: 1.4;
            resize: none; outline: none; white-space: pre; overflow-y: scroll;
        }
        .hidden { display: none; }

        .btn { width: 100%; padding: 10px; margin-top: 5px; border: none; border-radius: 5px; font-weight: bold; cursor: pointer; color: white; font-size: 14px; transition: 0.2s; }
        .magic-btn { background-color: #28a745; margin-bottom: 10px; }
        .print-btn { background-color: #dc3545; margin-bottom: 10px; }
        .clear-btn { background-color: #6c757d; }
        .btn:hover { opacity: 0.9; transform: scale(1.02); }

        @media print { 
            body { background-color: white; padding: 0; } 
            .report-container { 
                box-shadow: none; margin: 0; width: 100%; 
                page-break-after: always; 
            }
            .report-container:last-child { page-break-after: auto; }
            .controls { display: none; } 
            .weight-input { background-color: transparent; }
            .editable, .tbl-input { border: none !important; border-bottom: none !important; }
            .editable:empty::before { content: &quot;&quot;; display: none; }
        }
        @media screen { .editable:hover { background-color: rgba(0, 0, 255, 0.05); cursor: text; } }
    </style>
</head>
<body>

<div class=&quot;controls&quot;>
    <div class=&quot;drag-handle&quot;>
        <h4>‚öôÔ∏è AI CONTROLS (SDBC)</h4>
        <button class=&quot;minimize-btn&quot; onclick=&quot;toggleMinimize(this)&quot;>‚àí</button>
        <span class=&quot;minimized-icon&quot;>‚öôÔ∏è</span>
    </div>
    <div class=&quot;control-content&quot;>
    
    <div class=&quot;ctrl-group&quot;>
        <label>Division/Location:</label>
        <input type=&quot;text&quot; id=&quot;locationInput&quot; class=&quot;ctrl-input&quot; value=&quot;Nawada&quot; placeholder=&quot;e.g. RAJAULI&quot;>
    </div>

    <div class=&quot;mode-toggle&quot;>
        <label>
            <input type=&quot;radio&quot; name=&quot;genMode&quot; value=&quot;quantity&quot; onchange=&quot;toggleMode()&quot; checked> 
            <strong>Quantity Only</strong>
        </label>
        <label>
            <input type=&quot;radio&quot; name=&quot;genMode&quot; value=&quot;list&quot; onchange=&quot;toggleMode()&quot;> 
            <strong>Road Name List</strong>
        </label>
    </div>

    <div id=&quot;quantityBox&quot; class=&quot;ctrl-group&quot;>
        <label>Quantity (No. of Reports):</label>
        <input type=&quot;number&quot; id=&quot;reportCount&quot; class=&quot;ctrl-input&quot; value=&quot;10&quot;>
    </div>

    <div id=&quot;listBox&quot; class=&quot;ctrl-group hidden&quot;>
        <label>Paste Road Names Below:</label>
        <div class=&quot;list-editor-container&quot;>
            <div class=&quot;line-numbers&quot; id=&quot;lineNumbers&quot;>1</div>
            <textarea id=&quot;roadListInput&quot; class=&quot;road-list-area&quot; placeholder=&quot;Paste list here...&quot; oninput=&quot;updateLineNumbers()&quot; onscroll=&quot;syncScroll()&quot;></textarea>
        </div>
        <div style=&quot;font-size: 11px; color: #666; text-align: right;&quot;>Total Roads: <span id=&quot;roadCountDisplay&quot;>0</span></div>
    </div>

    <div class=&quot;ctrl-group&quot;>
        <label>Min Sample Wt (gm):</label>
        <input type=&quot;number&quot; id=&quot;ctrlMinWt&quot; class=&quot;ctrl-input&quot; value=&quot;1000&quot;>
    </div>
    
    <div class=&quot;ctrl-group&quot;>
        <label>Max Sample Wt (gm):</label>
        <input type=&quot;number&quot; id=&quot;ctrlMaxWt&quot; class=&quot;ctrl-input&quot; value=&quot;1000&quot;>
    </div>

    <div class=&quot;ctrl-group&quot;>
        <label>Wt. of Filter Paper Before (B):</label>
        <input type=&quot;number&quot; id=&quot;ctrlFilterWt&quot; class=&quot;ctrl-input&quot; value=&quot;5.00&quot; step=&quot;0.01&quot;>
    </div>
    
    <div class=&quot;ctrl-group&quot; style=&quot;background-color: #e8f0fe; padding: 5px; border-radius: 4px;&quot;>
        <label style=&quot;color: #0056b3;&quot;>Target Wt. Filter Paper After (D):</label>
        <input type=&quot;number&quot; id=&quot;ctrlFilterAfter&quot; class=&quot;ctrl-input&quot; placeholder=&quot;Auto (Leave empty for random)&quot; step=&quot;0.01&quot;>
    </div>

    <div class=&quot;ctrl-group&quot;>
        <label>Number of Tests per Report (1-3):</label>
        <input type=&quot;number&quot; id=&quot;ctrlNumTests&quot; class=&quot;ctrl-input&quot; value=&quot;3&quot; min=&quot;1&quot; max=&quot;3&quot;>
    </div>
    
    <div class=&quot;ctrl-group&quot;>
        <label>Min Target Bitumen %:</label>
        <input type=&quot;number&quot; id=&quot;ctrlMinBitumen&quot; class=&quot;ctrl-input&quot; value=&quot;4.50&quot; step=&quot;0.01&quot;>
    </div>
    
    <div class=&quot;ctrl-group&quot;>
        <label>Max Target Bitumen %:</label>
        <input type=&quot;number&quot; id=&quot;ctrlMaxBitumen&quot; class=&quot;ctrl-input&quot; value=&quot;5.00&quot; step=&quot;0.01&quot;>
    </div>

    <button class=&quot;btn magic-btn&quot; onclick=&quot;generateBulkReports()&quot;>‚ö° GENERATE BULK</button>
    <button class=&quot;btn print-btn&quot; onclick=&quot;window.print()&quot;>PRINT REPORT üñ®Ô∏è</button>
    <button class=&quot;btn clear-btn&quot; onclick=&quot;location.reload()&quot;>RESET</button>
    </div></div>

<div id=&quot;main-output-area&quot;>
    <div class=&quot;report-container template-report&quot;>
        <div class=&quot;header&quot;>
            <h2>RURAL WORKS DEPARTMENT</h2>
            <h3>Testing and Quality Control Laboratory, <span class=&quot;editable location-placeholder&quot; contenteditable=&quot;true&quot;>Nawada</span></h3>
        </div>
        <div class=&quot;title&quot;>TEST RESULT FOR BINDER CONTENT (BITUMEN) OF SDBC</div>
        
        <table class=&quot;info-table&quot;>
            <tr>
                <td width=&quot;60%&quot;><strong>NAME OF ROAD :-</strong> <span class=&quot;editable road-name-field&quot; contenteditable=&quot;true&quot;></span></td>
                <td width=&quot;40%&quot;><strong>DATE OF COLLECTION/RECEIPT:-</strong> <span class=&quot;editable&quot; contenteditable=&quot;true&quot;></span></td>
            </tr>
            <tr>
                <td><strong>NAME OF WORKS DIVISION:-</strong> <span class=&quot;editable&quot; contenteditable=&quot;true&quot;>R.W.D WORKS DIVISION</span></td>
                <td><strong>DATE OF TEST:-</strong> <span class=&quot;editable&quot; contenteditable=&quot;true&quot;></span></td>
            </tr>
            <tr>
                <td><strong>NAME OF AGENCY :-</strong> <span class=&quot;editable&quot; contenteditable=&quot;true&quot;></span></td>
                <td><strong>PACKAGE NO:-</strong> <span class=&quot;editable&quot; contenteditable=&quot;true&quot;></span></td>
            </tr>
            <tr><td colspan=&quot;2&quot;><strong>AGREEMENT NO:-</strong> <span class=&quot;editable&quot; contenteditable=&quot;true&quot;></span></td></tr>
            <tr>
                <td colspan=&quot;2&quot;>
                    <strong>Ref:-</strong> <span class=&quot;editable&quot; contenteditable=&quot;true&quot;>A.E, R.W.D WORKS SUB DIV</span>
                    <span style=&quot;margin-left: 80px;&quot;><strong>Chainage:-</strong> <span class=&quot;editable&quot; contenteditable=&quot;true&quot;></span></span>
                </td>
            </tr>
            <tr>
                <td colspan=&quot;2&quot; style=&quot;padding-top: 15px;&quot;>
                    <strong>LT NO:-</strong> <span class=&quot;editable&quot; contenteditable=&quot;true&quot; style=&quot;min-width: 80px;&quot;></span> 
                    <span style=&quot;margin-left: 80px;&quot;><strong>DT:-</strong> <span class=&quot;editable&quot; contenteditable=&quot;true&quot; style=&quot;min-width: 80px;&quot;></span></span>
                    <span style=&quot;margin-left: 80px;&quot;><strong>Sample Wt:-</strong> <input type=&quot;text&quot; class=&quot;tbl-input dispSampleWt&quot; style=&quot;width: 50px; text-align: right; font-weight: bold;&quot; readonly> gm</span>
                </td>
            </tr>
        </table>
        
        <table class=&quot;data-table&quot;>
            <thead>
                <tr>
                    <th rowspan=&quot;2&quot; width=&quot;8%&quot;>SL.NO</th>
                    <th rowspan=&quot;2&quot; style=&quot;width: 40%;&quot;>OBSERVATIONS (All wt. in gm)</th>
                    <th colspan=&quot;3&quot;>NO. OF TEST</th>
                    <th rowspan=&quot;2&quot; width=&quot;10%&quot;>Mean Value</th>
                    <th rowspan=&quot;2&quot; width=&quot;10%&quot;>Remarks</th>
                </tr>
                <tr><th>1</th><th>2</th><th>3</th></tr>
            </thead>
            <tbody class=&quot;bitumenTable&quot;>
                <tr><td>1.</td><td style=&quot;text-align: left; padding-left: 10px;&quot;>Wt. of mix taken before extraction (A)</td><td><input class=&quot;tbl-input weight-input row-a&quot; readonly></td><td><input class=&quot;tbl-input weight-input row-a&quot; readonly></td><td><input class=&quot;tbl-input weight-input row-a&quot; readonly></td><td></td><td></td></tr>
                <tr><td>2.</td><td style=&quot;text-align: left; padding-left: 10px;&quot;>Wt. of Filter paper before extraction (B)</td><td><input class=&quot;tbl-input weight-input row-b&quot; readonly></td><td><input class=&quot;tbl-input weight-input row-b&quot; readonly></td><td><input class=&quot;tbl-input weight-input row-b&quot; readonly></td><td></td><td></td></tr>
                <tr><td>3.</td><td style=&quot;text-align: left; padding-left: 10px;&quot;>Wt. of mix after extraction (C)</td><td><input class=&quot;tbl-input weight-input row-c&quot; readonly></td><td><input class=&quot;tbl-input weight-input row-c&quot; readonly></td><td><input class=&quot;tbl-input weight-input row-c&quot; readonly></td><td></td><td></td></tr>
                <tr><td>4.</td><td style=&quot;text-align: left; padding-left: 10px;&quot;>Wt. of Filter paper after extraction (D)</td><td><input class=&quot;tbl-input weight-input row-d&quot; readonly></td><td><input class=&quot;tbl-input weight-input row-d&quot; readonly></td><td><input class=&quot;tbl-input weight-input row-d&quot; readonly></td><td></td><td></td></tr>
                <tr><td>5.</td><td style=&quot;text-align: left; padding-left: 10px;&quot;>Wt. of filler collected from extract (E)</td><td><input class=&quot;tbl-input weight-input row-e&quot; readonly></td><td><input class=&quot;tbl-input weight-input row-e&quot; readonly></td><td><input class=&quot;tbl-input weight-input row-e&quot; readonly></td><td><input class=&quot;tbl-input&quot; value=&quot;3.5%&quot;></td><td></td></tr>
                <tr><td>6.</td><td style=&quot;text-align: left; padding-left: 10px;&quot;>Wt. of filler collected in filter paper (D-B)=F</td><td><input class=&quot;tbl-input weight-input row-f&quot; readonly></td><td><input class=&quot;tbl-input weight-input row-f&quot; readonly></td><td><input class=&quot;tbl-input weight-input row-f&quot; readonly></td><td></td><td></td></tr>
                <tr><td>7.</td><td style=&quot;text-align: left; padding-left: 10px;&quot;>Wt. of agg. + filler after extraction (C+E+F)=G</td><td><input class=&quot;tbl-input weight-input row-g&quot; readonly></td><td><input class=&quot;tbl-input weight-input row-g&quot; readonly></td><td><input class=&quot;tbl-input weight-input row-g&quot; readonly></td><td></td><td></td></tr>
                <tr style=&quot;font-weight: bold;&quot;><td>8.</td><td style=&quot;text-align: left; padding-left: 10px;&quot;>Percentage of Bitumen (A-G)/A x 100</td><td><input class=&quot;tbl-input row-res&quot; readonly></td><td><input class=&quot;tbl-input row-res&quot; readonly></td><td><input class=&quot;tbl-input row-res&quot; readonly></td><td><input class=&quot;tbl-input meanBitumen&quot; readonly></td><td></td></tr>
            </tbody>
        </table>
        
        <div class=&quot;footer-section&quot;>
            <div style=&quot;display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px;&quot;>
                <div><strong>Memo No:</strong> <span class=&quot;editable&quot; contenteditable=&quot;true&quot; style=&quot;min-width: 100px;&quot;></span></div>
                <div style=&quot;margin-right: 150px;&quot;> <strong>Date:</strong> <span class=&quot;editable&quot; contenteditable=&quot;true&quot; style=&quot;min-width: 150px;&quot;></span></div>
            </div>
            <p><strong>Copy Forwarded to:-</strong> Executive Engineer, R.W.D, Works Division, <span class=&quot;editable location-placeholder&quot; contenteditable=&quot;true&quot;>Nawada</span></p>
            <div class=&quot;signature-row&quot;>
                <div class=&quot;signature-box&quot;><br><br><strong>T.S.</strong></div>
                <div class=&quot;signature-box&quot;>
                    <br><br><strong>A.E.</strong><br>
                    R.W.D, Testing and Quality Control Laboratory,<br>
                    <span class=&quot;editable location-placeholder&quot; contenteditable=&quot;true&quot;>Nawada</span>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // Toggle Logic
    function toggleMode() {
        const mode = document.querySelector(&#39;input[name=&quot;genMode&quot;]:checked&#39;).value;
        const qtyBox = document.getElementById(&#39;quantityBox&#39;);
        const listBox = document.getElementById(&#39;listBox&#39;);
        
        if (mode === &#39;quantity&#39;) {
            qtyBox.classList.remove(&#39;hidden&#39;);
            listBox.classList.add(&#39;hidden&#39;);
        } else {
            qtyBox.classList.add(&#39;hidden&#39;);
            listBox.classList.remove(&#39;hidden&#39;);
        }
    }

    // Line Numbers & Sync Scroll
    function updateLineNumbers() {
        const textarea = document.getElementById(&#39;roadListInput&#39;);
        const lines = textarea.value.split(&#39;\n&#39;).length;
        const lineNumbersElem = document.getElementById(&#39;lineNumbers&#39;);
        
        let numbersHTML = &#39;&#39;;
        for (let i = 1; i <= lines; i++) {
            numbersHTML += i + &#39;<br>&#39;;
        }
        lineNumbersElem.innerHTML = numbersHTML;
        
        const nonEmptyLines = textarea.value.split(&#39;\n&#39;).filter(line => line.trim() !== &quot;&quot;).length;
        document.getElementById(&#39;roadCountDisplay&#39;).innerText = nonEmptyLines;
    }

    function syncScroll() {
        const textarea = document.getElementById(&#39;roadListInput&#39;);
        const lineNumbersElem = document.getElementById(&#39;lineNumbers&#39;);
        lineNumbersElem.scrollTop = textarea.scrollTop;
    }

    function generateBulkReports() {
        const minWt = parseFloat(document.getElementById(&#39;ctrlMinWt&#39;).value) || 1000;
        const maxWt = parseFloat(document.getElementById(&#39;ctrlMaxWt&#39;).value) || 1000;
        
        const minBit = parseFloat(document.getElementById(&#39;ctrlMinBitumen&#39;).value) || 4.5;
        const maxBit = parseFloat(document.getElementById(&#39;ctrlMaxBitumen&#39;).value) || 5.0;
        const locName = document.getElementById(&#39;locationInput&#39;).value || &quot;Nawada&quot;;
        
        // Pass the B and D values if set
        const filterWtB = parseFloat(document.getElementById(&#39;ctrlFilterWt&#39;).value) || 5.00;
        const filterWtD_input = document.getElementById(&#39;ctrlFilterAfter&#39;).value;
        const filterWtD = filterWtD_input ? parseFloat(filterWtD_input) : null;
        
        // Determine Mode
        const mode = document.querySelector(&#39;input[name=&quot;genMode&quot;]:checked&#39;).value;
        let reportsToGenerate = []; 

        if (mode === &#39;quantity&#39;) {
            const count = parseInt(document.getElementById(&#39;reportCount&#39;).value);
            if (!count) { alert(&quot;Please enter Quantity.&quot;); return; }
            for(let i=0; i<count; i++) {
                reportsToGenerate.push({ roadName: &quot;&quot; }); 
            }
        } else {
            // List Mode
            const listText = document.getElementById(&#39;roadListInput&#39;).value;
            const lines = listText.split(&#39;\n&#39;);
            
            lines.forEach(line => {
                if(line.trim() !== &quot;&quot;) {
                    reportsToGenerate.push({ roadName: line.trim() });
                }
            });
            
            if (reportsToGenerate.length === 0) {
                alert(&quot;Please paste at least one road name in the list.&quot;);
                return;
            }
        }

        const container = document.getElementById(&#39;main-output-area&#39;);
        const template = container.querySelector(&#39;.template-report&#39;).cloneNode(true);
        container.innerHTML = &#39;&#39;; // Clear existing

        reportsToGenerate.forEach(item => {
            let newReport = template.cloneNode(true);
            
            // Random Weight for this specific report
            let randomSampleWt = Math.floor(Math.random() * (maxWt - minWt + 1)) + minWt;
            
            // Random Target Bitumen % for this specific report
            let randomTargetBit = (Math.random() * (maxBit - minBit)) + minBit;
            
            // Update Location Name
            newReport.querySelectorAll(&#39;.location-placeholder&#39;).forEach(span => {
                span.innerText = locName;
            });
            
            // Update Road Name
            if (item.roadName) {
                newReport.querySelector(&#39;.road-name-field&#39;).innerText = item.roadName;
            }

            container.appendChild(newReport);
            
            // Run calculation
            autoFillBitumen(newReport, randomSampleWt, randomTargetBit, filterWtB, filterWtD);
        });
    }

    function autoFillBitumen(reportElement, baseSampleWt, targetBitumen, filterB, filterTargetD) {
        const numTests = parseInt(document.getElementById(&#39;ctrlNumTests&#39;).value) || 3;
        
        // Display sample weight in the report
        reportElement.querySelector(&#39;.dispSampleWt&#39;).value = baseSampleWt;

        const rowsA = reportElement.querySelectorAll(&#39;.row-a&#39;);
        const rowsB = reportElement.querySelectorAll(&#39;.row-b&#39;);
        const rowsC = reportElement.querySelectorAll(&#39;.row-c&#39;);
        const rowsD = reportElement.querySelectorAll(&#39;.row-d&#39;);
        const rowsE = reportElement.querySelectorAll(&#39;.row-e&#39;);
        const rowsF = reportElement.querySelectorAll(&#39;.row-f&#39;);
        const rowsG = reportElement.querySelectorAll(&#39;.row-g&#39;);
        const rowsRes = reportElement.querySelectorAll(&#39;.row-res&#39;);

        let totalBitumen = 0;

        for (let i = 0; i < 3; i++) {
            if (i < numTests) {
                let currentSampleWt = baseSampleWt; 
                
                rowsA[i].value = currentSampleWt;
                rowsB[i].value = filterB.toFixed(2);
                
                // --- Logic for Filter Paper D ---
                let valD;
                if (filterTargetD !== null) {
                    valD = filterTargetD + (Math.random() * 0.04 - 0.02);
                } else {
                    let valF_approx = (Math.random() * 0.20) + 0.10; 
                    valD = filterB + valF_approx;
                }
                
                let valF = valD - filterB;

                // --- Logic for Bitumen Target ---
                // Keep individual test variance tight (+/- 0.05) around the report&#39;s random target
                let currentTargetBitumen = targetBitumen + ((Math.random() * 0.10) - 0.05);
                
                // Calculations
                let requiredG = currentSampleWt - ((currentTargetBitumen * currentSampleWt) / 100);
                
                let valE_approx = (Math.random() * 1.0) + 0.8; 
                let valC = Math.round(requiredG - valF - valE_approx); 
                let valE = requiredG - valF - valC;
                
                let finalG = valC + valE + valF;
                let finalBitumenPct = ((currentSampleWt - finalG) / currentSampleWt) * 100;

                rowsC[i].value = valC;
                rowsD[i].value = valD.toFixed(2);
                rowsE[i].value = valE.toFixed(2);
                rowsF[i].value = valF.toFixed(2);
                rowsG[i].value = finalG.toFixed(2);
                rowsRes[i].value = finalBitumenPct.toFixed(2) + &quot;%&quot;;
                
                totalBitumen += finalBitumenPct;
            } else {
                [rowsA[i], rowsB[i], rowsC[i], rowsD[i], rowsE[i], rowsF[i], rowsG[i], rowsRes[i]].forEach(el => el.value = &quot;&quot;);
            }
        }
        
        if (numTests > 0) {
            reportElement.querySelector(&#39;.meanBitumen&#39;).value = (totalBitumen / numTests).toFixed(2) + &quot;%&quot;;
        }
    }

    // ========== DRAGGABLE CONTROLS (MOBILE FIXED) ==========
    (function() {
        let isDragging = false;
        let currentPanel = null;
        let offsetX = 0;
        let offsetY = 0;
        let startX = 0;
        let startY = 0;
        let hasMoved = false;

        document.querySelectorAll('.drag-handle').forEach(handle => {
            handle.addEventListener('touchstart', handleTouchStart, { passive: false });
            handle.addEventListener('mousedown', handleMouseStart);
        });

        function handleTouchStart(e) {
            const panel = e.target.closest('.action-btn-container') || e.target.closest('.controls');
            if (!panel) return;
            
            if (panel.classList.contains('minimized')) {
                toggleMinimize(e.target);
                return;
            }
            
            const touch = e.touches[0];
            startX = touch.clientX;
            startY = touch.clientY;
            
            const rect = panel.getBoundingClientRect();
            offsetX = touch.clientX - rect.left;
            offsetY = touch.clientY - rect.top;
            
            isDragging = true;
            currentPanel = panel;
            hasMoved = false;
            
            panel.style.transition = 'none';
            
            document.addEventListener('touchmove', handleTouchMove, { passive: false });
            document.addEventListener('touchend', handleTouchEnd);
        }

        function handleMouseStart(e) {
            const panel = e.target.closest('.action-btn-container') || e.target.closest('.controls');
            if (!panel) return;
            
            if (panel.classList.contains('minimized')) {
                toggleMinimize(e.target);
                return;
            }
            
            startX = e.clientX;
            startY = e.clientY;
            
            const rect = panel.getBoundingClientRect();
            offsetX = e.clientX - rect.left;
            offsetY = e.clientY - rect.top;
            
            isDragging = true;
            currentPanel = panel;
            hasMoved = false;
            
            panel.style.transition = 'none';
            
            document.addEventListener('mousemove', handleMouseMove);
            document.addEventListener('mouseup', handleMouseEnd);
        }

        function handleTouchMove(e) {
            if (!isDragging || !currentPanel) return;
            
            const touch = e.touches[0];
            const deltaX = Math.abs(touch.clientX - startX);
            const deltaY = Math.abs(touch.clientY - startY);
            
            // Only drag if moved more than 5px
            if (deltaX > 5 || deltaY > 5) {
                hasMoved = true;
                
                let newX = touch.clientX - offsetX;
                let newY = touch.clientY - offsetY;
                
                const maxX = window.innerWidth - currentPanel.offsetWidth;
                const maxY = window.innerHeight - currentPanel.offsetHeight;
                
                newX = Math.max(0, Math.min(newX, maxX));
                newY = Math.max(0, Math.min(newY, maxY));
                
                currentPanel.style.left = newX + 'px';
                currentPanel.style.top = newY + 'px';
                currentPanel.style.right = 'auto';
                
                e.preventDefault();
            }
        }

        function handleMouseMove(e) {
            if (!isDragging || !currentPanel) return;
            
            const deltaX = Math.abs(e.clientX - startX);
            const deltaY = Math.abs(e.clientY - startY);
            
            if (deltaX > 5 || deltaY > 5) {
                hasMoved = true;
                
                let newX = e.clientX - offsetX;
                let newY = e.clientY - offsetY;
                
                const maxX = window.innerWidth - currentPanel.offsetWidth;
                const maxY = window.innerHeight - currentPanel.offsetHeight;
                
                newX = Math.max(0, Math.min(newX, maxX));
                newY = Math.max(0, Math.min(newY, maxY));
                
                currentPanel.style.left = newX + 'px';
                currentPanel.style.top = newY + 'px';
                currentPanel.style.right = 'auto';
            }
        }

        function handleTouchEnd() {
            if (isDragging && currentPanel) {
                currentPanel.style.transition = 'all 0.3s ease';
            }
            isDragging = false;
            currentPanel = null;
            
            document.removeEventListener('touchmove', handleTouchMove);
            document.removeEventListener('touchend', handleTouchEnd);
        }

        function handleMouseEnd() {
            if (isDragging && currentPanel) {
                currentPanel.style.transition = 'all 0.3s ease';
            }
            isDragging = false;
            currentPanel = null;
            
            document.removeEventListener('mousemove', handleMouseMove);
            document.removeEventListener('mouseup', handleMouseEnd);
        }

        window.toggleMinimize = function(btn) {
            const panel = btn.closest('.action-btn-container') || btn.closest('.controls');
            if (!panel) return;
            panel.classList.toggle('minimized');
        };
    })();

</script>
</body>
</html>
}"
            style="width: 100%; height: calc(100vh - 160px); border: none; display: block;"
            sandbox="allow-scripts allow-same-origin allow-forms allow-modals"
        ></iframe>
    </div>

    <!-- Concrete Cube TEST -->
    <div id="concrete_cube" class="test-wrapper">
        <iframe 
            srcdoc="<!DOCTYPE html>
<html lang=&quot;en&quot;>
<head>
    <meta charset=&quot;UTF-8&quot;>
    <meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;>
    <title>Bulk Cube Test Generator Ultimate</title>
    <style>
        /* MAIN LAYOUT STYLES */
        body {
            font-family: &quot;Times New Roman&quot;, Times, serif;
            background-color: #f0f0f0;
            margin: 0;
            padding: 20px;
        }
        .report-container {
            width: 210mm;
            min-height: 297mm;
            background: white;
            margin: 0 auto;
            padding: 20px 40px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            box-sizing: border-box;
            position: relative;
            margin-bottom: 20px; /* Gap for screen view */
        }

        /* HEADER */
        .header { text-align: center; margin-bottom: 20px; color: #000; }
        .header h3 { margin: 0 0 5px 0; font-size: 16px; font-weight: bold; text-transform: uppercase; }
        .header h2 { margin: 5px 0; font-size: 22px; font-weight: 900; text-transform: uppercase; }
        .title { text-align: center; font-weight: bold; text-decoration: underline; margin: 15px 0 25px 0; font-size: 18px; text-transform: uppercase; }

        /* FLEXBOX FORM ROWS */
        .row {
            display: flex;
            align-items: baseline; 
            margin-bottom: 8px;
            font-size: 15px;
            font-weight: bold;
            flex-wrap: wrap; 
        }
        
        .label {
            white-space: nowrap;
            margin-right: 5px;
            font-weight: bold;
            padding-bottom: 1px;
            user-select: none;
            pointer-events: none;
            cursor: default;
        }
        
        .field-value {
            flex: 1;
            border-bottom: 1px dotted #000;
            outline: none;
            font-family: &quot;Times New Roman&quot;, Times, serif;
            font-size: 15px;
            font-weight: bold;
            color: #000;
            padding-left: 5px;
            min-width: 100px;
            display: inline-block;
        }

        .dual-row {
            display: flex;
            justify-content: space-between;
            align-items: baseline; 
            margin-bottom: 8px;
            gap: 15px;
        }
        .col-left {
            display: flex;
            flex: 1.5; 
            align-items: baseline; 
            flex-wrap: wrap;
        }
        .col-right {
            display: flex;
            flex: 0.8; 
            align-items: baseline; 
            white-space: nowrap;
        }

        .triple-row {
            display: flex;
            justify-content: space-between;
            align-items: baseline; 
            margin-bottom: 8px;
            margin-top: 15px;
        }
        .col-third {
            display: flex;
            align-items: baseline; 
            white-space: nowrap;
        }
        .short-field {
            border-bottom: 1px dotted #000;
            min-width: 80px;
            display: inline-block;
            outline: none;
            font-weight: bold;
            text-align: center;
            margin-left: 5px;
        }

        /* DATA TABLE */
        .data-table { 
            width: 100%; 
            border-collapse: collapse; 
            font-size: 13px; 
            margin-top: 20px; 
            margin-bottom: 30px; 
            text-align: center; 
            table-layout: fixed;
        }
        .data-table th, .data-table td { 
            border: 1px solid black; 
            padding: 5px; 
            height: 30px; 
            vertical-align: middle; 
        }
        .data-table th { background-color: #f2f2f2; font-weight: bold; font-size: 14px; user-select: none; }
        .col-desc { width: 30%; text-align: left; padding-left: 10px; font-weight: bold; user-select: none; }
        
        .tbl-input { 
            width: 100%; border: none; text-align: center; 
            font-family: inherit; font-size: 14px; 
            background: transparent; outline: none; font-weight: bold; 
        }

        /* FOOTER */
        .footer-section { margin-top: 40px; font-size: 15px; font-weight: bold; }
        .signature-row { display: flex; justify-content: space-between; margin-top: 80px; align-items: flex-start; }
        .signature-box { text-align: center; width: 250px; }

        /* AI CONTROLS - DRAGGABLE */
        .controls {
            position: fixed; top: 10px; right: 10px; width: 280px;
            background: rgba(255, 255, 255, 0.98); padding: 0; box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            border-radius: 8px; z-index: 9999; font-family: sans-serif; border: 1px solid #ccc;
            transition: all 0.3s ease;
        }
        .controls.minimized { width: 50px; height: 50px; border-radius: 50%; }
        .drag-handle {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white; padding: 10px; cursor: move;
            display: flex; justify-content: space-between; align-items: center;
            border-radius: 8px 8px 0 0; user-select: none; touch-action: none;
            -webkit-user-select: none;
            -webkit-touch-callout: none;
        }
        .minimized .drag-handle { border-radius: 50%; width: 50px; height: 50px; justify-content: center; padding: 0; }
        .drag-handle h4 { margin: 0; font-size: 14px; font-weight: bold; flex: 1; }
        .minimized .drag-handle h4 { display: none; }
        .minimize-btn {
            background: rgba(255,255,255,0.3); border: none; color: white;
            width: 24px; height: 24px; border-radius: 4px; cursor: pointer; font-size: 16px;
        }
        .minimized .minimize-btn { display: none; }
        .control-content { padding: 15px; max-height: calc(95vh - 44px); overflow-y: auto; }
        .minimized .control-content { display: none; }
        .minimized-icon { display: none; font-size: 24px; }
        .minimized .minimized-icon { display: block; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); }
        .controls h4 { margin: 0 0 10px 0; color: #333; text-align: center; border-bottom: 1px solid #eee; padding-bottom: 5px; }
        .ctrl-group { margin-bottom: 8px; }
        .ctrl-label { display: block; font-size: 12px; font-weight: bold; margin-bottom: 2px; color: #555; }
        .ctrl-input { width: 100%; padding: 4px; border: 1px solid #aaa; border-radius: 4px; font-size: 13px; box-sizing: border-box; }
        
        /* Toggle Switch Style */
        .mode-toggle { display: flex; align-items: center; margin-bottom: 10px; background: #eee; padding: 5px; border-radius: 5px; }
        .mode-toggle label { flex: 1; font-size: 12px; font-family: sans-serif; cursor: pointer; display: flex; align-items: center; }
        .mode-toggle input { margin-right: 5px; }

        /* List Editor Style */
        .list-editor-container {
            display: flex; border: 1px solid #aaa; border-radius: 4px;
            height: 100px; font-family: monospace; font-size: 12px;
            background: white; margin-bottom: 8px;
        }
        .line-numbers {
            width: 25px; background-color: #f0f0f0; color: #888;
            text-align: right; padding: 5px 2px; border-right: 1px solid #ddd;
            line-height: 1.4; overflow: hidden; user-select: none;
        }
        .road-list-area {
            flex: 1; border: none; padding: 5px; line-height: 1.4;
            resize: none; outline: none; white-space: pre; overflow-y: scroll;
        }
        .hidden { display: none; }

        .btn { width: 100%; padding: 8px; margin-top: 5px; border: none; border-radius: 4px; font-weight: bold; cursor: pointer; color: white; font-size: 13px; transition: 0.2s; }
        .magic-btn { background-color: #28a745; margin-bottom: 5px; }
        .print-btn { background-color: #dc3545; margin-bottom: 5px; }
        .clear-btn { background-color: #6c757d; }
        .btn:hover { opacity: 0.9; transform: scale(1.02); }

        @media print { 
            body { background-color: white; padding: 0; } 
            .report-container { 
                box-shadow: none; margin: 0; width: 100%; 
                page-break-after: always; /* Enables Bulk Printing */
            }
            .report-container:last-child { page-break-after: auto; }
            .controls { display: none; }
            .field-value, .short-field { border-bottom: none !important; } 
        }
    </style>
</head>
<body>

<div class=&quot;controls&quot;>
    <div class=&quot;drag-handle&quot;>
        <h4>‚öôÔ∏è CUBE AI CONTROLS</h4>
        <button class=&quot;minimize-btn&quot; onclick=&quot;toggleMinimize(this)&quot;>‚àí</button>
        <span class=&quot;minimized-icon&quot;>‚öôÔ∏è</span>
    </div>
    <div class=&quot;control-content&quot;>
    
    <div class=&quot;ctrl-group&quot;>
        <label class=&quot;ctrl-label&quot;>Division/Location:</label>
        <input type=&quot;text&quot; id=&quot;locationInput&quot; class=&quot;ctrl-input&quot; value=&quot;Nawada&quot; placeholder=&quot;e.g. PATNA&quot;>
    </div>

    <div class=&quot;mode-toggle&quot;>
        <label>
            <input type=&quot;radio&quot; name=&quot;genMode&quot; value=&quot;quantity&quot; onchange=&quot;toggleMode()&quot; checked> 
            <strong>Quantity Only</strong>
        </label>
        <label>
            <input type=&quot;radio&quot; name=&quot;genMode&quot; value=&quot;list&quot; onchange=&quot;toggleMode()&quot;> 
            <strong>Road Name List</strong>
        </label>
    </div>

    <div id=&quot;quantityBox&quot; class=&quot;ctrl-group&quot;>
        <label class=&quot;ctrl-label&quot;>Quantity (Reports):</label>
        <input type=&quot;number&quot; id=&quot;reportCount&quot; class=&quot;ctrl-input&quot; value=&quot;10&quot;>
    </div>

    <div id=&quot;listBox&quot; class=&quot;ctrl-group hidden&quot;>
        <label class=&quot;ctrl-label&quot;>Paste Road Names Below:</label>
        <div class=&quot;list-editor-container&quot;>
            <div class=&quot;line-numbers&quot; id=&quot;lineNumbers&quot;>1</div>
            <textarea id=&quot;roadListInput&quot; class=&quot;road-list-area&quot; placeholder=&quot;Paste list here...&quot; oninput=&quot;updateLineNumbers()&quot; onscroll=&quot;syncScroll()&quot;></textarea>
        </div>
        <div style=&quot;font-size: 11px; color: #666; text-align: right;&quot;>Total Roads: <span id=&quot;roadCountDisplay&quot;>0</span></div>
    </div>

    <div class=&quot;ctrl-group&quot;>
        <label class=&quot;ctrl-label&quot;>Concrete Grade:</label>
        <select id=&quot;ctrlGrade&quot; class=&quot;ctrl-input&quot; onchange=&quot;updateStrengthDefaults()&quot;>
            <option value=&quot;M15&quot;>M-15</option>
            <option value=&quot;M20&quot;>M-20</option>
            <option value=&quot;M25&quot;>M-25</option>
            <option value=&quot;M30&quot;>M-30</option>
            <option value=&quot;M35&quot; selected>M-35</option>
        </select>
    </div>

    <div style=&quot;display: flex; gap: 5px;&quot;>
        <div class=&quot;ctrl-group&quot; style=&quot;flex:1;&quot;>
            <label class=&quot;ctrl-label&quot;>Min Strength:</label>
            <input type=&quot;number&quot; id=&quot;ctrlMinStr&quot; class=&quot;ctrl-input&quot; value=&quot;350&quot;>
        </div>
        <div class=&quot;ctrl-group&quot; style=&quot;flex:1;&quot;>
            <label class=&quot;ctrl-label&quot;>Max Strength:</label>
            <input type=&quot;number&quot; id=&quot;ctrlMaxStr&quot; class=&quot;ctrl-input&quot; value=&quot;380&quot;>
        </div>
    </div>

    <div class=&quot;ctrl-group&quot;>
        <label class=&quot;ctrl-label&quot;>Date of Casting:</label>
        <input type=&quot;date&quot; id=&quot;ctrlCastingDate&quot; class=&quot;ctrl-input&quot;>
    </div>

    <div style=&quot;display: flex; gap: 10px;&quot;>
        <div class=&quot;ctrl-group&quot; style=&quot;flex:1;&quot;>
            <label class=&quot;ctrl-label&quot;>7 Days?</label>
            <select id=&quot;ctrlDo7&quot; class=&quot;ctrl-input&quot;>
                <option value=&quot;yes&quot;>Yes</option>
                <option value=&quot;no&quot;>No</option>
            </select>
        </div>
        <div class=&quot;ctrl-group&quot; style=&quot;flex:1;&quot;>
            <label class=&quot;ctrl-label&quot;>28 Days?</label>
            <select id=&quot;ctrlDo28&quot; class=&quot;ctrl-input&quot;>
                <option value=&quot;yes&quot;>Yes</option>
                <option value=&quot;no&quot;>No</option>
            </select>
        </div>
    </div>

    <div class=&quot;ctrl-group&quot;>
        <label class=&quot;ctrl-label&quot;>No. of Cubes (1-3):</label>
        <select id=&quot;ctrlNumCubes&quot; class=&quot;ctrl-input&quot;>
            <option value=&quot;3&quot; selected>3 Cubes</option>
            <option value=&quot;2&quot;>2 Cubes</option>
            <option value=&quot;1&quot;>1 Cube</option>
        </select>
    </div>

    <button class=&quot;btn magic-btn&quot; onclick=&quot;generateBulkReports()&quot;>‚ö° GENERATE BULK</button>
    <button class=&quot;btn print-btn&quot; onclick=&quot;window.print()&quot;>PRINT REPORT üñ®Ô∏è</button>
    <button class=&quot;btn clear-btn&quot; onclick=&quot;location.reload()&quot;>RESET</button>
    </div></div>

<div id=&quot;main-output-area&quot;>
    <div class=&quot;report-container template-report&quot;>
        <div class=&quot;header&quot;>
            <h2>RURAL WORKS DEPARTMENT</h2>
            <h3>Testing and Quality Control Laboratory, <span class=&quot;field-value location-placeholder&quot; contenteditable=&quot;true&quot; style=&quot;border-bottom: none; min-width: 50px;&quot;>Nawada</span></h3>
        </div>
        <div class=&quot;title&quot;>TEST RESULT OF CONCRETE CUBE</div>
        
        <div class=&quot;dual-row&quot;>
            <div class=&quot;col-left&quot;>
                <span class=&quot;label&quot;>Name of Work :-</span>
                <span class=&quot;field-value workNameDisplay&quot; contenteditable=&quot;true&quot;>Cube Test (M-35)</span>
            </div>
            <div class=&quot;col-right&quot;>
                <span class=&quot;label&quot;>Date of Collection :-</span>
                <span class=&quot;field-value dateCollectionHeader&quot; contenteditable=&quot;true&quot; style=&quot;text-align: center; min-width: 100px;&quot;></span>
            </div>
        </div>

        <div class=&quot;dual-row&quot; style=&quot;align-items: flex-start;&quot;> 
            <div class=&quot;col-left&quot;>
                <span class=&quot;label&quot;>Name of Road :-</span>
                <span class=&quot;field-value road-name-field&quot; contenteditable=&quot;true&quot;></span>
            </div>
            <div class=&quot;col-right&quot;>
                <span class=&quot;label&quot;>Date of Test :-</span>
                <span class=&quot;field-value testDateHeader&quot; contenteditable=&quot;true&quot; style=&quot;text-align: center; min-width: 100px;&quot;></span>
            </div>
        </div>

        <div class=&quot;row&quot;>
            <span class=&quot;label&quot;>Name of Division :-</span>
            <span class=&quot;field-value&quot; contenteditable=&quot;true&quot;>R.W.D WORKS DIVISION</span>
        </div>

        <div class=&quot;row&quot;>
            <span class=&quot;label&quot;>Name of Agency :-</span>
            <span class=&quot;field-value&quot; contenteditable=&quot;true&quot;></span>
        </div>

        <div class=&quot;dual-row&quot;>
            <div class=&quot;col-left&quot;>
                <span class=&quot;label&quot;>Agreement No :-</span>
                <span class=&quot;field-value&quot; contenteditable=&quot;true&quot;></span>
            </div>
            <div class=&quot;col-right&quot; style=&quot;flex: 1;&quot;>
                <span class=&quot;label&quot;>Package No :-</span>
                <span class=&quot;field-value&quot; contenteditable=&quot;true&quot;></span>
            </div>
        </div>

        <div class=&quot;row&quot;>
            <span class=&quot;label&quot;>Ref :-</span>
            <span class=&quot;field-value&quot; contenteditable=&quot;true&quot;>A.E, R.W.D WORKS SUB DIV-</span>
        </div>

        <div class=&quot;triple-row&quot;>
            <div class=&quot;col-third&quot; style=&quot;flex: 0 0 auto;&quot;>
                <span class=&quot;label&quot;>LT NO :-</span>
                <span class=&quot;short-field&quot; contenteditable=&quot;true&quot;></span>
            </div>
            <div class=&quot;col-third&quot; style=&quot;flex: 0 0 auto;&quot;>
                <span class=&quot;label&quot;>DT :-</span>
                <span class=&quot;short-field&quot; contenteditable=&quot;true&quot;></span>
            </div>
            <div class=&quot;col-third&quot; style=&quot;flex: 1; justify-content: flex-end;&quot;>
                <span class=&quot;label&quot;>Chainage :-</span>
                <span class=&quot;short-field&quot; contenteditable=&quot;true&quot; style=&quot;min-width: 100px;&quot;>3.5 km</span>
            </div>
        </div>

        <table class=&quot;data-table&quot;>
            <thead>
                <tr>
                    <th rowspan=&quot;2&quot; class=&quot;col-desc&quot;>SL.NO / Description</th>
                    <th colspan=&quot;3&quot;>Test after 7 days</th>
                    <th colspan=&quot;3&quot;>Test after 28 days</th>
                </tr>
                <tr>
                    <th>1</th><th>2</th><th>3</th>
                    <th>1</th><th>2</th><th>3</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td class=&quot;col-desc&quot;>Dt. of Concreting</td>
                    <td><input class=&quot;tbl-input date-cast-7&quot;></td>
                    <td><input class=&quot;tbl-input date-cast-7&quot;></td>
                    <td><input class=&quot;tbl-input date-cast-7&quot;></td>
                    <td><input class=&quot;tbl-input date-cast-28&quot;></td>
                    <td><input class=&quot;tbl-input date-cast-28&quot;></td>
                    <td><input class=&quot;tbl-input date-cast-28&quot;></td>
                </tr>
                <tr>
                    <td class=&quot;col-desc&quot;>Dt. Of Test</td>
                    <td><input class=&quot;tbl-input date-test-7&quot;></td>
                    <td><input class=&quot;tbl-input date-test-7&quot;></td>
                    <td><input class=&quot;tbl-input date-test-7&quot;></td>
                    <td><input class=&quot;tbl-input date-test-28&quot;></td>
                    <td><input class=&quot;tbl-input date-test-28&quot;></td>
                    <td><input class=&quot;tbl-input date-test-28&quot;></td>
                </tr>
                <tr>
                    <td class=&quot;col-desc&quot;>ID Mark</td>
                    <td><input class=&quot;tbl-input id-7&quot; value=&quot;&quot;></td>
                    <td><input class=&quot;tbl-input id-7&quot; value=&quot;&quot;></td>
                    <td><input class=&quot;tbl-input id-7&quot; value=&quot;&quot;></td>
                    <td><input class=&quot;tbl-input id-28&quot; value=&quot;&quot;></td>
                    <td><input class=&quot;tbl-input id-28&quot; value=&quot;&quot;></td>
                    <td><input class=&quot;tbl-input id-28&quot; value=&quot;&quot;></td>
                </tr>
                <tr>
                    <td class=&quot;col-desc&quot;>Area C.M¬≤</td>
                    <td><input class=&quot;tbl-input area-7&quot; value=&quot;225&quot;></td>
                    <td><input class=&quot;tbl-input area-7&quot; value=&quot;225&quot;></td>
                    <td><input class=&quot;tbl-input area-7&quot; value=&quot;225&quot;></td>
                    <td><input class=&quot;tbl-input area-28&quot; value=&quot;225&quot;></td>
                    <td><input class=&quot;tbl-input area-28&quot; value=&quot;225&quot;></td>
                    <td><input class=&quot;tbl-input area-28&quot; value=&quot;225&quot;></td>
                </tr>
                <tr>
                    <td class=&quot;col-desc&quot;>Maximum Load KN</td>
                    <td><input class=&quot;tbl-input val-7-load&quot;></td>
                    <td><input class=&quot;tbl-input val-7-load&quot;></td>
                    <td><input class=&quot;tbl-input val-7-load&quot;></td>
                    <td><input class=&quot;tbl-input val-28-load&quot;></td>
                    <td><input class=&quot;tbl-input val-28-load&quot;></td>
                    <td><input class=&quot;tbl-input val-28-load&quot;></td>
                </tr>
                <tr>
                    <td class=&quot;col-desc&quot;>Crushing Strength Kg/CM¬≤</td>
                    <td><input class=&quot;tbl-input val-7-str&quot;></td>
                    <td><input class=&quot;tbl-input val-7-str&quot;></td>
                    <td><input class=&quot;tbl-input val-7-str&quot;></td>
                    <td><input class=&quot;tbl-input val-28-str&quot;></td>
                    <td><input class=&quot;tbl-input val-28-str&quot;></td>
                    <td><input class=&quot;tbl-input val-28-str&quot;></td>
                </tr>
                <tr>
                    <td class=&quot;col-desc&quot;>Remarks</td>
                    <td colspan=&quot;3&quot;><input class=&quot;tbl-input&quot;></td>
                    <td colspan=&quot;3&quot;><input class=&quot;tbl-input&quot;></td>
                </tr>
            </tbody>
        </table>

        <div class=&quot;footer-section&quot;>
            <div class=&quot;dual-row&quot;>
                <div class=&quot;col-left&quot;>
                    <span class=&quot;label&quot;>Memo No :-</span>
                    <span class=&quot;field-value&quot; contenteditable=&quot;true&quot;></span>
                </div>
                <div class=&quot;col-right&quot;>
                    <span class=&quot;label&quot;>Date :-</span>
                    <span class=&quot;field-value&quot; contenteditable=&quot;true&quot; style=&quot;text-align: center; min-width: 100px;&quot;></span>
                </div>
            </div>
            
            <p style=&quot;margin-top: 20px;&quot;>
                <strong>Copy Forwarded to:-</strong> 
                <span class=&quot;field-value&quot; contenteditable=&quot;true&quot; style=&quot;border-bottom: none;&quot;>Executive Engineer, R.W.D, Works Division, <span class=&quot;location-placeholder&quot;>Nawada</span></span>
            </p>
            
            <div class=&quot;signature-row&quot;>
                <div class=&quot;signature-box&quot;><br><br><strong>T.S.</strong></div>
                <div class=&quot;signature-box&quot;>
                    <br><br><strong>A.E.</strong><br>
                    R.W.D, Testing and Quality Control Laboratory,<br>
                    <span class=&quot;field-value location-placeholder&quot; contenteditable=&quot;true&quot; style=&quot;border-bottom: none; min-width: 50px;&quot;>Nawada</span>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    function formatDate(dateObj) {
        let d = dateObj.getDate();
        let m = dateObj.getMonth() + 1;
        let y = dateObj.getFullYear();
        return (d < 10 ? &#39;0&#39; + d : d) + &#39;.&#39; + (m < 10 ? &#39;0&#39; + m : m) + &#39;.&#39; + y;
    }

    // Automatically update ranges when Grade changes
    function updateStrengthDefaults() {
        const grade = document.getElementById(&#39;ctrlGrade&#39;).value;
        let min = 350, max = 380;
        
        switch(grade) {
            case &#39;M15&#39;: min = 150; max = 165; break;
            case &#39;M20&#39;: min = 200; max = 220; break;
            case &#39;M25&#39;: min = 250; max = 275; break;
            case &#39;M30&#39;: min = 300; max = 330; break;
            case &#39;M35&#39;: min = 350; max = 380; break;
        }
        
        document.getElementById(&#39;ctrlMinStr&#39;).value = min;
        document.getElementById(&#39;ctrlMaxStr&#39;).value = max;
    }

    // Toggle between Quantity Input and List Input
    function toggleMode() {
        const mode = document.querySelector(&#39;input[name=&quot;genMode&quot;]:checked&#39;).value;
        const qtyBox = document.getElementById(&#39;quantityBox&#39;);
        const listBox = document.getElementById(&#39;listBox&#39;);
        
        if (mode === &#39;quantity&#39;) {
            qtyBox.classList.remove(&#39;hidden&#39;);
            listBox.classList.add(&#39;hidden&#39;);
        } else {
            qtyBox.classList.add(&#39;hidden&#39;);
            listBox.classList.remove(&#39;hidden&#39;);
        }
    }

    // Line Numbers Logic
    function updateLineNumbers() {
        const textarea = document.getElementById(&#39;roadListInput&#39;);
        const lines = textarea.value.split(&#39;\n&#39;).length;
        const lineNumbersElem = document.getElementById(&#39;lineNumbers&#39;);
        
        let numbersHTML = &#39;&#39;;
        for (let i = 1; i <= lines; i++) {
            numbersHTML += i + &#39;<br>&#39;;
        }
        lineNumbersElem.innerHTML = numbersHTML;
        
        const nonEmptyLines = textarea.value.split(&#39;\n&#39;).filter(line => line.trim() !== &quot;&quot;).length;
        document.getElementById(&#39;roadCountDisplay&#39;).innerText = nonEmptyLines;
    }

    function syncScroll() {
        const textarea = document.getElementById(&#39;roadListInput&#39;);
        const lineNumbersElem = document.getElementById(&#39;lineNumbers&#39;);
        lineNumbersElem.scrollTop = textarea.scrollTop;
    }

    function generateBulkReports() {
        const locName = document.getElementById(&#39;locationInput&#39;).value || &quot;Nawada&quot;;
        const minStr = parseFloat(document.getElementById(&#39;ctrlMinStr&#39;).value) || 350;
        const maxStr = parseFloat(document.getElementById(&#39;ctrlMaxStr&#39;).value) || 380;

        // Determine Mode
        const mode = document.querySelector(&#39;input[name=&quot;genMode&quot;]:checked&#39;).value;
        let reportsToGenerate = []; 

        if (mode === &#39;quantity&#39;) {
            const count = parseInt(document.getElementById(&#39;reportCount&#39;).value);
            if (!count) { alert(&quot;Please enter Quantity.&quot;); return; }
            for(let i=0; i<count; i++) {
                reportsToGenerate.push({ roadName: &quot;&quot; }); 
            }
        } else {
            // List Mode
            const listText = document.getElementById(&#39;roadListInput&#39;).value;
            const lines = listText.split(&#39;\n&#39;);
            
            lines.forEach(line => {
                if(line.trim() !== &quot;&quot;) {
                    reportsToGenerate.push({ roadName: line.trim() });
                }
            });
            
            if (reportsToGenerate.length === 0) {
                alert(&quot;Please paste at least one road name in the list.&quot;);
                return;
            }
        }

        const container = document.getElementById(&#39;main-output-area&#39;);
        const template = container.querySelector(&#39;.template-report&#39;).cloneNode(true);
        container.innerHTML = &#39;&#39;; // Clear existing

        reportsToGenerate.forEach(item => {
            let newReport = template.cloneNode(true);
            
            // Update Location Name
            newReport.querySelectorAll(&#39;.location-placeholder&#39;).forEach(span => {
                span.innerText = locName;
            });

            // Update Road Name
            if (item.roadName) {
                newReport.querySelector(&#39;.road-name-field&#39;).innerText = item.roadName;
            }
            
            container.appendChild(newReport);
            
            // Generate Data
            autoFillCube(newReport, minStr, maxStr);
        });
    }

    function autoFillCube(reportElement, minStrength, maxStrength) {
        const grade = document.getElementById(&#39;ctrlGrade&#39;).value;
        const castingDateVal = document.getElementById(&#39;ctrlCastingDate&#39;).value;
        const do7 = document.getElementById(&#39;ctrlDo7&#39;).value === &#39;yes&#39;;
        const do28 = document.getElementById(&#39;ctrlDo28&#39;).value === &#39;yes&#39;;
        const numCubes = parseInt(document.getElementById(&#39;ctrlNumCubes&#39;).value);

        // Update Work Name
        reportElement.querySelector(&#39;.workNameDisplay&#39;).innerText = &quot;Cube Test (&quot; + grade.replace(&#39;M&#39;, &#39;M-&#39;) + &quot;)&quot;;

        const area = 225;
        const knFactor = 101.9716;

        let castStr = &quot;&quot;;
        let t7Str = &quot;&quot;;
        let t28Str = &quot;&quot;;

        if (castingDateVal) {
            const castDate = new Date(castingDateVal);
            const testDate7 = new Date(castDate);
            testDate7.setDate(castDate.getDate() + 7);
            const testDate28 = new Date(castDate);
            testDate28.setDate(castDate.getDate() + 28);

            castStr = formatDate(castDate);
            t7Str = formatDate(testDate7);
            t28Str = formatDate(testDate28);
            
            reportElement.querySelector(&#39;.dateCollectionHeader&#39;).innerText = castStr;

            if(do28) reportElement.querySelector(&#39;.testDateHeader&#39;).innerText = t28Str;
            else if(do7) reportElement.querySelector(&#39;.testDateHeader&#39;).innerText = t7Str;
        }

        // 7-DAY LOOP
        const inputs7Load = reportElement.querySelectorAll(&#39;.val-7-load&#39;);
        const inputs7Str = reportElement.querySelectorAll(&#39;.val-7-str&#39;);
        const datesCast7 = reportElement.querySelectorAll(&#39;.date-cast-7&#39;);
        const datesTest7 = reportElement.querySelectorAll(&#39;.date-test-7&#39;);
        const ids7 = reportElement.querySelectorAll(&#39;.id-7&#39;);
        const areas7 = reportElement.querySelectorAll(&#39;.area-7&#39;);

        for(let i=0; i<3; i++) {
            if (do7 && i < numCubes) {
                datesCast7[i].value = castStr;
                datesTest7[i].value = t7Str;
                ids7[i].value = &quot;&quot;; 
                areas7[i].value = &quot;225&quot;;
                
                // If only 7 days selected, use full range, else approx 67% of 28 day range
                let targetMin = do28 ? (minStrength * 0.65) : minStrength;
                let targetMax = do28 ? (maxStrength * 0.68) : maxStrength;
                
                let str7 = (Math.random() * (targetMax - targetMin)) + targetMin;
                let load7 = Math.round((str7 * area) / knFactor); 
                
                inputs7Load[i].value = load7;
                inputs7Str[i].value = ((load7 * knFactor) / area).toFixed(2);
            } else {
                [datesCast7[i], datesTest7[i], ids7[i], areas7[i], inputs7Load[i], inputs7Str[i]].forEach(el => el.value = &quot;&quot;);
            }
        }

        // 28-DAY LOOP
        const inputs28Load = reportElement.querySelectorAll(&#39;.val-28-load&#39;);
        const inputs28Str = reportElement.querySelectorAll(&#39;.val-28-str&#39;);
        const datesCast28 = reportElement.querySelectorAll(&#39;.date-cast-28&#39;);
        const datesTest28 = reportElement.querySelectorAll(&#39;.date-test-28&#39;);
        const ids28 = reportElement.querySelectorAll(&#39;.id-28&#39;);
        const areas28 = reportElement.querySelectorAll(&#39;.area-28&#39;);

        for(let i=0; i<3; i++) {
            if (do28 && i < numCubes) {
                datesCast28[i].value = castStr;
                datesTest28[i].value = t28Str;
                ids28[i].value = &quot;&quot;; 
                areas28[i].value = &quot;225&quot;;
                
                // Random within selected range
                let str28 = (Math.random() * (maxStrength - minStrength)) + minStrength;
                let load28 = Math.round((str28 * area) / knFactor);
                
                inputs28Load[i].value = load28;
                inputs28Str[i].value = ((load28 * knFactor) / area).toFixed(2);
            } else {
                [datesCast28[i], datesTest28[i], ids28[i], areas28[i], inputs28Load[i], inputs28Str[i]].forEach(el => el.value = &quot;&quot;);
            }
        }
    }

    // ========== DRAGGABLE CONTROLS (MOBILE FIXED) ==========
    (function() {
        let isDragging = false;
        let currentPanel = null;
        let offsetX = 0;
        let offsetY = 0;
        let startX = 0;
        let startY = 0;
        let hasMoved = false;

        document.querySelectorAll('.drag-handle').forEach(handle => {
            handle.addEventListener('touchstart', handleTouchStart, { passive: false });
            handle.addEventListener('mousedown', handleMouseStart);
        });

        function handleTouchStart(e) {
            const panel = e.target.closest('.action-btn-container') || e.target.closest('.controls');
            if (!panel) return;
            
            if (panel.classList.contains('minimized')) {
                toggleMinimize(e.target);
                return;
            }
            
            const touch = e.touches[0];
            startX = touch.clientX;
            startY = touch.clientY;
            
            const rect = panel.getBoundingClientRect();
            offsetX = touch.clientX - rect.left;
            offsetY = touch.clientY - rect.top;
            
            isDragging = true;
            currentPanel = panel;
            hasMoved = false;
            
            panel.style.transition = 'none';
            
            document.addEventListener('touchmove', handleTouchMove, { passive: false });
            document.addEventListener('touchend', handleTouchEnd);
        }

        function handleMouseStart(e) {
            const panel = e.target.closest('.action-btn-container') || e.target.closest('.controls');
            if (!panel) return;
            
            if (panel.classList.contains('minimized')) {
                toggleMinimize(e.target);
                return;
            }
            
            startX = e.clientX;
            startY = e.clientY;
            
            const rect = panel.getBoundingClientRect();
            offsetX = e.clientX - rect.left;
            offsetY = e.clientY - rect.top;
            
            isDragging = true;
            currentPanel = panel;
            hasMoved = false;
            
            panel.style.transition = 'none';
            
            document.addEventListener('mousemove', handleMouseMove);
            document.addEventListener('mouseup', handleMouseEnd);
        }

        function handleTouchMove(e) {
            if (!isDragging || !currentPanel) return;
            
            const touch = e.touches[0];
            const deltaX = Math.abs(touch.clientX - startX);
            const deltaY = Math.abs(touch.clientY - startY);
            
            // Only drag if moved more than 5px
            if (deltaX > 5 || deltaY > 5) {
                hasMoved = true;
                
                let newX = touch.clientX - offsetX;
                let newY = touch.clientY - offsetY;
                
                const maxX = window.innerWidth - currentPanel.offsetWidth;
                const maxY = window.innerHeight - currentPanel.offsetHeight;
                
                newX = Math.max(0, Math.min(newX, maxX));
                newY = Math.max(0, Math.min(newY, maxY));
                
                currentPanel.style.left = newX + 'px';
                currentPanel.style.top = newY + 'px';
                currentPanel.style.right = 'auto';
                
                e.preventDefault();
            }
        }

        function handleMouseMove(e) {
            if (!isDragging || !currentPanel) return;
            
            const deltaX = Math.abs(e.clientX - startX);
            const deltaY = Math.abs(e.clientY - startY);
            
            if (deltaX > 5 || deltaY > 5) {
                hasMoved = true;
                
                let newX = e.clientX - offsetX;
                let newY = e.clientY - offsetY;
                
                const maxX = window.innerWidth - currentPanel.offsetWidth;
                const maxY = window.innerHeight - currentPanel.offsetHeight;
                
                newX = Math.max(0, Math.min(newX, maxX));
                newY = Math.max(0, Math.min(newY, maxY));
                
                currentPanel.style.left = newX + 'px';
                currentPanel.style.top = newY + 'px';
                currentPanel.style.right = 'auto';
            }
        }

        function handleTouchEnd() {
            if (isDragging && currentPanel) {
                currentPanel.style.transition = 'all 0.3s ease';
            }
            isDragging = false;
            currentPanel = null;
            
            document.removeEventListener('touchmove', handleTouchMove);
            document.removeEventListener('touchend', handleTouchEnd);
        }

        function handleMouseEnd() {
            if (isDragging && currentPanel) {
                currentPanel.style.transition = 'all 0.3s ease';
            }
            isDragging = false;
            currentPanel = null;
            
            document.removeEventListener('mousemove', handleMouseMove);
            document.removeEventListener('mouseup', handleMouseEnd);
        }

        window.toggleMinimize = function(btn) {
            const panel = btn.closest('.action-btn-container') || btn.closest('.controls');
            if (!panel) return;
            panel.classList.toggle('minimized');
        };
    })();

</script>
</body>
</html>"
            style="width: 100%; height: calc(100vh - 160px); border: none; display: block;"
            sandbox="allow-scripts allow-same-origin allow-forms allow-modals"
        ></iframe>
    </div>


    <script>
        function switchTest(testId) {
            // Hide all test wrappers
            document.querySelectorAll('.test-wrapper').forEach(wrapper => {
                wrapper.classList.remove('active');
            });
            
            // Remove active from all buttons
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Show selected test
            document.getElementById(testId).classList.add('active');
            
            // Activate button
            event.target.classList.add('active');
            
            // Scroll to top
            window.scrollTo({top: 0, behavior: 'smooth'});
        }
        
        // Log loaded message
        console.log('‚úÖ All 11 laboratory tests loaded successfully!');
        console.log('üìä 7 Gradation Tests');
        console.log('üõ¢Ô∏è 3 Binder Content Tests');
        console.log('üß± 1 Concrete Cube Test');
        
        // ========== DRAGGABLE NAVIGATION (MOBILE FIXED) ==========
        (function() {
            let isDraggingNav = false;
            let startX = 0;
            let startY = 0;
            let navOffsetX = 0;
            let navOffsetY = 0;
            let hasMoved = false;
            const mainNav = document.getElementById('mainNav');
            const navDragHandle = document.getElementById('navDragHandle');
            
            if (navDragHandle) {
                // Use touchstart for mobile, mousedown for desktop
                navDragHandle.addEventListener('touchstart', handleNavTouchStart, { passive: false });
                navDragHandle.addEventListener('mousedown', handleNavMouseStart);
            }
            
            function handleNavTouchStart(e) {
                if (mainNav.classList.contains('minimized')) {
                    toggleNavMinimize();
                    return;
                }
                
                const touch = e.touches[0];
                startX = touch.clientX;
                startY = touch.clientY;
                
                const rect = mainNav.getBoundingClientRect();
                navOffsetX = touch.clientX - rect.left;
                navOffsetY = touch.clientY - rect.top;
                
                hasMoved = false;
                isDraggingNav = true;
                mainNav.style.transition = 'none';
                
                document.addEventListener('touchmove', handleNavTouchMove, { passive: false });
                document.addEventListener('touchend', handleNavTouchEnd);
            }
            
            function handleNavMouseStart(e) {
                if (mainNav.classList.contains('minimized')) {
                    toggleNavMinimize();
                    return;
                }
                
                startX = e.clientX;
                startY = e.clientY;
                
                const rect = mainNav.getBoundingClientRect();
                navOffsetX = e.clientX - rect.left;
                navOffsetY = e.clientY - rect.top;
                
                hasMoved = false;
                isDraggingNav = true;
                mainNav.style.transition = 'none';
                
                document.addEventListener('mousemove', handleNavMouseMove);
                document.addEventListener('mouseup', handleNavMouseEnd);
            }
            
            function handleNavTouchMove(e) {
                if (!isDraggingNav) return;
                
                const touch = e.touches[0];
                const deltaX = Math.abs(touch.clientX - startX);
                const deltaY = Math.abs(touch.clientY - startY);
                
                // Only start dragging if moved more than 5px
                if (deltaX > 5 || deltaY > 5) {
                    hasMoved = true;
                    
                    let newX = touch.clientX - navOffsetX;
                    let newY = touch.clientY - navOffsetY;
                    
                    const maxX = window.innerWidth - mainNav.offsetWidth;
                    const maxY = window.innerHeight - mainNav.offsetHeight;
                    
                    newX = Math.max(0, Math.min(newX, maxX));
                    newY = Math.max(0, Math.min(newY, maxY));
                    
                    mainNav.style.left = newX + 'px';
                    mainNav.style.top = newY + 'px';
                    mainNav.style.right = 'auto';
                    
                    e.preventDefault();
                }
            }
            
            function handleNavMouseMove(e) {
                if (!isDraggingNav) return;
                
                const deltaX = Math.abs(e.clientX - startX);
                const deltaY = Math.abs(e.clientY - startY);
                
                if (deltaX > 5 || deltaY > 5) {
                    hasMoved = true;
                    
                    let newX = e.clientX - navOffsetX;
                    let newY = e.clientY - navOffsetY;
                    
                    const maxX = window.innerWidth - mainNav.offsetWidth;
                    const maxY = window.innerHeight - mainNav.offsetHeight;
                    
                    newX = Math.max(0, Math.min(newX, maxX));
                    newY = Math.max(0, Math.min(newY, maxY));
                    
                    mainNav.style.left = newX + 'px';
                    mainNav.style.top = newY + 'px';
                    mainNav.style.right = 'auto';
                }
            }
            
            function handleNavTouchEnd() {
                if (isDraggingNav) {
                    mainNav.style.transition = 'all 0.3s ease';
                }
                isDraggingNav = false;
                
                document.removeEventListener('touchmove', handleNavTouchMove);
                document.removeEventListener('touchend', handleNavTouchEnd);
            }
            
            function handleNavMouseEnd() {
                if (isDraggingNav) {
                    mainNav.style.transition = 'all 0.3s ease';
                }
                isDraggingNav = false;
                
                document.removeEventListener('mousemove', handleNavMouseMove);
                document.removeEventListener('mouseup', handleNavMouseEnd);
            }
        })();
        
        function toggleNavMinimize() {
            const mainNav = document.getElementById('mainNav');
            mainNav.classList.toggle('minimized');
        }
    </script>

</body>
</html>